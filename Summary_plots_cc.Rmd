---
title: "Summary plots of complete-case analyses"
author: Willi Zhang
email: willi.zhang@ki.se
output: html_notebook
editor_options: 
  chunk_output_type: console
---

### 1. Load Packages
```{r}
library(forestploter)
library(grid)
library(readxl)
library(dplyr)
library(tidyr)
library(tibble)
library(ggplot2)
library(ggbreak)
library(naniar)
library(ggh4x)
library(here)
```

### 2. Plots for Proportion of Sexual Identity
#### 2.1. Prepare dataset for plotting
```{r}
# datasets for proportion of sexual identity
prop_cc_summary_2010 <- read_excel(here("prop_cc_summary_2010.xlsx"))
prop_cc_summary_2014 <- read_excel(here("prop_cc_summary_2014.xlsx"))
prop_cc_summary_2021 <- read_excel(here("prop_cc_summary_2021.xlsx"))

prop_cc_summary_2010 <- prop_cc_summary_2010 %>% slice( -c( 7:16 ) )
prop_cc_summary_2014 <- prop_cc_summary_2014 %>% slice( -c( 7:18 ) )
prop_cc_summary_2021 <- prop_cc_summary_2021 %>% slice( -c( 7:18 ) )

# to make it easier to combine across datasets
# a note on these changes will be added on the graph later
prop_cc_summary_2010$subgroup[ prop_cc_summary_2010$subgroup == "18-29" ] <- "16-29"
prop_cc_summary_2010$subgroup[ prop_cc_summary_2010$subgroup == "18-29.Male" ] <- "16-29.Male"
prop_cc_summary_2010$subgroup[ prop_cc_summary_2010$subgroup == "18-29.Female" ] <- "16-29.Female"

# merge datasets
prop_cc_summary <- prop_cc_summary_2010 %>%
  full_join( prop_cc_summary_2014, by = "subgroup" ) %>%
  full_join( prop_cc_summary_2021, by = "subgroup" )

# modify table format
desired_order <- c( "Male", "Female", "16-29", "30-44", "45-59", ">=60", "16-29.Male", "30-44.Male", "45-59.Male", ">=60.Male", "16-29.Female", "30-44.Female", "45-59.Female", ">=60.Female", "Sweden", "Europe", "Outside Europe", "<=9 years", "10-12 years", ">=13 years", "Manual and field trades", "Service and support", "Expertise and leadership", "<=2,500", "(2,500, 3,500]", "(3,500, 4,500]", ">4,500", "Currently married", "Never married", "Other", "living_alone_yes", "living_alone_no", "personal_support_yes", "personal_support_no", "Stockholm County" )

prop_cc_summary <- prop_cc_summary %>%
  mutate( subgroup = factor( subgroup, levels = desired_order ) ) %>%
  arrange( subgroup )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Sex", .before = 1 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Age group", .before = 4 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Age by sex", .before = 9 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Country of birth", .before = 18 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Education years", .before = 22 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Occupationᵈ", .before = 26 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Income (100 kr/yr)ᵉ", .before = 30 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Marital statusᶠ", .before = 35 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Living alone", .before = 39 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Personal support", .before = 42 )

prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "16-29" ] <- "16–29 yrsᵇ"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "30-44" ] <- "30–44 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "45-59" ] <- "45–59 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == ">=60" ] <- "\u2265 60 yrs"

prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "16-29.Male" ] <- "Male: 16–29 yrsᵇ"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "30-44.Male" ] <- "Male: 30–44 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "45-59.Male" ] <- "Male: 45–59 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == ">=60.Male" ] <- "Male: \u2265 60 yrs"

prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "16-29.Female" ] <- "Female: 16–29 yrsᵇ"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "30-44.Female" ] <- "Female: 30–44 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "45-59.Female" ] <- "Female: 45–59 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == ">=60.Female" ] <- "Female: \u2265 60 yrs"

prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "<=9 years" ] <- "\u2264 9 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "10-12 years" ] <- "10–12 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == ">=13 years" ] <- "\u2265 13 yrs"

prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "Europe" ] <- "Europeᶜ"

prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "<=2,500" ] <- "\u2264 2,500"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == ">4,500" ] <- "> 4,500"

prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "living_alone_no" ] <- "No"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "living_alone_yes" ] <- "Yes"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "personal_support_no" ] <- "No"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "personal_support_yes" ] <- "Yes"

prop_cc_summary$subgroup <- ifelse( is.na( prop_cc_summary$Heterosexual_point_estimate_2010 ) | 
                                      prop_cc_summary$subgroup == "Stockholm County", 
                                    prop_cc_summary$subgroup,
                                    paste0( "   ", prop_cc_summary$subgroup ) )

colnames( prop_cc_summary )[ colnames( prop_cc_summary ) == "subgroup" ] <- "Subgroup"

prop_cc_summary$sample_size_2010 <- ifelse( is.na( prop_cc_summary$sample_size_2010 ), "",
                                            prop_cc_summary$sample_size_2010 )

prop_cc_summary$sample_size_2014 <- ifelse( is.na( prop_cc_summary$sample_size_2014 ), "",
                                            prop_cc_summary$sample_size_2014 )

prop_cc_summary$sample_size_2021 <- ifelse( is.na( prop_cc_summary$sample_size_2021 ) &
                                              is.na( prop_cc_summary$Heterosexual_point_estimate_2010 ), "",
                                            ifelse( is.na( prop_cc_summary$sample_size_2021 ),  "\u2013",
                                                    prop_cc_summary$sample_size_2021 ) )
```

#### 2.2. Heterosexual group
```{r}
prop_cc_summary_heterosexual <- prop_cc_summary[ -c( 9:17 ), c( 1:4, 14:17, 27:30, 40 ) ]
  
prop_cc_summary_heterosexual <- prop_cc_summary_heterosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )
  
prop_cc_summary_heterosexual <- prop_cc_summary_heterosexual %>% 
  add_column( "SPHC-B 2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_upper_ci_2010*100 ), ")" ),
    .before = 3 )

prop_cc_summary_heterosexual <- prop_cc_summary_heterosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 8 )
  
prop_cc_summary_heterosexual <- prop_cc_summary_heterosexual %>% 
  add_column( "SPHC-B 2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_upper_ci_2014*100 ), ")" ),
    .before = 9 )
  
prop_cc_summary_heterosexual <- prop_cc_summary_heterosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 14 )
  
prop_cc_summary_heterosexual <- prop_cc_summary_heterosexual %>% 
  add_column( "SPHC-B 2021" = paste0(
  sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_point_estimate_2021*100 ), " (", 
  sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_lower_ci_2021*100 ), ", ", 
  sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_upper_ci_2021*100 ), ")"  ),
  .before = 15 )

prop_cc_summary_heterosexual$`SPHC-B 2010` <- ifelse( 
  is.na( prop_cc_summary_heterosexual$Heterosexual_point_estimate_2010 ), "",
  prop_cc_summary_heterosexual$`SPHC-B 2010` )

prop_cc_summary_heterosexual$`SPHC-B 2014` <- ifelse( 
  is.na( prop_cc_summary_heterosexual$Heterosexual_point_estimate_2014 ), "",
  prop_cc_summary_heterosexual$`SPHC-B 2014` )

prop_cc_summary_heterosexual$`SPHC-B 2021` <- ifelse( 
  is.na( prop_cc_summary_heterosexual$Heterosexual_point_estimate_2010 ) &
    is.na( prop_cc_summary_heterosexual$Heterosexual_point_estimate_2021 ), "",
  ifelse( is.na( prop_cc_summary_heterosexual$Heterosexual_point_estimate_2021 ), "\u2013",
          prop_cc_summary_heterosexual$`SPHC-B 2021` ) )

prop_cc_summary_heterosexual <- prop_cc_summary_heterosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 8 ) %>%
  add_column( temp3 = " ", .before = 10 ) %>%
  add_column( temp4 = " ", .before = 16 ) %>%
  add_column( temp5 = " ", .before = 18 ) %>%
  add_column( temp6 = " ", .before = 24 )

names( prop_cc_summary_heterosexual )[ names( prop_cc_summary_heterosexual ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5", "temp6" ) ] <- ""

colnames( prop_cc_summary_heterosexual )[ colnames( prop_cc_summary_heterosexual ) == "SPHC-B 2010" ] <- ""
colnames( prop_cc_summary_heterosexual )[ colnames( prop_cc_summary_heterosexual ) == "SPHC-B 2014" ] <- ""
colnames( prop_cc_summary_heterosexual )[ colnames( prop_cc_summary_heterosexual ) == "SPHC-B 2021" ] <- ""

colnames( prop_cc_summary_heterosexual )[ colnames( prop_cc_summary_heterosexual ) == "sample_size_2010" ] <- ""
colnames( prop_cc_summary_heterosexual )[ colnames( prop_cc_summary_heterosexual ) == "sample_size_2014" ] <- ""
colnames( prop_cc_summary_heterosexual )[ colnames( prop_cc_summary_heterosexual ) == "sample_size_2021" ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
  )
  
p_cc_heterosexual <- forest(
  prop_cc_summary_heterosexual[ , c( 1:4, 8:12, 16:20, 24, 25 ) ],
    
  est = list( prop_cc_summary_heterosexual$Heterosexual_point_estimate_2010*100,
              prop_cc_summary_heterosexual$Heterosexual_point_estimate_2014*100,
              prop_cc_summary_heterosexual$Heterosexual_point_estimate_2021*100
              ),
  
  lower = list( prop_cc_summary_heterosexual$Heterosexual_lower_ci_2010*100,
                prop_cc_summary_heterosexual$Heterosexual_lower_ci_2014*100,
                prop_cc_summary_heterosexual$Heterosexual_lower_ci_2021*100
                ),
  
  upper = list( prop_cc_summary_heterosexual$Heterosexual_upper_ci_2010*100,
                prop_cc_summary_heterosexual$Heterosexual_upper_ci_2014*100,
                prop_cc_summary_heterosexual$Heterosexual_upper_ci_2021*100
                ),
  
  ci_column = c( 3, 8, 13 ),
  is_summary = c( rep( FALSE, nrow( prop_cc_summary_heterosexual ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( prop_cc_summary_heterosexual[ prop_cc_summary_heterosexual$Subgroup == "Stockholm County", ]$Heterosexual_point_estimate_2010*100,
                prop_cc_summary_heterosexual[ prop_cc_summary_heterosexual$Subgroup == "Stockholm County", ]$Heterosexual_point_estimate_2014*100,
                prop_cc_summary_heterosexual[ prop_cc_summary_heterosexual$Subgroup == "Stockholm County", ]$Heterosexual_point_estimate_2021*100 ),
  
  vert_line = prop_cc_summary_heterosexual[ prop_cc_summary_heterosexual$Subgroup == "Stockholm County", ]$Heterosexual_point_estimate_2010*100,
    
  xlim = list( c( 90, 100 ), c( 60, 100 ), c( 60, 100 ) ),
  ticks_at = list( c( 90, 95, 100 ), c( 60, 80, 100 ), c( 60, 80, 100 ) ),
  xlab = "Proportion (%) (95% CI)",
  theme = tm
  )

p_cc_heterosexual <- edit_plot(
  p_cc_heterosexual,
  row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ),
  gp = gpar(fontface = "bold")
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "Heterosexual, Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "SSᵃ",
  col = 16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- insert_text(
  p_cc_heterosexual,
  text = "SPHC-B 2010",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "SPHC-B 2014",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "Heterosexual, Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "SPHC-B 2021",
  col = 13:16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "Heterosexual, Proportion (%) (95% CI)",
  col = 13:14,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_border(
  p_cc_heterosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_cc_heterosexual <- add_border(
  p_cc_heterosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_cc_heterosexual <- add_border(
  p_cc_heterosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 13:16,
  gp = gpar(lwd = 1)
)

p_cc_heterosexual <- edit_plot( p_cc_heterosexual,
                                row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ), 
                                which = "background",
                                gp = gpar( fill = "white" )
                                )

p_cc_heterosexual <- edit_plot( p_cc_heterosexual,
                                row = c( 2:3, 5:8, 10:12, 14:16, 18:20, 22:25, 27:29, 31, 32, 34, 35 ), 
                                which = "background",
                                gp = gpar( fill = "#eff3f2" )
                                )
 
plot( p_cc_heterosexual )
```

#### 2.3. Homosexual group
```{r}
prop_cc_summary_homosexual <- prop_cc_summary[ -c( 9:17 ), c( 1, 5:7, 14, 18:20, 27, 31:33, 40 ) ]

prop_cc_summary_homosexual <- prop_cc_summary_homosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

prop_cc_summary_homosexual <- prop_cc_summary_homosexual %>% 
  add_column( "SPHC-B 2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_upper_ci_2010*100 ), ")" ),
    .before = 3 )

prop_cc_summary_homosexual <- prop_cc_summary_homosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 8 )

prop_cc_summary_homosexual <- prop_cc_summary_homosexual %>% 
  add_column( "SPHC-B 2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_upper_ci_2014*100 ), ")" ),
    .before = 9 )

prop_cc_summary_homosexual <- prop_cc_summary_homosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 14 )

prop_cc_summary_homosexual <- prop_cc_summary_homosexual %>% 
  add_column( "SPHC-B 2021" = paste0(
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_upper_ci_2021*100 ), ")"  ),
    .before = 15 )

prop_cc_summary_homosexual$`SPHC-B 2010` <- ifelse( 
  is.na( prop_cc_summary_homosexual$Homosexual_point_estimate_2010 ), "",
  prop_cc_summary_homosexual$`SPHC-B 2010` )

prop_cc_summary_homosexual$`SPHC-B 2014` <- ifelse( 
  is.na( prop_cc_summary_homosexual$Homosexual_point_estimate_2014 ), "",
  prop_cc_summary_homosexual$`SPHC-B 2014` )

prop_cc_summary_homosexual$`SPHC-B 2021` <- ifelse( 
  is.na( prop_cc_summary_homosexual$Homosexual_point_estimate_2010 ) &
    is.na( prop_cc_summary_homosexual$Homosexual_point_estimate_2021 ), "",
  ifelse( is.na( prop_cc_summary_homosexual$Homosexual_point_estimate_2021 ), "\u2013",
          prop_cc_summary_homosexual$`SPHC-B 2021` ) )

prop_cc_summary_homosexual <- prop_cc_summary_homosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 8 ) %>%
  add_column( temp3 = " ", .before = 10 ) %>%
  add_column( temp4 = " ", .before = 16 ) %>%
  add_column( temp5 = " ", .before = 18 ) %>%
  add_column( temp6 = " ", .before = 24 )

names( prop_cc_summary_homosexual )[ names( prop_cc_summary_homosexual ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5", "temp6" ) ] <- ""

colnames( prop_cc_summary_homosexual )[ colnames( prop_cc_summary_homosexual ) == "SPHC-B 2010" ] <- ""
colnames( prop_cc_summary_homosexual )[ colnames( prop_cc_summary_homosexual ) == "SPHC-B 2014" ] <- ""
colnames( prop_cc_summary_homosexual )[ colnames( prop_cc_summary_homosexual ) == "SPHC-B 2021" ] <- ""

colnames( prop_cc_summary_homosexual )[ colnames( prop_cc_summary_homosexual ) == "sample_size_2010" ] <- ""
colnames( prop_cc_summary_homosexual )[ colnames( prop_cc_summary_homosexual ) == "sample_size_2014" ] <- ""
colnames( prop_cc_summary_homosexual )[ colnames( prop_cc_summary_homosexual ) == "sample_size_2021" ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
)

p_cc_homosexual <- forest(
  prop_cc_summary_homosexual[ , c( 1:4, 8:12, 16:20, 24, 25 ) ],
  
  est = list( prop_cc_summary_homosexual$Homosexual_point_estimate_2010*100,
              prop_cc_summary_homosexual$Homosexual_point_estimate_2014*100,
              prop_cc_summary_homosexual$Homosexual_point_estimate_2021*100
  ),
  
  lower = list( prop_cc_summary_homosexual$Homosexual_lower_ci_2010*100,
                prop_cc_summary_homosexual$Homosexual_lower_ci_2014*100,
                prop_cc_summary_homosexual$Homosexual_lower_ci_2021*100
  ),
  
  upper = list( prop_cc_summary_homosexual$Homosexual_upper_ci_2010*100,
                prop_cc_summary_homosexual$Homosexual_upper_ci_2014*100,
                prop_cc_summary_homosexual$Homosexual_upper_ci_2021*100
  ),
  
  ci_column = c( 3, 8, 13 ),
  is_summary = c( rep( FALSE, nrow( prop_cc_summary_homosexual ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( prop_cc_summary_homosexual[ prop_cc_summary_homosexual$Subgroup == "Stockholm County", ]$Homosexual_point_estimate_2010*100,
                prop_cc_summary_homosexual[ prop_cc_summary_homosexual$Subgroup == "Stockholm County", ]$Homosexual_point_estimate_2014*100,
                prop_cc_summary_homosexual[ prop_cc_summary_homosexual$Subgroup == "Stockholm County", ]$Homosexual_point_estimate_2021*100 ),
  
  vert_line = prop_cc_summary_homosexual[ prop_cc_summary_homosexual$Subgroup == "Stockholm County", ]$Homosexual_point_estimate_2010*100,
  
  xlim = list( c( 0, 4 ), c( 0, 4 ), c( 0, 4 ) ),
  ticks_at = list( c( 0, 1, 2, 3, 4 ), c( 0, 1, 2, 3, 4 ), c( 0, 1, 2, 3, 4 ) ),
  xlab = "Proportion (%) (95% CI)",
  theme = tm
)

p_cc_homosexual <- edit_plot(
  p_cc_homosexual,
  row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ),
  gp = gpar(fontface = "bold")
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "Homosexual, Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "SSᵃ",
  col = 16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- insert_text(
  p_cc_homosexual,
  text = "SPHC-B 2010",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "SPHC-B 2014",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "Homosexual, Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "SPHC-B 2021",
  col = 13:16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "Homosexual, Proportion (%) (95% CI)",
  col = 13:14,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_border(
  p_cc_homosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_cc_homosexual <- add_border(
  p_cc_homosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_cc_homosexual <- add_border(
  p_cc_homosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 13:16,
  gp = gpar(lwd = 1)
)

p_cc_homosexual <- edit_plot( p_cc_homosexual,
                              row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ), 
                              which = "background",
                              gp = gpar( fill = "white" )
                              )

p_cc_homosexual <- edit_plot( p_cc_homosexual,
                              row = c( 2:3, 5:8, 10:12, 14:16, 18:20, 22:25, 27:29, 31, 32, 34, 35 ), 
                              which = "background",
                              gp = gpar( fill = "#eff3f2" )
                              )

plot( p_cc_homosexual )
```

#### 2.4. Bisexual group
```{r}
prop_cc_summary_bisexual <- prop_cc_summary[ -c( 9:17 ), c( 1, 8:10, 14, 21:23, 27, 34:36, 40 ) ]

prop_cc_summary_bisexual <- prop_cc_summary_bisexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

prop_cc_summary_bisexual <- prop_cc_summary_bisexual %>% 
  add_column( "SPHC-B 2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_upper_ci_2010*100 ), ")" ),
    .before = 3 )

prop_cc_summary_bisexual <- prop_cc_summary_bisexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 8 )

prop_cc_summary_bisexual <- prop_cc_summary_bisexual %>% 
  add_column( "SPHC-B 2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_upper_ci_2014*100 ), ")" ),
    .before = 9 )

prop_cc_summary_bisexual <- prop_cc_summary_bisexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 14 )

prop_cc_summary_bisexual <- prop_cc_summary_bisexual %>% 
  add_column( "SPHC-B 2021" = paste0(
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_upper_ci_2021*100 ), ")"  ),
    .before = 15 )

prop_cc_summary_bisexual$`SPHC-B 2010` <- ifelse( 
  is.na( prop_cc_summary_bisexual$Bisexual_point_estimate_2010 ), "",
  prop_cc_summary_bisexual$`SPHC-B 2010` )

prop_cc_summary_bisexual$`SPHC-B 2014` <- ifelse( 
  is.na( prop_cc_summary_bisexual$Bisexual_point_estimate_2014 ), "",
  prop_cc_summary_bisexual$`SPHC-B 2014` )

prop_cc_summary_bisexual$`SPHC-B 2021` <- ifelse( 
  is.na( prop_cc_summary_bisexual$Bisexual_point_estimate_2010 ) &
    is.na( prop_cc_summary_bisexual$Bisexual_point_estimate_2021 ), "",
  ifelse( is.na( prop_cc_summary_bisexual$Bisexual_point_estimate_2021 ), "\u2013",
          prop_cc_summary_bisexual$`SPHC-B 2021` ) )

prop_cc_summary_bisexual <- prop_cc_summary_bisexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 8 ) %>%
  add_column( temp3 = " ", .before = 10 ) %>%
  add_column( temp4 = " ", .before = 16 ) %>%
  add_column( temp5 = " ", .before = 18 ) %>%
  add_column( temp6 = " ", .before = 24 )

names( prop_cc_summary_bisexual )[ names( prop_cc_summary_bisexual ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5", "temp6" ) ] <- ""

colnames( prop_cc_summary_bisexual )[ colnames( prop_cc_summary_bisexual ) == "SPHC-B 2010" ] <- ""
colnames( prop_cc_summary_bisexual )[ colnames( prop_cc_summary_bisexual ) == "SPHC-B 2014" ] <- ""
colnames( prop_cc_summary_bisexual )[ colnames( prop_cc_summary_bisexual ) == "SPHC-B 2021" ] <- ""

colnames( prop_cc_summary_bisexual )[ colnames( prop_cc_summary_bisexual ) == "sample_size_2010" ] <- ""
colnames( prop_cc_summary_bisexual )[ colnames( prop_cc_summary_bisexual ) == "sample_size_2014" ] <- ""
colnames( prop_cc_summary_bisexual )[ colnames( prop_cc_summary_bisexual ) == "sample_size_2021" ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
)

p_cc_bisexual <- forest(
  prop_cc_summary_bisexual[ , c( 1:4, 8:12, 16:20, 24, 25 ) ],
  
  est = list( prop_cc_summary_bisexual$Bisexual_point_estimate_2010*100,
              prop_cc_summary_bisexual$Bisexual_point_estimate_2014*100,
              prop_cc_summary_bisexual$Bisexual_point_estimate_2021*100
  ),
  
  lower = list( prop_cc_summary_bisexual$Bisexual_lower_ci_2010*100,
                prop_cc_summary_bisexual$Bisexual_lower_ci_2014*100,
                prop_cc_summary_bisexual$Bisexual_lower_ci_2021*100
  ),
  
  upper = list( prop_cc_summary_bisexual$Bisexual_upper_ci_2010*100,
                prop_cc_summary_bisexual$Bisexual_upper_ci_2014*100,
                prop_cc_summary_bisexual$Bisexual_upper_ci_2021*100
  ),
  
  ci_column = c( 3, 8, 13 ),
  is_summary = c( rep( FALSE, nrow( prop_cc_summary_bisexual ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( prop_cc_summary_bisexual[ prop_cc_summary_bisexual$Subgroup == "Stockholm County", ]$Bisexual_point_estimate_2010*100,
                prop_cc_summary_bisexual[ prop_cc_summary_bisexual$Subgroup == "Stockholm County", ]$Bisexual_point_estimate_2014*100,
                prop_cc_summary_bisexual[ prop_cc_summary_bisexual$Subgroup == "Stockholm County", ]$Bisexual_point_estimate_2021*100 ),
  
  vert_line = prop_cc_summary_bisexual[ prop_cc_summary_bisexual$Subgroup == "Stockholm County", ]$Bisexual_point_estimate_2010*100,
  
  xlim = list( c( 0, 5 ), c( 0, 10 ), c( 0, 10 ) ),
  ticks_at = list( c( 0, 1, 2, 3, 4, 5 ), c( 0, 2, 4, 6, 8, 10 ), c( 0, 2, 4, 6, 8, 10 ) ),
  xlab = "Proportion (%) (95% CI)",
  theme = tm
)

p_cc_bisexual <- edit_plot(
  p_cc_bisexual,
  row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ),
  gp = gpar(fontface = "bold")
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "Bisexual, Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "SSᵃ",
  col = 16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- insert_text(
  p_cc_bisexual,
  text = "SPHC-B 2010",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "SPHC-B 2014",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "Bisexual, Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "SPHC-B 2021",
  col = 13:16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "Bisexual, Proportion (%) (95% CI)",
  col = 13:14,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_border(
  p_cc_bisexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_cc_bisexual <- add_border(
  p_cc_bisexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_cc_bisexual <- add_border(
  p_cc_bisexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 13:16,
  gp = gpar(lwd = 1)
)

p_cc_bisexual <- edit_plot( p_cc_bisexual,
                            row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ), 
                            which = "background",
                            gp = gpar( fill = "white" )
                            )

p_cc_bisexual <- edit_plot( p_cc_bisexual,
                            row = c( 2:3, 5:8, 10:12, 14:16, 18:20, 22:25, 27:29, 31, 32, 34, 35 ), 
                            which = "background",
                            gp = gpar( fill = "#eff3f2" )
                            )

plot( p_cc_bisexual )
```

#### 2.5. Other group
```{r}
prop_cc_summary_other <- prop_cc_summary[ -c( 9:17 ), c( 1, 11:13, 14, 24:26, 27, 37:39, 40 ) ]

prop_cc_summary_other$Subgroup[ prop_cc_summary_other$Subgroup == "   16–29 yrsᵇ" ] <- "   16–29 yrsᶜ"
prop_cc_summary_other$Subgroup[ prop_cc_summary_other$Subgroup == "   Europeᶜ" ] <- "   Europeᵈ"
prop_cc_summary_other$Subgroup[ prop_cc_summary_other$Subgroup == "Occupationᵈ" ] <- "Occupationᵉ"
prop_cc_summary_other$Subgroup[ prop_cc_summary_other$Subgroup == "Income (100 kr/yr)ᵉ" ] <- "Income (100 kr/yr)ᶠ"
prop_cc_summary_other$Subgroup[ prop_cc_summary_other$Subgroup == "Marital statusᶠ" ] <- "Marital statusᵍ"

prop_cc_summary_other <- prop_cc_summary_other %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

prop_cc_summary_other <- prop_cc_summary_other %>% 
  add_column( "SPHC-B 2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_other$Uncertain_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_other$Uncertain_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_other$Uncertain_upper_ci_2010*100 ), ")" ),
    .before = 3 )

prop_cc_summary_other <- prop_cc_summary_other %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 8 )

prop_cc_summary_other <- prop_cc_summary_other %>% 
  add_column( "SPHC-B 2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_other$`None of the above_point_estimate_2014`*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_other$`None of the above_lower_ci_2014`*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_other$`None of the above_upper_ci_2014`*100 ), ")" ),
    .before = 9 )

prop_cc_summary_other <- prop_cc_summary_other %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 14 )

prop_cc_summary_other <- prop_cc_summary_other %>% 
  add_column( "SPHC-B 2021" = paste0(
    sprintf( "%.1f", prop_cc_summary_other$`None of the above_point_estimate_2021`*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_other$`None of the above_lower_ci_2021`*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_other$`None of the above_upper_ci_2021`*100 ), ")"  ),
    .before = 15 )

prop_cc_summary_other$`SPHC-B 2010` <- ifelse( 
  is.na( prop_cc_summary_other$Uncertain_point_estimate_2010 ), "",
  prop_cc_summary_other$`SPHC-B 2010` )

prop_cc_summary_other$`SPHC-B 2014` <- ifelse( 
  is.na( prop_cc_summary_other$`None of the above_point_estimate_2014` ), "",
  prop_cc_summary_other$`SPHC-B 2014` )

prop_cc_summary_other$`SPHC-B 2021` <- ifelse( 
  is.na( prop_cc_summary_other$Uncertain_point_estimate_2010 ) &
    is.na( prop_cc_summary_other$`None of the above_point_estimate_2021` ), "",
  ifelse( is.na( prop_cc_summary_other$`None of the above_point_estimate_2021` ), "\u2013",
          prop_cc_summary_other$`SPHC-B 2021` ) )

prop_cc_summary_other <- prop_cc_summary_other %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 8 ) %>%
  add_column( temp3 = " ", .before = 10 ) %>%
  add_column( temp4 = " ", .before = 16 ) %>%
  add_column( temp5 = " ", .before = 18 ) %>%
  add_column( temp6 = " ", .before = 24 )

names( prop_cc_summary_other )[ names( prop_cc_summary_other ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5", "temp6" ) ] <- ""

colnames( prop_cc_summary_other )[ colnames( prop_cc_summary_other ) == "SPHC-B 2010" ] <- ""
colnames( prop_cc_summary_other )[ colnames( prop_cc_summary_other ) == "SPHC-B 2014" ] <- ""
colnames( prop_cc_summary_other )[ colnames( prop_cc_summary_other ) == "SPHC-B 2021" ] <- ""

colnames( prop_cc_summary_other )[ colnames( prop_cc_summary_other ) == "sample_size_2010" ] <- ""
colnames( prop_cc_summary_other )[ colnames( prop_cc_summary_other ) == "sample_size_2014" ] <- ""
colnames( prop_cc_summary_other )[ colnames( prop_cc_summary_other ) == "sample_size_2021" ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
)

p_cc_other <- forest(
  prop_cc_summary_other[ , c( 1:4, 8:12, 16:20, 24, 25 ) ],
  
  est = list( prop_cc_summary_other$Uncertain_point_estimate_2010*100,
              prop_cc_summary_other$`None of the above_point_estimate_2014`*100,
              prop_cc_summary_other$`None of the above_point_estimate_2021`*100
  ),
  
  lower = list( prop_cc_summary_other$Uncertain_lower_ci_2010*100,
                prop_cc_summary_other$`None of the above_lower_ci_2014`*100,
                prop_cc_summary_other$`None of the above_lower_ci_2021`*100
  ),
  
  upper = list( prop_cc_summary_other$Uncertain_upper_ci_2010*100,
                prop_cc_summary_other$`None of the above_upper_ci_2014`*100,
                prop_cc_summary_other$`None of the above_upper_ci_2021`*100
  ),
  
  ci_column = c( 3, 8, 13 ),
  is_summary = c( rep( FALSE, nrow( prop_cc_summary_other ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( prop_cc_summary_other[ prop_cc_summary_other$Subgroup == "Stockholm County", ]$Uncertain_point_estimate_2010*100,
                prop_cc_summary_other[ prop_cc_summary_other$Subgroup == "Stockholm County", ]$`None of the above_point_estimate_2014`*100,
                prop_cc_summary_other[ prop_cc_summary_other$Subgroup == "Stockholm County", ]$`None of the above_point_estimate_2021`*100 ),
  
  vert_line = prop_cc_summary_other[ prop_cc_summary_other$Subgroup == "Stockholm County", ]$Uncertain_point_estimate_2010*100,
  
  xlim = list( c( 0, 6 ), c( 0, 30 ), c( 0, 30 ) ),
  ticks_at = list( c( 0, 3, 6 ), c( 0, 5, 10, 15, 20, 25, 30 ), c( 0, 5, 10, 15, 20, 25, 30 ) ),
  xlab = "Proportion (%) (95% CI)",
  theme = tm
)

p_cc_other <- edit_plot(
  p_cc_other,
  row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ),
  gp = gpar(fontface = "bold")
)

p_cc_other <- add_text(
  p_cc_other,
  text = "Uncertain, Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_text(
  p_cc_other,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_text(
  p_cc_other,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_text(
  p_cc_other,
  text = "SSᵃ",
  col = 16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- insert_text(
  p_cc_other,
  text = "SPHC-B 2010",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_text(
  p_cc_other,
  text = "SPHC-B 2014",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_text(
  p_cc_other,
  text = "Otherᵇ, Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_text(
  p_cc_other,
  text = "SPHC-B 2021",
  col = 13:16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_text(
  p_cc_other,
  text = "Otherᵇ, Proportion (%) (95% CI)",
  col = 13:14,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_border(
  p_cc_other,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_cc_other <- add_border(
  p_cc_other,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_cc_other <- add_border(
  p_cc_other,
  part = "header",
  row = 1,
  where = "bottom",
  col = 13:16,
  gp = gpar(lwd = 1)
)

p_cc_other <- edit_plot( p_cc_other,
                         row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ), 
                         which = "background",
                         gp = gpar( fill = "white" )
                         )

p_cc_other <- edit_plot( p_cc_other,
                         row = c( 2:3, 5:8, 10:12, 14:16, 18:20, 22:25, 27:29, 31, 32, 34, 35 ), 
                         which = "background",
                         gp = gpar( fill = "#eff3f2" )
                         )

plot( p_cc_other )
```

#### 2.6. Age by sex
```{r}
prop_cc_summary_age_sex <- prop_cc_summary[ c( 10:17 ), ]

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_row( Subgroup = "Male", .before = 1 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_row( Subgroup = "Female", .before = 6 )

prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Male: 16–29 yrsᵇ" ] <- "   16–29 yrsᶜ\n\n"
prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Male: 30–44 yrs" ] <- "   30–44 yrs\n\n"
prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Male: 45–59 yrs" ] <- "   45–59 yrs\n\n"
prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Male: \u2265 60 yrs" ] <- "   \u2265 60 yrs\n\n"

prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Female: 16–29 yrsᵇ" ] <- "   16–29 yrsᶜ\n\n"
prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Female: 30–44 yrs" ] <- "   30–44 yrs\n\n"
prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Female: 45–59 yrs" ] <- "   45–59 yrs\n\n"
prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Female: \u2265 60 yrs" ] <- "   \u2265 60 yrs\n\n"

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Heterosexual_2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_upper_ci_2010*100 ), ")" ),
    .before = 2 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Homosexual_2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_upper_ci_2010*100 ), ")" ),
    .before = 6 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Bisexual_2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_upper_ci_2010*100 ), ")" ),
    .before = 10 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Other_2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Uncertain_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Uncertain_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Uncertain_upper_ci_2010*100 ), ")" ),
    .before = 14 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Heterosexual_2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_upper_ci_2014*100 ), ")" ),
    .before = 19 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Homosexual_2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_upper_ci_2014*100 ), ")" ),
    .before = 23 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Bisexual_2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_upper_ci_2014*100 ), ")" ),
    .before = 27 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Other_2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$`None of the above_point_estimate_2014`*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$`None of the above_lower_ci_2014`*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$`None of the above_upper_ci_2014`*100 ), ")" ),
    .before = 31 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Heterosexual_2021" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_upper_ci_2021*100 ), ")" ),
    .before = 36 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Homosexual_2021" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_upper_ci_2021*100 ), ")" ),
    .before = 40 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Bisexual_2021" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_upper_ci_2021*100 ), ")" ),
    .before = 44 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Other_2021" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$`None of the above_point_estimate_2021`*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$`None of the above_lower_ci_2021`*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$`None of the above_upper_ci_2021`*100 ), ")" ),
    .before = 48 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Heterosexual" = paste( prop_cc_summary_age_sex$`Heterosexual_2010`,
                                      prop_cc_summary_age_sex$`Heterosexual_2014`,
                                      prop_cc_summary_age_sex$`Heterosexual_2021`,
                                      sep = "\n" ),
              .before = 2 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Homosexual" = paste( prop_cc_summary_age_sex$`Homosexual_2010`,
                                    prop_cc_summary_age_sex$`Homosexual_2014`,
                                    prop_cc_summary_age_sex$`Homosexual_2021`,
                                    sep = "\n" ),
              .before = 3 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Bisexual" = paste( prop_cc_summary_age_sex$`Bisexual_2010`,
                                  prop_cc_summary_age_sex$`Bisexual_2014`,
                                  prop_cc_summary_age_sex$`Bisexual_2021`,
                                  sep = "\n" ),
              .before = 4 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Otherᵇ" = paste( prop_cc_summary_age_sex$`Other_2010`,
                                prop_cc_summary_age_sex$`Other_2014`,
                                prop_cc_summary_age_sex$`Other_2021`,
                                sep = "\n" ),
              .before = 5 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Nᵃ" = paste( prop_cc_summary_age_sex$sample_size_2010,
                            prop_cc_summary_age_sex$sample_size_2014,
                            prop_cc_summary_age_sex$sample_size_2021,
                            sep = "\n" ),
              .before = 2 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 3 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 5 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 7 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( `    ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 9 )

prop_cc_summary_age_sex$`Nᵃ` <- ifelse( is.na( prop_cc_summary_age_sex$Heterosexual_point_estimate_2010 ), "",
                                      prop_cc_summary_age_sex$`Nᵃ` )

prop_cc_summary_age_sex$`Heterosexual` <- ifelse( is.na( prop_cc_summary_age_sex$Heterosexual_point_estimate_2010 ), "",
                                                   prop_cc_summary_age_sex$`Heterosexual` )

prop_cc_summary_age_sex$`Homosexual` <- ifelse( is.na( prop_cc_summary_age_sex$Heterosexual_point_estimate_2010 ), "",
                                                 prop_cc_summary_age_sex$`Homosexual` )

prop_cc_summary_age_sex$`Bisexual` <- ifelse( is.na( prop_cc_summary_age_sex$Heterosexual_point_estimate_2010 ), "",
                                               prop_cc_summary_age_sex$`Bisexual` )

prop_cc_summary_age_sex$`Otherᵇ` <- ifelse( is.na( prop_cc_summary_age_sex$Heterosexual_point_estimate_2010 ), "",
                                                   prop_cc_summary_age_sex$`Otherᵇ` )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 4 ) %>%
  add_column( temp3 = " ", .before = 7 ) %>%
  add_column( temp4 = " ", .before = 10 ) %>%
  add_column( temp5 = " ", .before = 13 )

names( prop_cc_summary_age_sex )[ names( prop_cc_summary_age_sex ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5" ) ] <- ""

colnames( prop_cc_summary_age_sex )[ colnames( prop_cc_summary_age_sex ) == "Nᵃ" ] <- ""
colnames( prop_cc_summary_age_sex )[ colnames( prop_cc_summary_age_sex ) == "Heterosexual" ] <- ""
colnames( prop_cc_summary_age_sex )[ colnames( prop_cc_summary_age_sex ) == "Homosexual" ] <- ""
colnames( prop_cc_summary_age_sex )[ colnames( prop_cc_summary_age_sex ) == "Bisexual" ] <- ""
colnames( prop_cc_summary_age_sex )[ colnames( prop_cc_summary_age_sex ) == "Otherᵇ" ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "#DF536B",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = c( "#2297E6", "#61D04F" )
  )

p_cc_age_sex <- forest(
  prop_cc_summary_age_sex[ , 1:15 ],
  
  est = list( prop_cc_summary_age_sex$Heterosexual_point_estimate_2010*100,
              prop_cc_summary_age_sex$Homosexual_point_estimate_2010*100,
              prop_cc_summary_age_sex$Bisexual_point_estimate_2010*100,
              prop_cc_summary_age_sex$Uncertain_point_estimate_2010*100,
              prop_cc_summary_age_sex$Heterosexual_point_estimate_2014*100,
              prop_cc_summary_age_sex$Homosexual_point_estimate_2014*100,
              prop_cc_summary_age_sex$Bisexual_point_estimate_2014*100,
              prop_cc_summary_age_sex$`None of the above_point_estimate_2014`*100,
              prop_cc_summary_age_sex$Heterosexual_point_estimate_2021*100,
              prop_cc_summary_age_sex$Homosexual_point_estimate_2021*100,
              prop_cc_summary_age_sex$Bisexual_point_estimate_2021*100,
              prop_cc_summary_age_sex$`None of the above_point_estimate_2021`*100
              ),
  
  lower = list( prop_cc_summary_age_sex$Heterosexual_lower_ci_2010*100,
                prop_cc_summary_age_sex$Homosexual_lower_ci_2010*100,
                prop_cc_summary_age_sex$Bisexual_lower_ci_2010*100,
                prop_cc_summary_age_sex$Uncertain_lower_ci_2010*100,
                prop_cc_summary_age_sex$Heterosexual_lower_ci_2014*100,
                prop_cc_summary_age_sex$Homosexual_lower_ci_2014*100,
                prop_cc_summary_age_sex$Bisexual_lower_ci_2014*100,
                prop_cc_summary_age_sex$`None of the above_lower_ci_2014`*100,
                prop_cc_summary_age_sex$Heterosexual_lower_ci_2021*100,
                prop_cc_summary_age_sex$Homosexual_lower_ci_2021*100,
                prop_cc_summary_age_sex$Bisexual_lower_ci_2021*100,
                prop_cc_summary_age_sex$`None of the above_lower_ci_2021`*100
                ),
  
  upper = list( prop_cc_summary_age_sex$Heterosexual_upper_ci_2010*100,
                prop_cc_summary_age_sex$Homosexual_upper_ci_2010*100,
                prop_cc_summary_age_sex$Bisexual_upper_ci_2010*100,
                prop_cc_summary_age_sex$Uncertain_upper_ci_2010*100,
                prop_cc_summary_age_sex$Heterosexual_upper_ci_2014*100,
                prop_cc_summary_age_sex$Homosexual_upper_ci_2014*100,
                prop_cc_summary_age_sex$Bisexual_upper_ci_2014*100,
                prop_cc_summary_age_sex$`None of the above_upper_ci_2014`*100,
                prop_cc_summary_age_sex$Heterosexual_upper_ci_2021*100,
                prop_cc_summary_age_sex$Homosexual_upper_ci_2021*100,
                prop_cc_summary_age_sex$Bisexual_upper_ci_2021*100,
                prop_cc_summary_age_sex$`None of the above_upper_ci_2021`*100
                ),
  
  ci_column = c( 5, 8, 11, 14 ),
  sizes = 0.4,
  
  ref_line = c( 
    prop_cc_summary[ prop_cc_summary$Subgroup == "Stockholm County", ]$Heterosexual_point_estimate_2010*100,
    prop_cc_summary[ prop_cc_summary$Subgroup == "Stockholm County", ]$Homosexual_point_estimate_2010*100,
    prop_cc_summary[ prop_cc_summary$Subgroup == "Stockholm County", ]$Bisexual_point_estimate_2010*100,
    prop_cc_summary[ prop_cc_summary$Subgroup == "Stockholm County", ]$Uncertain_point_estimate_2010*100
    ),
  
  xlim = list( c( 70, 100 ), c( 0, 5 ), c( 0, 15 ), c( 0, 15 ) ),
  ticks_at = list( c( 70, 80, 90, 100 ), c( 0, 1, 2, 3, 4, 5 ), c( 0, 5, 10, 15 ), c( 0, 5, 10, 15 ) ),
  
  xlab = "Proportion (%) (95% CI)",
  nudge_y = 0.33,
  theme = tm
 )

p_cc_age_sex <- edit_plot(p_cc_age_sex,
                          row = c(1, 6),
                          gp = gpar(fontface = "bold"))

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "SSᵃ",
  col = 3,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "Proportion (%) (95% CI)",
  col = 5:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "Proportion (%) (95% CI)",
  col = 8:9,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "Proportion (%) (95% CI)",
  col = 11:12,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "Proportion (%) (95% CI)",
  col = 14:15,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- insert_text(
  p_cc_age_sex,
  text = "Heterosexual",
  col = 5:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "Homosexual",
  col = 8:9,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "Bisexual",
  col = 11:12,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "Uncertain/Otherᵇ",
  col = 14:15,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- edit_plot( p_cc_age_sex,
                           row = c( 1, 6 ), 
                           which = "background",
                           gp = gpar( fill = "white" )
                           )

p_cc_age_sex <- edit_plot( p_cc_age_sex,
                           row = c( 2:5, 7:10 ), 
                           which = "background",
                           gp = gpar( fill = "#eff3f2" )
                           )

p_cc_age_sex <- add_border(
  p_cc_age_sex,
  part = "header",
  row = 2,
  col = c( 5:6, 8:9, 11:12, 14:15 ),
  where = "bottom",
  gp = gpar(lwd = 1)
)

plot( p_cc_age_sex )
```

#### 2.7. By generation and sex
```{r}
# datasets for proportion of sexual identity
prop_cc_summary_2010_generation <- read_excel(here("prop_cc_summary_2010.xlsx"))
prop_cc_summary_2014_generation <- read_excel(here("prop_cc_summary_2014.xlsx"))
prop_cc_summary_2021_generation <- read_excel(here("prop_cc_summary_2021.xlsx"))

prop_cc_summary_2010_generation <- prop_cc_summary_2010_generation %>% slice( 7:16 )
prop_cc_summary_2014_generation <- prop_cc_summary_2014_generation %>% slice( 7:18 )
prop_cc_summary_2021_generation <- prop_cc_summary_2021_generation %>% slice( 7:18 )

# merge datasets
prop_cc_summary_generation <- prop_cc_summary_2010_generation %>%
  full_join( prop_cc_summary_2014_generation, by = "subgroup" ) %>%
  full_join( prop_cc_summary_2021_generation, by = "subgroup" )

prop_cc_summary_generation <- prop_cc_summary_generation %>% 
  separate( subgroup, into = c( "generation", "sex" ), sep = "\\." )

# modify table format
desired_order <- c( "Generation Z (1997–2012)", "Millennials (1981–1996)", "Generation X (1965–1980)", "Baby Boomers (1946–1964)", "Silent Generation (1928–1945)", "Greatest Generation (1901–1927)" )

prop_cc_summary_generation <- prop_cc_summary_generation %>%
  mutate( generation = factor( generation, levels = desired_order ) ) %>%
  arrange( generation )

# convert to long format
long_data_generation <- prop_cc_summary_generation %>%
  select( generation, sex, contains( "point_estimate" ) ) %>%
  pivot_longer(
    cols = -c( generation, sex ),
    names_to = "year_identity",
    values_to = "proportion"
    ) %>%
  separate( year_identity, into = c( "identity", "year" ), sep = "_point_estimate_" )

long_data_generation <- long_data_generation %>%
  mutate( identity = if_else( identity %in% c( "Uncertain", "None of the above" ), "Other", identity ) ) %>%
  mutate( identity = factor( identity, levels = c( "Bisexual", "Homosexual", "Heterosexual", "Other" ) ) )

# plot
ggplot( drop_na( long_data_generation ),
        aes( x = year, y = proportion, color = generation, linetype = sex, group = interaction( generation, sex ) ) ) +
  
  geom_line( linewidth = 0.5 ) + 
  geom_point( size = 2 ) +
  
  scale_x_discrete( expand = c( 0.05, 0 ) ) +
  scale_y_continuous( labels = scales::percent ) +
  
  scale_color_manual( values = c( "#C77CFF", "#00BFC4", "#7CAE00", "#F8766D", "orange", "brown" ),
                      breaks = c( "Generation Z (1997–2012)", "Baby Boomers (1946–1964)", "Millennials (1981–1996)", "Silent Generation (1928–1945)", "Generation X (1965–1980)", "Greatest Generation (1901–1927)" ),
                      labels = c( "Generation Z (1997–2012)ᵇ   ", "Baby Boomers (1946–1964)   ", "Millennials (1981–1996)   ", "Silent Generation (1928–1945)   ", "Generation X (1965–1980)", "Greatest Generation (1901–1927)" ),
                      guide = guide_legend( nrow = 2 ) ) +
  
  scale_linetype_manual( values = c( "solid", "dotdash" ),
                         breaks = c( "Female", "Male" ),
                         guide = guide_legend( nrow = 2, order = 1 ) ) + 
  
  labs(
    x = "Survey Year",
    y = "Proportion" ) +
  
  theme_classic() +
  theme( axis.title.x = element_text( family = "Arial", size = 11 ),
         axis.text.x = element_text( family = "Arial", size = 11 ),
         axis.text.y = element_text( family = "Arial", size = 11 ),
         axis.title.y = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         legend.title = element_blank(),
         legend.position = "bottom",
         strip.background = element_blank(),
         strip.text = element_text( family = "Arial", size = 12 ),
         panel.spacing = unit( 2, "lines" ) ) +
  
  facet_wrap( ~ identity, 
              ncol = 2, 
              scales = "free_y",
              labeller = labeller( identity = c( "Homosexual" = "Homosexual Identity",
                                                 "Bisexual" = "Bisexual Identity",
                                                 "Heterosexual" = "Heterosexual Identity",
                                                 "Other" = "Other Identitiesᵃ" ) ) ) +
  ggh4x::facetted_pos_scales( y = list(
    identity == "Homosexual" ~ scale_y_continuous( labels = scales::percent, limits = c( 0, 0.04 ), breaks = c( 0, 0.01, 0.02, 0.03, 0.04 ) ),
    identity == "Bisexual" ~ scale_y_continuous( labels = scales::percent, limits = c( 0, 0.15 ), breaks = c( 0, 0.05, 0.1, 0.15 ) ),
    identity == "Heterosexual" ~ scale_y_continuous( labels = scales::percent, limits = c( 0.65, 1 ), breaks = c( 0.7, 0.8, 0.9, 1 ) ),
    identity == "Other" ~ scale_y_continuous( labels = scales::percent, limits = c( 0, 0.35 ), breaks = c( 0, 0.1, 0.2, 0.3 ) )
  ) ) 
```

#### 2.8. Proportion and proportion ratio by varing age cut-offs
##### 2.8.1. Prepare dataset for plotting
```{r}
prop_cc_age_iteration_2010 <- read_excel(here("prop_cc_age_iteration_2010.xlsx")) %>%
  select( "cut_off", "Heterosexual_young", "Homosexual_young", "Bisexual_young", "Uncertain_young", "Heterosexual_pr_2010", "Homosexual_pr_2010", "Bisexual_pr_2010", "Uncertain_pr_2010" ) %>%
  rename( 
    Heterosexual_prop_2010 = Heterosexual_young,
    Homosexual_prop_2010 = Homosexual_young,
    Bisexual_prop_2010 = Bisexual_young,
    Other_prop_2010 = Uncertain_young,
    Other_pr_2010 = Uncertain_pr_2010
    )

prop_cc_age_iteration_2014 <- read_excel(here("prop_cc_age_iteration_2014.xlsx")) %>%
  select( "cut_off", "Heterosexual_young", "Homosexual_young", "Bisexual_young", "None of the above_young", "Heterosexual_pr_2014", "Homosexual_pr_2014", "Bisexual_pr_2014", "None of the above_pr_2014" ) %>%
  rename( 
    Heterosexual_prop_2014 = Heterosexual_young,
    Homosexual_prop_2014 = Homosexual_young,
    Bisexual_prop_2014 = Bisexual_young,
    Other_prop_2014 = `None of the above_young`,
    Other_pr_2014 = `None of the above_pr_2014`
    )

prop_cc_age_iteration_2021 <- read_excel(here("prop_cc_age_iteration_2021.xlsx")) %>%
  select( "cut_off", "Heterosexual_young", "Homosexual_young", "Bisexual_young", "None of the above_young", "Heterosexual_pr_2021", "Homosexual_pr_2021", "Bisexual_pr_2021", "None of the above_pr_2021" ) %>%
  rename( 
    Heterosexual_prop_2021 = Heterosexual_young,
    Homosexual_prop_2021 = Homosexual_young,
    Bisexual_prop_2021 = Bisexual_young,
    Other_prop_2021 = `None of the above_young`,
    Other_pr_2021 = `None of the above_pr_2021`
    )

prop_cc_age_iteration_merged <- prop_cc_age_iteration_2010 %>%
  full_join( prop_cc_age_iteration_2014, by = "cut_off" ) %>%
  full_join( prop_cc_age_iteration_2021, by = "cut_off" )

long_data <- prop_cc_age_iteration_merged %>% 
  pivot_longer( 
    cols = - cut_off, 
    names_to = c( "Sexuality", "Age_Group", "Year" ), 
    names_pattern = "([A-Za-z]+)_(\\w+)_(\\d+)", 
    values_to = "Value" 
  )
```

##### 2.8.2. Proportion
```{r}
ggplot( long_data[ long_data$Age_Group == "prop", ], 
        aes( x = cut_off, y = Value, color = Sexuality, linetype = Year ) 
        ) +
  
  geom_line( ) +
  
  scale_linetype_manual( values = c( "2010" = "dotdash", "2014" = "dashed", "2021" = "solid" ),
                         labels = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ) 
                         ) +
  
  scale_color_manual( values = c( "#C77CFF", "#00BFC4", "#7CAE00", "#F8766D" ),
                      breaks = c( "Heterosexual", "Homosexual", "Bisexual", "Other" ),
                      labels = c( "Heterosexual", "Homosexual", "Bisexual", "Otherᶜ" )
                      ) +
  
  scale_x_continuous( limits = c( 15, 100 ), 
                      breaks = seq( 15, 100, by = 5 ),
                      expand = c( 0.02, 0 )
                      ) +
  
  scale_y_continuous( labels = scales::percent,
                      limits = c( 0, 1 ), 
                      breaks = c( 0, 0.02, 0.04, 0.06, 0.08, 0.1, 0.7, 0.8, 0.9, 1 )
                      ) +
  
  scale_y_break( c( 0.12, 0.75 ), scales = 1, space = 0.3, expand = c( 0, 0 ) ) +
  
  labs( x = "Age Cut-Off (Years)ᵃ", 
        y = "Proportionᵇ"
        ) +
  
  theme_classic() +
  
  theme( axis.text.y = element_text( family = "Arial", size = 11 ),
         axis.title.y = element_text( family = "Arial", size = 11 ),
         axis.title.x = element_text( family = "Arial", size = 11 ),
         axis.text.x = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         legend.position = "right",
         legend.title = element_blank(),
         axis.text.y.right = element_blank(),
         axis.ticks.y.right = element_blank(),
         axis.line.y.right = element_blank()
         )
```

##### 2.8.3. Proportion ratio
```{r}
ggplot( long_data[ long_data$Age_Group == "pr", ], 
        aes( x = cut_off, y = Value, color = Sexuality, linetype = Year ) 
        ) +
  
  geom_line( ) +
  
  scale_linetype_manual( values = c( "2010" = "dotdash", "2014" = "dashed", "2021" = "solid" ),
                         labels = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ) 
                         ) +
  
  scale_color_manual( values = c( "#C77CFF", "#00BFC4", "#7CAE00", "#F8766D" ),
                      breaks = c( "Heterosexual", "Homosexual", "Bisexual", "Other" ),
                      labels = c( "Heterosexual", "Homosexual", "Bisexual", "Otherᶜ" )
                      ) +
  
  scale_x_continuous( limits = c( 15, 65 ), 
                      breaks = c( 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65 ),
                      expand = c( 0.02, 0 )
                      ) +
  
  scale_y_continuous( limits = c( 0, 7 ), 
                      breaks = c( 0, 1, 2, 3, 4, 5, 6, 7 ),
                      expand = c( 0.04, 0 ) 
                      ) +
  
  labs( x = "Age cut-off (years)ᵃ", 
        y = "Proportion ratioᵇ"
        ) +
  
  theme_classic() +
  
  theme( axis.text.y = element_text( family = "Arial", size = 11 ),
         axis.title.y = element_text( family = "Arial", size = 11 ),
         axis.title.x = element_text( family = "Arial", size = 11 ),
         axis.text.x = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         legend.position = "right",
         legend.title = element_blank()
         )
```

#### 2.9. By age group and sex
##### 2.9.1. Prepare dataset for plotting
```{r}
prop_cc_age_group_2010 <- read_xlsx(here("prop_cc_age_group_sex_2010.xlsx")) %>%
  select( "subgroup", "Heterosexual_point_estimate_2010", "Homosexual_point_estimate_2010", "Bisexual_point_estimate_2010", "Uncertain_point_estimate_2010" ) %>%
  rename( Other_point_estimate_2010 = Uncertain_point_estimate_2010 )

prop_cc_age_group_2014 <- read_xlsx(here("prop_cc_age_group_sex_2014.xlsx")) %>%
  select( "subgroup", "Heterosexual_point_estimate_2014", "Homosexual_point_estimate_2014", "Bisexual_point_estimate_2014", "None of the above_point_estimate_2014" ) %>%
  rename( Other_point_estimate_2014 = `None of the above_point_estimate_2014` )

prop_cc_age_group_2021 <- read_xlsx(here("prop_cc_age_group_sex_2021.xlsx")) %>%
  select( "subgroup", "Heterosexual_point_estimate_2021", "Homosexual_point_estimate_2021", "Bisexual_point_estimate_2021", "None of the above_point_estimate_2021" ) %>%
  rename( Other_point_estimate_2021 = `None of the above_point_estimate_2021` )

prop_cc_age_group_2010$subgroup[ prop_cc_age_group_2010$subgroup == "[17,19].Female" ] <- "(17,19].Female"
prop_cc_age_group_2010$subgroup[ prop_cc_age_group_2010$subgroup == "[17,19].Male" ] <- "(17,19].Male"
prop_cc_age_group_2014$subgroup[ prop_cc_age_group_2014$subgroup == "[15,17].Female" ] <- "[16,17].Female"
prop_cc_age_group_2014$subgroup[ prop_cc_age_group_2014$subgroup == "[15,17].Male" ] <- "[16,17].Male"
prop_cc_age_group_2021$subgroup[ prop_cc_age_group_2021$subgroup == "[15,17].Female" ] <- "[16,17].Female"
prop_cc_age_group_2021$subgroup[ prop_cc_age_group_2021$subgroup == "[15,17].Male" ] <- "[16,17].Male"


prop_cc_age_group_merged <- prop_cc_age_group_2010 %>%
  full_join( prop_cc_age_group_2014, by = "subgroup" ) %>%
  full_join( prop_cc_age_group_2021, by = "subgroup" )

prop_cc_age_group_merged <- prop_cc_age_group_merged %>% 
  separate( subgroup, into = c( "subgroup", "sex" ), sep = "\\." )

new_subgroup_label <- function( label ) {
  if ( startsWith( label, "(" ) ) {
    nums <- as.numeric( unlist( strsplit( gsub( "[^0-9,]", "", label ), "," ) ) )
    new_label <- sprintf( "[%d,%d]", nums[1] + 1, nums[2] )
    return( new_label )
  } else {
    return( label )
  }
}

prop_cc_age_group_merged$new_subgroup <- sapply( prop_cc_age_group_merged$subgroup, new_subgroup_label )

prop_cc_age_group_merged <- prop_cc_age_group_merged %>% relocate( new_subgroup, .after = subgroup )

age_group_order <- c( "[16,17]", "[18,19]", "[20,21]", "[22,23]", "[24,25]", "[26,27]", "[28,29]", "[30,31]", 
                      "[32,33]", "[34,35]", "[36,37]", "[38,39]", "[40,41]", "[42,43]", "[44,45]", "[46,47]", 
                      "[48,49]", "[50,51]", "[52,53]", "[54,55]", "[56,57]", "[58,59]", "[60,61]", "[62,63]", 
                      "[64,65]", "[66,67]", "[68,69]", "[70,71]", "[72,73]", "[74,75]", "[76,77]", "[78,79]" )

prop_cc_age_group_merged$new_subgroup <- factor( prop_cc_age_group_merged$new_subgroup, levels = age_group_order )

long_data_age_group <- prop_cc_age_group_merged %>% 
  pivot_longer( 
    cols = - c( subgroup, new_subgroup, sex ), 
    names_to = c( "Sexuality", "Estimate_Type", "Year" ), 
    names_pattern = "([A-Za-z]+)_(\\w+)_(\\d+)", 
    values_to = "Value" 
  )
```

##### 2.9.2. Plotting
```{r}
ggplot( long_data_age_group %>%
          filter( Sexuality %in% c( "Bisexual", "Homosexual" ) ), 
        aes( x = new_subgroup, y = Value, color = sex, linetype = Year,  group = interaction( sex, Year ) ) ) +
  
  geom_line( linewidth = 0.5 ) +
  
  scale_y_continuous( labels = scales::percent ) +
  
  scale_linetype_manual( values = c( "dotdash", "dashed", "solid" ),
                         breaks = c( "2010", "2014", "2021" ),
                         labels = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
                         guide = guide_legend( nrow = 1 )
  ) +
  
  scale_color_manual( values = c( "#F8766D", "#00BFC4" ),
                      breaks = c( "Female", "Male"),
                      guide = guide_legend( nrow = 1 ) ) +
  
  labs( x = "Age Group (Years)ᵃ", 
        y = "Proportion"
  ) +
  
  theme_classic() +
  theme( axis.title.x = element_text( family = "Arial", size = 11 ),
         axis.text.x = element_text( family = "Arial", size = 11, angle = 45, vjust = 0.5, hjust = 0.5 ),
         axis.text.y = element_text( family = "Arial", size = 11 ),
         axis.title.y = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         legend.title = element_blank(),
         legend.position = "bottom",
         strip.background = element_blank(),
         strip.text = element_text( family = "Arial", size = 12 ),
         panel.spacing = unit( 2, "lines" ) ) +
  
  facet_wrap( ~ Sexuality,
              ncol = 1, 
              scales = "free_y",
              labeller = labeller( Sexuality = c( "Homosexual" = "Homosexual Identity",
                                                  "Bisexual" = "Bisexual Identity" ) ) ) +
  
  ggh4x::facetted_pos_scales( y = list(
    Sexuality == "Homosexual" ~ scale_y_continuous( labels = scales::percent, limits = c( 0, 0.08 ), breaks = c( 0, 0.02, 0.04, 0.06, 0.08 ) ),
    Sexuality == "Bisexual" ~ scale_y_continuous( labels = scales::percent, limits = c( 0, 0.2 ), breaks = c( 0, 0.05, 0.1, 0.15, 0.2 ) )
  ) )


ggplot( long_data_age_group %>%
          filter( Sexuality %in% c( "Heterosexual", "Other" ) ), 
        aes( x = new_subgroup, y = Value, color = sex, linetype = Year,  group = interaction( sex, Year ) ) ) +
  
  geom_line( linewidth = 0.5 ) +
  
  scale_y_continuous( labels = scales::percent ) +
  
  scale_linetype_manual( values = c( "dotdash", "dashed", "solid" ),
                         breaks = c( "2010", "2014", "2021" ),
                         labels = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
                         guide = guide_legend( nrow = 1 )
  ) +
  
  scale_color_manual( values = c( "#F8766D", "#00BFC4" ),
                      breaks = c( "Female", "Male"),
                      guide = guide_legend( nrow = 1 ) ) +
  
  labs( x = "Age Group (Years)ᵃ", 
        y = "Proportion"
  ) +
  
  theme_classic() +
  theme( axis.title.x = element_text( family = "Arial", size = 11 ),
         axis.text.x = element_text( family = "Arial", size = 11, angle = 45, vjust = 0.5, hjust = 0.5 ),
         axis.text.y = element_text( family = "Arial", size = 11 ),
         axis.title.y = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         legend.title = element_blank(),
         legend.position = "bottom",
         strip.background = element_blank(),
         strip.text = element_text( family = "Arial", size = 12 ),
         panel.spacing = unit( 2, "lines" ) ) +
  
  facet_wrap( ~ Sexuality,
              ncol = 1, 
              scales = "free_y",
              labeller = labeller( Sexuality = c( "Heterosexual" = "Heterosexual Identity",
                                                  "Other" = "Other Identitiesᵇ" ) ) ) +
  
  ggh4x::facetted_pos_scales( y = list(
    Sexuality == "Heterosexual" ~ scale_y_continuous( labels = scales::percent, limits = c( 0.6, 1 ), breaks = c( 0.6, 0.7, 0.8, 0.9, 1 ) ),
    Sexuality == "Other" ~ scale_y_continuous( labels = scales::percent, limits = c( 0, 0.2 ), breaks = c( 0, 0.05, 0.1, 0.15, 0.2 ) )
  ) )
```

### 3. Plots for Relation between Sexual Identity and Demographic Factors
#### 3.1. Prepare dataset for plotting
```{r}
results_cc_pr_poisson_2010 <- read_xlsx(here("results_cc_pr_poisson_2010.xlsx"))

results_cc_pr_poisson_2014 <- read_xlsx(here("results_cc_pr_poisson_2014.xlsx"))

results_cc_pr_poisson_2021 <- read_xlsx(here("results_cc_pr_poisson_2021.xlsx"))

colnames(results_cc_pr_poisson_2010)[-1] <- paste0(colnames(results_cc_pr_poisson_2010)[-1], "_2010")
colnames(results_cc_pr_poisson_2014)[-1] <- paste0(colnames(results_cc_pr_poisson_2014)[-1], "_2014")
colnames(results_cc_pr_poisson_2021)[-1] <- paste0(colnames(results_cc_pr_poisson_2021)[-1], "_2021")

# to make it easier to combine across datasets
# a note on these changes will be added on the graph later
results_cc_pr_poisson_2010$Exposure[ results_cc_pr_poisson_2010$Exposure == "age_exp18-29" ] <- "age_exp16-29"
results_cc_pr_poisson_2010$Exposure[ results_cc_pr_poisson_2010$Exposure == "age_exp18-29_Male" ] <- "age_exp16-29_Male"
results_cc_pr_poisson_2010$Exposure[ results_cc_pr_poisson_2010$Exposure == "age_exp18-29_Female" ] <- "age_exp16-29_Female"

# merge datasets
results_cc_pr_poisson <- results_cc_pr_poisson_2010 %>%
  full_join( results_cc_pr_poisson_2014, by = "Exposure" ) %>%
  full_join( results_cc_pr_poisson_2021, by = "Exposure" )

# modify table format
desired_order <- c( "sex_expFemale", "age_exp16-29", "age_exp30-44", "age_exp>=60", "age_exp16-29_Male", "age_exp30-44_Male", "age_exp>=60_Male", "age_exp16-29_Female", "age_exp30-44_Female", "age_exp>=60_Female", "country_of_birth_expEurope", "country_of_birth_expOutside Europe", "education_exp<=9 years", "education_exp10-12 years", "education_exp<=9 years_Male", "education_exp10-12 years_Male", "education_exp<=9 years_Female", "education_exp10-12 years_Female", "income_exp<=2,500", "income_exp(2,500, 3,500]", "income_exp(3,500, 4,500]", "income_exp<=2,500_Male", "income_exp(2,500, 3,500]_Male", "income_exp(3,500, 4,500]_Male", "income_exp<=2,500_Female", "income_exp(2,500, 3,500]_Female", "income_exp(3,500, 4,500]_Female", "marital_status_expNever married", "marital_status_expOther", "living_status_expyes", "personal_support_expno" )
                    
results_cc_pr_poisson <- results_cc_pr_poisson %>%
  mutate( Exposure = factor( Exposure, levels = desired_order ) ) %>%
  arrange( Exposure )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Sex", .before = 1 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Age group", .before = 3 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Country of birth", .before = 13 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Education years", .before = 16 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Income (100 kr/yr)ᶠ", .before = 23 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Marital statusᵍ", .before = 33 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Living alone", .before = 36 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Personal support", .before = 38 )

results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "sex_expFemale" ] <- paste0( "   ", "Female\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "age_exp16-29" ] <- paste0( "   ", "16–29 yrsᵈ\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "age_exp30-44" ] <- paste0( "   ", "30–44 yrs\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "age_exp>=60" ] <- paste0( "   ", "\u2265 60 yrs\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "country_of_birth_expEurope" ] <- paste0( "   ", "Europeᵉ\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "country_of_birth_expOutside Europe" ] <- paste0( "   ", "Outside Europe\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "education_exp<=9 years" ] <- paste0( "   ", "\u2264 9 yrs\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "education_exp10-12 years" ] <- paste0( "   ", "10–12 yrs\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "income_exp<=2,500" ] <- paste0( "   ", "\u2264 2,500\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "income_exp(2,500, 3,500]" ] <- paste0( "   ", "(2,500, 3,500]\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "income_exp(3,500, 4,500]" ] <- paste0( "   ", "(3,500, 4,500]\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "marital_status_expNever married" ] <- paste0( "   ", "Never married\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "marital_status_expOther" ] <- paste0( "   ", "Other\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "living_status_expyes" ] <- paste0( "   ", "Yes\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "personal_support_expno" ] <- paste0( "   ", "No\n\n" )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2010_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_crude_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_crude_2010 ), ")" ),
    .before = 2 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2010_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_model_1_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_model_1_2010 ), ")" ),
    .before = 3 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2010_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_model_2_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_model_2_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_model_2_2010 ), ")" ),
    .before = 4 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2010_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_crude_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_crude_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_crude_2010 ), ")" ),
    .before = 5 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2010_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_model_1_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_model_1_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_model_1_2010 ), ")" ),
    .before = 6 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2010_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_model_2_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_model_2_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_model_2_2010 ), ")" ),
    .before = 7 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2010_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_crude_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_crude_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_crude_2010 ), ")" ),
    .before = 8 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2010_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_model_1_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_model_1_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_model_1_2010 ), ")" ),
    .before = 9 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2010_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_model_2_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_model_2_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_model_2_2010 ), ")" ),
    .before = 10 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2010_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_crude_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_crude_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_crude_2010 ), ")" ),
    .before = 11 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2010_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_model_1_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_model_1_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_model_1_2010 ), ")" ),
    .before = 12 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2010_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_model_2_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_model_2_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_model_2_2010 ), ")" ),
    .before = 13 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2014_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_crude_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_crude_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_crude_2014 ), ")" ),
    .before = 14 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2014_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_model_1_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_model_1_2014 ), ")" ),
    .before = 15 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2014_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_model_2_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_model_2_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_model_2_2014 ), ")" ),
    .before = 16 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2014_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_crude_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_crude_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_crude_2014 ), ")" ),
    .before = 17 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2014_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_model_1_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_model_1_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_model_1_2014 ), ")" ),
    .before = 18 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2014_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_model_2_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_model_2_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_model_2_2014 ), ")" ),
    .before = 19 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2014_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_crude_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_crude_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_crude_2014 ), ")" ),
    .before = 20 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2014_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_model_1_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_model_1_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_model_1_2014 ), ")" ),
    .before = 21 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2014_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_model_2_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_model_2_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_model_2_2014 ), ")" ),
    .before = 22 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2014_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_crude_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_crude_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_crude_2014 ), ")" ),
    .before = 23 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2014_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_model_1_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_model_1_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_model_1_2014 ), ")" ),
    .before = 24 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2014_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_model_2_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_model_2_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_model_2_2014 ), ")" ),
    .before = 25 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2021_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_crude_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_crude_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_crude_2021 ), ")" ),
    .before = 26 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2021_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_model_1_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_model_1_2021 ), ")" ),
    .before = 27 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2021_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_model_2_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_model_2_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_model_2_2021 ), ")" ),
    .before = 28 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2021_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_crude_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_crude_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_crude_2021 ), ")" ),
    .before = 29 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2021_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_model_1_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_model_1_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_model_1_2021 ), ")" ),
    .before = 30 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2021_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_model_2_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_model_2_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_model_2_2021 ), ")" ),
    .before = 31 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2021_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_crude_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_crude_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_crude_2021 ), ")" ),
    .before = 32 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2021_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_model_1_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_model_1_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_model_1_2021 ), ")" ),
    .before = 33 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2021_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_model_2_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_model_2_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_model_2_2021 ), ")" ),
    .before = 34 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2021_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_crude_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_crude_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_crude_2021 ), ")" ),
    .before = 35 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2021_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_model_1_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_model_1_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_model_1_2021 ), ")" ),
    .before = 36 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2021_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_model_2_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_model_2_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_model_2_2021 ), ")" ),
    .before = 37 )


results_cc_pr_poisson$Sexual_minority_2021_crude <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Sexual_minority_2021_crude )

results_cc_pr_poisson$Sexual_minority_2021_model_1 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Sexual_minority_2021_model_1 )

results_cc_pr_poisson$Sexual_minority_2021_model_2 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Sexual_minority_2021_model_2 )

results_cc_pr_poisson$Homosexual_2021_crude <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Homosexual_2021_crude )

results_cc_pr_poisson$Homosexual_2021_model_1 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Homosexual_2021_model_1 )

results_cc_pr_poisson$Homosexual_2021_model_2 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Homosexual_2021_model_2 )

results_cc_pr_poisson$Bisexual_2021_crude <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Bisexual_2021_crude )

results_cc_pr_poisson$Bisexual_2021_model_1 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Bisexual_2021_model_1 )

results_cc_pr_poisson$Bisexual_2021_model_2 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Bisexual_2021_model_2 )

results_cc_pr_poisson$Other_2021_crude <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Other_2021_crude )

results_cc_pr_poisson$Other_2021_model_1 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Other_2021_model_1 )

results_cc_pr_poisson$Other_2021_model_2 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Other_2021_model_2 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_crude" = paste( results_cc_pr_poisson$Sexual_minority_2010_crude,
                                               results_cc_pr_poisson$Sexual_minority_2014_crude,
                                               results_cc_pr_poisson$Sexual_minority_2021_crude,
                                               sep = "\n" ),
              .before = 2 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_model_1" = paste( results_cc_pr_poisson$Sexual_minority_2010_model_1,
                                                 results_cc_pr_poisson$Sexual_minority_2014_model_1,
                                                 results_cc_pr_poisson$Sexual_minority_2021_model_1,
                                                 sep = "\n" ),
              .before = 3 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_model_2" = paste( results_cc_pr_poisson$Sexual_minority_2010_model_2,
                                                 results_cc_pr_poisson$Sexual_minority_2014_model_2,
                                                 results_cc_pr_poisson$Sexual_minority_2021_model_2,
                                                 sep = "\n" ),
              .before = 4 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_crude" = paste( results_cc_pr_poisson$Homosexual_2010_crude,
                                          results_cc_pr_poisson$Homosexual_2014_crude,
                                          results_cc_pr_poisson$Homosexual_2021_crude,
                                          sep = "\n" ),
              .before = 5 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_model_1" = paste( results_cc_pr_poisson$Homosexual_2010_model_1,
                                            results_cc_pr_poisson$Homosexual_2014_model_1,
                                            results_cc_pr_poisson$Homosexual_2021_model_1,
                                            sep = "\n" ),
              .before = 6 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_model_2" = paste( results_cc_pr_poisson$Homosexual_2010_model_2,
                                            results_cc_pr_poisson$Homosexual_2014_model_2,
                                            results_cc_pr_poisson$Homosexual_2021_model_2,
                                            sep = "\n" ),
              .before = 7 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_crude" = paste( results_cc_pr_poisson$Bisexual_2010_crude,
                                        results_cc_pr_poisson$Bisexual_2014_crude,
                                        results_cc_pr_poisson$Bisexual_2021_crude,
                                        sep = "\n" ),
              .before = 8 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_model_1" = paste( results_cc_pr_poisson$Bisexual_2010_model_1,
                                          results_cc_pr_poisson$Bisexual_2014_model_1,
                                          results_cc_pr_poisson$Bisexual_2021_model_1,
                                          sep = "\n" ),
              .before = 9 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_model_2" = paste( results_cc_pr_poisson$Bisexual_2010_model_2,
                                          results_cc_pr_poisson$Bisexual_2014_model_2,
                                          results_cc_pr_poisson$Bisexual_2021_model_2,
                                          sep = "\n" ),
              .before = 10 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_crude" = paste( results_cc_pr_poisson$Other_2010_crude,
                                     results_cc_pr_poisson$Other_2014_crude,
                                     results_cc_pr_poisson$Other_2021_crude,
                                     sep = "\n" ),
              .before = 11 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_model_1" = paste( results_cc_pr_poisson$Other_2010_model_1,
                                       results_cc_pr_poisson$Other_2014_model_1,
                                       results_cc_pr_poisson$Other_2021_model_1,
                                       sep = "\n" ),
              .before = 12 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_model_2" = paste( results_cc_pr_poisson$Other_2010_model_2,
                                       results_cc_pr_poisson$Other_2014_model_2,
                                       results_cc_pr_poisson$Other_2021_model_2,
                                       sep = "\n" ),
              .before = 13 )


results_cc_pr_poisson$Sexual_minority_crude <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Sexual_minority_crude )

results_cc_pr_poisson$Sexual_minority_model_1 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Sexual_minority_model_1 )

results_cc_pr_poisson$Sexual_minority_model_2 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Sexual_minority_model_2 )

results_cc_pr_poisson$Homosexual_crude <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Homosexual_crude )

results_cc_pr_poisson$Homosexual_model_1 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Homosexual_model_1 )

results_cc_pr_poisson$Homosexual_model_2 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Homosexual_model_2 )

results_cc_pr_poisson$Bisexual_crude <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Bisexual_crude )

results_cc_pr_poisson$Bisexual_model_1 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Bisexual_model_1 )

results_cc_pr_poisson$Bisexual_model_2 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Bisexual_model_2 )

results_cc_pr_poisson$Other_crude <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Other_crude )

results_cc_pr_poisson$Other_model_1 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Other_model_1 )

results_cc_pr_poisson$Other_model_2 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Other_model_2 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "Male" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 2 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "45–59 yrs" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 7 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "Sweden" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 16 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "\u2265 13 yrs" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 22 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "> 4,500" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 31 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "Currently married" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 39 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "No" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 44 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "Yes" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 46 )
```

#### 3.2. Sexual minority group
##### 3.2.1. Part 1
```{r}
selected_cols <- grep( "exposure|sexual_minority", colnames( results_cc_pr_poisson ), ignore.case = TRUE )

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson[ -c( 9:14, 23:47 ), selected_cols ]

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_sexual_minority )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_sexual_minority )[ names( results_cc_pr_poisson_sexual_minority ) %in% c( "temp1", "temp2", "temp3", "Sexual_minority_crude", "Sexual_minority_model_1", "Sexual_minority_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
  )

p_cc_pr_poisson_sexual_minority <- forest(
  results_cc_pr_poisson_sexual_minority[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_crude_2010,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_1_2010,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_crude_2014,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_1_2014,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_crude_2021,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_1_2021,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_2_2021
              ),
  
  lower = list( results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_crude_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_1_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_crude_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_1_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_crude_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_1_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_2_2021
                ),
  
  upper = list( results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_crude_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_1_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_crude_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_1_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_crude_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_1_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_2_2021
                ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 4, 9, 13 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
                                              )

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- insert_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Sexual Minoritiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 4, 9, 13 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
                                              )

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 2, 3, 5:8, 10:12, 14:16 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
                                              )

p_cc_pr_poisson_sexual_minority <- add_border(
  p_cc_pr_poisson_sexual_minority,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_sexual_minority )
```

##### 3.2.2. Part 2
```{r}
results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson[ -c( 1:26, 32:37 ), selected_cols ]

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_sexual_minority )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_sexual_minority )[ names( results_cc_pr_poisson_sexual_minority ) %in% c( "temp1", "temp2", "temp3", "Sexual_minority_crude", "Sexual_minority_model_1", "Sexual_minority_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
  )

p_cc_pr_poisson_sexual_minority <- forest(
  results_cc_pr_poisson_sexual_minority[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_crude_2010,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_1_2010,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_crude_2014,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_1_2014,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_crude_2021,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_1_2021,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_2_2021
              ),
  
  lower = list( results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_crude_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_1_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_crude_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_1_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_crude_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_1_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_2_2021
                ),
  
  upper = list( results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_crude_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_1_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_crude_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_1_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_crude_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_1_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_2_2021
                ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 6, 10, 13 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- insert_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Sexual Minoritiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 6, 10, 13 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
                                              )

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 2:5, 7:9, 11, 12, 14, 15 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
                                              )

p_cc_pr_poisson_sexual_minority <- add_border(
  p_cc_pr_poisson_sexual_minority,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_sexual_minority )
```

#### 3.3. Homosexual group
##### 3.3.1. Part 1
```{r}
selected_cols <- grep( "exposure|homosexual", colnames( results_cc_pr_poisson ), ignore.case = TRUE )

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson[ -c( 9:14, 23:47 ), selected_cols ]

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_homosexual )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_homosexual )[ names( results_cc_pr_poisson_homosexual ) %in% c( "temp1", "temp2", "temp3", "Homosexual_crude", "Homosexual_model_1", "Homosexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_homosexual <- forest(
  results_cc_pr_poisson_homosexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_homosexual$homosexual_point_estimate_crude_2010,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_crude_2014,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_crude_2021,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_homosexual$homosexual_lower_ci_crude_2010,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_crude_2014,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_crude_2021,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_homosexual$homosexual_upper_ci_crude_2010,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_crude_2014,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_crude_2021,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                              row = c( 1, 4, 9, 13 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- insert_text(
  p_cc_pr_poisson_homosexual,
  text = "Homosexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                              row = c( 1, 4, 9, 13 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                              row = c( 2, 3, 5:8, 10:12, 14:16 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_homosexual <- add_border(
  p_cc_pr_poisson_homosexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_homosexual )
```

##### 3.3.2. Part 2
```{r}
results_cc_pr_poisson_homosexual <- results_cc_pr_poisson[ -c( 1:26, 32:37 ), selected_cols ]

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_homosexual )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_homosexual )[ names( results_cc_pr_poisson_homosexual ) %in% c( "temp1", "temp2", "temp3", "Homosexual_crude", "Homosexual_model_1", "Homosexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_homosexual <- forest(
  results_cc_pr_poisson_homosexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_homosexual$homosexual_point_estimate_crude_2010,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_crude_2014,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_crude_2021,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_homosexual$homosexual_lower_ci_crude_2010,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_crude_2014,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_crude_2021,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_homosexual$homosexual_upper_ci_crude_2010,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_crude_2014,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_crude_2021,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                         row = c( 1, 6, 10, 13 ),
                                         col = 1,
                                         gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- insert_text(
  p_cc_pr_poisson_homosexual,
  text = "Homosexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                         row = c( 1, 6, 10, 13 ), 
                                         which = "background",
                                         gp = gpar( fill = "white" )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                         row = c( 2:5, 7:9, 11, 12, 14, 15 ), 
                                         which = "background",
                                         gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_homosexual <- add_border(
  p_cc_pr_poisson_homosexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_homosexual )
```

#### 3.4. Bisexual group
##### 3.4.1. Part 1
```{r}
selected_cols <- grep( "exposure|bisexual", colnames( results_cc_pr_poisson ), ignore.case = TRUE )

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson[ -c( 9:14, 23:47 ), selected_cols ]

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_bisexual )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_bisexual )[ names( results_cc_pr_poisson_bisexual ) %in% c( "temp1", "temp2", "temp3", "Bisexual_crude", "Bisexual_model_1", "Bisexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_bisexual <- forest(
  results_cc_pr_poisson_bisexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_bisexual$bisexual_point_estimate_crude_2010,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_crude_2014,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_crude_2021,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_bisexual$bisexual_lower_ci_crude_2010,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_crude_2014,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_crude_2021,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_bisexual$bisexual_upper_ci_crude_2010,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_crude_2014,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_crude_2021,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 8 ),
  ticks_at = c( 0, 1, 2, 4, 6, 8 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                         row = c( 1, 4, 9, 13 ),
                                         col = 1,
                                         gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- insert_text(
  p_cc_pr_poisson_bisexual,
  text = "Bisexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                         row = c( 1, 4, 9, 13 ), 
                                         which = "background",
                                         gp = gpar( fill = "white" )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                         row = c( 2, 3, 5:8, 10:12, 14:16 ), 
                                         which = "background",
                                         gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_bisexual <- add_border(
  p_cc_pr_poisson_bisexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_bisexual )
```

##### 3.4.2. Part 2
```{r}
results_cc_pr_poisson_bisexual <- results_cc_pr_poisson[ -c( 1:26, 32:37 ), selected_cols ]

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_bisexual )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_bisexual )[ names( results_cc_pr_poisson_bisexual ) %in% c( "temp1", "temp2", "temp3", "Bisexual_crude", "Bisexual_model_1", "Bisexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_bisexual <- forest(
  results_cc_pr_poisson_bisexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_bisexual$bisexual_point_estimate_crude_2010,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_crude_2014,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_crude_2021,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_bisexual$bisexual_lower_ci_crude_2010,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_crude_2014,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_crude_2021,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_bisexual$bisexual_upper_ci_crude_2010,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_crude_2014,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_crude_2021,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 8 ),
  ticks_at = c( 0, 1, 2, 4, 6, 8 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                       row = c( 1, 6, 10, 13 ),
                                       col = 1,
                                       gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- insert_text(
  p_cc_pr_poisson_bisexual,
  text = "Bisexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                       row = c( 1, 6, 10, 13 ), 
                                       which = "background",
                                       gp = gpar( fill = "white" )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                       row = c( 2:5, 7:9, 11, 12, 14, 15 ), 
                                       which = "background",
                                       gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_bisexual <- add_border(
  p_cc_pr_poisson_bisexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_bisexual )
```

#### 3.5. Other group
##### 3.5.1. Part 1
```{r}
selected_cols <- grep( "exposure|other", colnames( results_cc_pr_poisson ), ignore.case = TRUE )

results_cc_pr_poisson_other <- results_cc_pr_poisson[ -c( 9:14, 23:47 ), selected_cols ]

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_other )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_other )[ names( results_cc_pr_poisson_other ) %in% c( "temp1", "temp2", "temp3", "Other_crude", "Other_model_1", "Other_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_other <- forest(
  results_cc_pr_poisson_other[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_other$other_point_estimate_crude_2010,
              results_cc_pr_poisson_other$other_point_estimate_model_1_2010,
              results_cc_pr_poisson_other$other_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_other$other_point_estimate_crude_2014,
              results_cc_pr_poisson_other$other_point_estimate_model_1_2014,
              results_cc_pr_poisson_other$other_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_other$other_point_estimate_crude_2021,
              results_cc_pr_poisson_other$other_point_estimate_model_1_2021,
              results_cc_pr_poisson_other$other_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_other$other_lower_ci_crude_2010,
                results_cc_pr_poisson_other$other_lower_ci_model_1_2010,
                results_cc_pr_poisson_other$other_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_other$other_lower_ci_crude_2014,
                results_cc_pr_poisson_other$other_lower_ci_model_1_2014,
                results_cc_pr_poisson_other$other_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_other$other_lower_ci_crude_2021,
                results_cc_pr_poisson_other$other_lower_ci_model_1_2021,
                results_cc_pr_poisson_other$other_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_other$other_upper_ci_crude_2010,
                results_cc_pr_poisson_other$other_upper_ci_model_1_2010,
                results_cc_pr_poisson_other$other_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_other$other_upper_ci_crude_2014,
                results_cc_pr_poisson_other$other_upper_ci_model_1_2014,
                results_cc_pr_poisson_other$other_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_other$other_upper_ci_crude_2021,
                results_cc_pr_poisson_other$other_upper_ci_model_1_2021,
                results_cc_pr_poisson_other$other_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 10 ),
  ticks_at = c( 0, 1, 2, 4, 6, 8, 10 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                       row = c( 1, 4, 9, 13 ),
                                       col = 1,
                                       gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- insert_text(
  p_cc_pr_poisson_other,
  text = "Uncertain/Other Sexual Identitiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                       row = c( 1, 4, 9, 13 ), 
                                       which = "background",
                                       gp = gpar( fill = "white" )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                       row = c( 2, 3, 5:8, 10:12, 14:16 ), 
                                       which = "background",
                                       gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_other <- add_border(
  p_cc_pr_poisson_other,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_other )
```

##### 3.5.2. Part 2
```{r}
results_cc_pr_poisson_other <- results_cc_pr_poisson[ -c( 1:26, 32:37 ), selected_cols ]

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_other )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_other )[ names( results_cc_pr_poisson_other ) %in% c( "temp1", "temp2", "temp3", "Other_crude", "Other_model_1", "Other_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_other <- forest(
  results_cc_pr_poisson_other[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_other$other_point_estimate_crude_2010,
              results_cc_pr_poisson_other$other_point_estimate_model_1_2010,
              results_cc_pr_poisson_other$other_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_other$other_point_estimate_crude_2014,
              results_cc_pr_poisson_other$other_point_estimate_model_1_2014,
              results_cc_pr_poisson_other$other_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_other$other_point_estimate_crude_2021,
              results_cc_pr_poisson_other$other_point_estimate_model_1_2021,
              results_cc_pr_poisson_other$other_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_other$other_lower_ci_crude_2010,
                results_cc_pr_poisson_other$other_lower_ci_model_1_2010,
                results_cc_pr_poisson_other$other_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_other$other_lower_ci_crude_2014,
                results_cc_pr_poisson_other$other_lower_ci_model_1_2014,
                results_cc_pr_poisson_other$other_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_other$other_lower_ci_crude_2021,
                results_cc_pr_poisson_other$other_lower_ci_model_1_2021,
                results_cc_pr_poisson_other$other_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_other$other_upper_ci_crude_2010,
                results_cc_pr_poisson_other$other_upper_ci_model_1_2010,
                results_cc_pr_poisson_other$other_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_other$other_upper_ci_crude_2014,
                results_cc_pr_poisson_other$other_upper_ci_model_1_2014,
                results_cc_pr_poisson_other$other_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_other$other_upper_ci_crude_2021,
                results_cc_pr_poisson_other$other_upper_ci_model_1_2021,
                results_cc_pr_poisson_other$other_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 10 ),
  ticks_at = c( 0, 1, 2, 4, 6, 8, 10 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                    row = c( 1, 6, 10, 13 ),
                                    col = 1,
                                    gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- insert_text(
  p_cc_pr_poisson_other,
  text = "Uncertain/Other Sexual Identitiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                    row = c( 1, 6, 10, 13 ), 
                                    which = "background",
                                    gp = gpar( fill = "white" )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                    row = c( 2:5, 7:9, 11, 12, 14, 15 ), 
                                    which = "background",
                                    gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_other <- add_border(
  p_cc_pr_poisson_other,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_other )
```

#### 3.6. Age by sex
##### 3.6.1. Prepare dataset for plotting
```{r}
results_cc_pr_poisson_age_sex <- results_cc_pr_poisson[ c( 9:14 ), ]

results_cc_pr_poisson_age_sex <- results_cc_pr_poisson_age_sex %>% 
  add_row( Exposure = "Male", .before = 1 )

results_cc_pr_poisson_age_sex <- results_cc_pr_poisson_age_sex %>% 
  add_row( Exposure = "Female", .before = 5 )

results_cc_pr_poisson_age_sex$Exposure[ results_cc_pr_poisson_age_sex$Exposure == "age_exp16-29_Male" ] <- paste0( "   ", "16–29 yrsᵈ\n\n" )
results_cc_pr_poisson_age_sex$Exposure[ results_cc_pr_poisson_age_sex$Exposure == "age_exp30-44_Male" ] <- paste0( "   ", "30–44 yrs\n\n" )
results_cc_pr_poisson_age_sex$Exposure[ results_cc_pr_poisson_age_sex$Exposure == "age_exp>=60_Male" ] <- paste0( "   ", "\u2265 60 yrs\n\n" )

results_cc_pr_poisson_age_sex$Exposure[ results_cc_pr_poisson_age_sex$Exposure == "age_exp16-29_Female" ] <- paste0( "   ", "16–29 yrsᵈ\n\n" )
results_cc_pr_poisson_age_sex$Exposure[ results_cc_pr_poisson_age_sex$Exposure == "age_exp30-44_Female" ] <- paste0( "   ", "30–44 yrs\n\n" )
results_cc_pr_poisson_age_sex$Exposure[ results_cc_pr_poisson_age_sex$Exposure == "age_exp>=60_Female" ] <- paste0( "   ", "\u2265 60 yrs\n\n" )

results_cc_pr_poisson_age_sex <- results_cc_pr_poisson_age_sex %>% 
  add_row( Exposure = paste0( "   ", "45–59 yrs" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 4 )

results_cc_pr_poisson_age_sex <- results_cc_pr_poisson_age_sex %>% 
  add_row( Exposure = paste0( "   ", "45–59 yrs" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 9 )

results_cc_pr_poisson_age_sex$Sexual_minority_crude <- ifelse( is.na( results_cc_pr_poisson_age_sex$Sexual_minority_crude ), "",
                                                      results_cc_pr_poisson_age_sex$Sexual_minority_crude )

results_cc_pr_poisson_age_sex$Sexual_minority_model_1 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Sexual_minority_model_1 ), "",
                                                      results_cc_pr_poisson_age_sex$Sexual_minority_model_1 )

results_cc_pr_poisson_age_sex$Sexual_minority_model_2 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Sexual_minority_model_2 ), "",
                                                      results_cc_pr_poisson_age_sex$Sexual_minority_model_2 )

results_cc_pr_poisson_age_sex$Homosexual_crude <- ifelse( is.na( results_cc_pr_poisson_age_sex$Homosexual_crude ), "",
                                                      results_cc_pr_poisson_age_sex$Homosexual_crude )

results_cc_pr_poisson_age_sex$Homosexual_model_1 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Homosexual_model_1 ), "",
                                                      results_cc_pr_poisson_age_sex$Homosexual_model_1 )

results_cc_pr_poisson_age_sex$Homosexual_model_2 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Homosexual_model_2 ), "",
                                                      results_cc_pr_poisson_age_sex$Homosexual_model_2 )

results_cc_pr_poisson_age_sex$Bisexual_crude <- ifelse( is.na( results_cc_pr_poisson_age_sex$Bisexual_crude ), "",
                                                      results_cc_pr_poisson_age_sex$Bisexual_crude )

results_cc_pr_poisson_age_sex$Bisexual_model_1 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Bisexual_model_1 ), "",
                                                      results_cc_pr_poisson_age_sex$Bisexual_model_1 )

results_cc_pr_poisson_age_sex$Bisexual_model_2 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Bisexual_model_2 ), "",
                                                      results_cc_pr_poisson_age_sex$Bisexual_model_2 )

results_cc_pr_poisson_age_sex$Other_crude <- ifelse( is.na( results_cc_pr_poisson_age_sex$Other_crude ), "",
                                                      results_cc_pr_poisson_age_sex$Other_crude )

results_cc_pr_poisson_age_sex$Other_model_1 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Other_model_1 ), "",
                                                      results_cc_pr_poisson_age_sex$Other_model_1 )

results_cc_pr_poisson_age_sex$Other_model_2 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Other_model_2 ), "",
                                                      results_cc_pr_poisson_age_sex$Other_model_2 )
```

##### 3.6.2. Sexual minority group
```{r}
selected_cols <- grep( "exposure|sexual_minority", colnames( results_cc_pr_poisson_age_sex ), ignore.case = TRUE )

results_cc_pr_poisson_age_sex_sexual_minorities <- results_cc_pr_poisson_age_sex[ , selected_cols ]

results_cc_pr_poisson_age_sex_sexual_minorities <- results_cc_pr_poisson_age_sex_sexual_minorities %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_age_sex_sexual_minorities <- results_cc_pr_poisson_age_sex_sexual_minorities %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_age_sex_sexual_minorities <- results_cc_pr_poisson_age_sex_sexual_minorities %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_age_sex_sexual_minorities <- results_cc_pr_poisson_age_sex_sexual_minorities %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_age_sex_sexual_minorities )[1] <- "Age Group"

names( results_cc_pr_poisson_age_sex_sexual_minorities )[ names( results_cc_pr_poisson_age_sex_sexual_minorities ) %in% c( "temp1", "temp2", "temp3", "Sexual_minority_crude", "Sexual_minority_model_1", "Sexual_minority_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_sexual_minority <- forest(
  results_cc_pr_poisson_age_sex_sexual_minorities[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_crude_2010,
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_model_1_2010,
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_crude_2014,
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_model_1_2014,
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_crude_2021,
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_model_1_2021,
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_crude_2010,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_crude_2014,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_crude_2021,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_crude_2010,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_crude_2014,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_crude_2021,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 6 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- insert_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Sexual Minoritiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 6 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 2:5, 7:10 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_sexual_minority <- add_border(
  p_cc_pr_poisson_sexual_minority,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_sexual_minority )
```

##### 3.6.3. Homosexual group
```{r}
selected_cols <- grep( "exposure|homosexual", colnames( results_cc_pr_poisson_age_sex ), ignore.case = TRUE )

results_cc_pr_poisson_age_sex_homosexual <- results_cc_pr_poisson_age_sex[ , selected_cols ]

results_cc_pr_poisson_age_sex_homosexual <- results_cc_pr_poisson_age_sex_homosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_age_sex_homosexual <- results_cc_pr_poisson_age_sex_homosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_age_sex_homosexual <- results_cc_pr_poisson_age_sex_homosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_age_sex_homosexual <- results_cc_pr_poisson_age_sex_homosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_age_sex_homosexual )[1] <- "Age Group"

names( results_cc_pr_poisson_age_sex_homosexual )[ names( results_cc_pr_poisson_age_sex_homosexual ) %in% c( "temp1", "temp2", "temp3", "Homosexual_crude", "Homosexual_model_1", "Homosexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_homosexual <- forest(
  results_cc_pr_poisson_age_sex_homosexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_crude_2010,
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_crude_2014,
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_crude_2021,
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_crude_2010,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_crude_2014,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_crude_2021,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_crude_2010,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_crude_2014,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_crude_2021,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                              row = c( 1, 6 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- insert_text(
  p_cc_pr_poisson_homosexual,
  text = "Homosexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                              row = c( 1, 6 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                              row = c( 2:5, 7:10 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_homosexual <- add_border(
  p_cc_pr_poisson_homosexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_homosexual )
```

##### 3.6.4. Bisexual group
```{r}
selected_cols <- grep( "exposure|bisexual", colnames( results_cc_pr_poisson_age_sex ), ignore.case = TRUE )

results_cc_pr_poisson_age_sex_bisexual <- results_cc_pr_poisson_age_sex[ , selected_cols ]

results_cc_pr_poisson_age_sex_bisexual <- results_cc_pr_poisson_age_sex_bisexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_age_sex_bisexual <- results_cc_pr_poisson_age_sex_bisexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_age_sex_bisexual <- results_cc_pr_poisson_age_sex_bisexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_age_sex_bisexual <- results_cc_pr_poisson_age_sex_bisexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_age_sex_bisexual )[1] <- "Age Group"

names( results_cc_pr_poisson_age_sex_bisexual )[ names( results_cc_pr_poisson_age_sex_bisexual ) %in% c( "temp1", "temp2", "temp3", "Bisexual_crude", "Bisexual_model_1", "Bisexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_bisexual <- forest(
  results_cc_pr_poisson_age_sex_bisexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_crude_2010,
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_crude_2014,
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_crude_2021,
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_crude_2010,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_crude_2014,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_crude_2021,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_crude_2010,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_crude_2014,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_crude_2021,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 8 ),
  ticks_at = c( 0, 1, 2, 4, 6, 8 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                         row = c( 1, 6 ),
                                         col = 1,
                                         gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- insert_text(
  p_cc_pr_poisson_bisexual,
  text = "Bisexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                         row = c( 1, 6 ), 
                                         which = "background",
                                         gp = gpar( fill = "white" )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                         row = c( 2:5, 7:10 ), 
                                         which = "background",
                                         gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_bisexual <- add_border(
  p_cc_pr_poisson_bisexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_bisexual )
```

##### 3.6.5. Other group
```{r}
selected_cols <- grep( "exposure|other", colnames( results_cc_pr_poisson_age_sex ), ignore.case = TRUE )

results_cc_pr_poisson_age_sex_other <- results_cc_pr_poisson_age_sex[ , selected_cols ]

results_cc_pr_poisson_age_sex_other <- results_cc_pr_poisson_age_sex_other %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_age_sex_other <- results_cc_pr_poisson_age_sex_other %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_age_sex_other <- results_cc_pr_poisson_age_sex_other %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_age_sex_other <- results_cc_pr_poisson_age_sex_other %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_age_sex_other )[1] <- "Age Group"

names( results_cc_pr_poisson_age_sex_other )[ names( results_cc_pr_poisson_age_sex_other ) %in% c( "temp1", "temp2", "temp3", "Other_crude", "Other_model_1", "Other_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_other <- forest(
  results_cc_pr_poisson_age_sex_other[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_age_sex_other$other_point_estimate_crude_2010,
              results_cc_pr_poisson_age_sex_other$other_point_estimate_model_1_2010,
              results_cc_pr_poisson_age_sex_other$other_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_age_sex_other$other_point_estimate_crude_2014,
              results_cc_pr_poisson_age_sex_other$other_point_estimate_model_1_2014,
              results_cc_pr_poisson_age_sex_other$other_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_age_sex_other$other_point_estimate_crude_2021,
              results_cc_pr_poisson_age_sex_other$other_point_estimate_model_1_2021,
              results_cc_pr_poisson_age_sex_other$other_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_age_sex_other$other_lower_ci_crude_2010,
                results_cc_pr_poisson_age_sex_other$other_lower_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_other$other_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_other$other_lower_ci_crude_2014,
                results_cc_pr_poisson_age_sex_other$other_lower_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_other$other_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_other$other_lower_ci_crude_2021,
                results_cc_pr_poisson_age_sex_other$other_lower_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_other$other_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_age_sex_other$other_upper_ci_crude_2010,
                results_cc_pr_poisson_age_sex_other$other_upper_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_other$other_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_other$other_upper_ci_crude_2014,
                results_cc_pr_poisson_age_sex_other$other_upper_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_other$other_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_other$other_upper_ci_crude_2021,
                results_cc_pr_poisson_age_sex_other$other_upper_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_other$other_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                       row = c( 1, 6 ),
                                       col = 1,
                                       gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- insert_text(
  p_cc_pr_poisson_other,
  text = "Uncertain/Other Sexual Identitiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                       row = c( 1, 6 ), 
                                       which = "background",
                                       gp = gpar( fill = "white" )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                       row = c( 2:5, 7:10 ), 
                                       which = "background",
                                       gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_other <- add_border(
  p_cc_pr_poisson_other,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_other )
```

#### 3.7. Education by sex
##### 3.7.1. Prepare dataset for plotting
```{r}
results_cc_pr_poisson_education_sex <- results_cc_pr_poisson[ c( 23:26 ), ]

results_cc_pr_poisson_education_sex <- results_cc_pr_poisson_education_sex %>% 
  add_row( Exposure = "Male", .before = 1 )

results_cc_pr_poisson_education_sex <- results_cc_pr_poisson_education_sex %>% 
  add_row( Exposure = "Female", .before = 4 )

results_cc_pr_poisson_education_sex$Exposure[ results_cc_pr_poisson_education_sex$Exposure == "education_exp<=9 years_Male" ] <- paste0( "   ", "\u2264 9 yrs\n\n" )
results_cc_pr_poisson_education_sex$Exposure[ results_cc_pr_poisson_education_sex$Exposure == "education_exp10-12 years_Male" ] <- paste0( "   ", "10–12 yrs\n\n" )

results_cc_pr_poisson_education_sex$Exposure[ results_cc_pr_poisson_education_sex$Exposure == "education_exp<=9 years_Female" ] <- paste0( "   ", "\u2264 9 yrs\n\n" )
results_cc_pr_poisson_education_sex$Exposure[ results_cc_pr_poisson_education_sex$Exposure == "education_exp10-12 years_Female" ] <- paste0( "   ", "10–12 yrs\n\n" )

results_cc_pr_poisson_education_sex <- results_cc_pr_poisson_education_sex %>% 
  add_row( Exposure = paste0( "   ", "\u2265 13 yrs" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 4 )

results_cc_pr_poisson_education_sex <- results_cc_pr_poisson_education_sex %>% 
  add_row( Exposure = paste0( "   ", "\u2265 13 yrs" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 8 )

results_cc_pr_poisson_education_sex$Sexual_minority_crude <- ifelse( is.na( results_cc_pr_poisson_education_sex$Sexual_minority_crude ), "",
                                                                  results_cc_pr_poisson_education_sex$Sexual_minority_crude )

results_cc_pr_poisson_education_sex$Sexual_minority_model_1 <- ifelse( is.na( results_cc_pr_poisson_education_sex$Sexual_minority_model_1 ), "",
                                                                    results_cc_pr_poisson_education_sex$Sexual_minority_model_1 )

results_cc_pr_poisson_education_sex$Sexual_minority_model_2 <- ifelse( is.na( results_cc_pr_poisson_education_sex$Sexual_minority_model_2 ), "",
                                                                    results_cc_pr_poisson_education_sex$Sexual_minority_model_2 )

results_cc_pr_poisson_education_sex$Homosexual_crude <- ifelse( is.na( results_cc_pr_poisson_education_sex$Homosexual_crude ), "",
                                                             results_cc_pr_poisson_education_sex$Homosexual_crude )

results_cc_pr_poisson_education_sex$Homosexual_model_1 <- ifelse( is.na( results_cc_pr_poisson_education_sex$Homosexual_model_1 ), "",
                                                               results_cc_pr_poisson_education_sex$Homosexual_model_1 )

results_cc_pr_poisson_education_sex$Homosexual_model_2 <- ifelse( is.na( results_cc_pr_poisson_education_sex$Homosexual_model_2 ), "",
                                                               results_cc_pr_poisson_education_sex$Homosexual_model_2 )

results_cc_pr_poisson_education_sex$Bisexual_crude <- ifelse( is.na( results_cc_pr_poisson_education_sex$Bisexual_crude ), "",
                                                           results_cc_pr_poisson_education_sex$Bisexual_crude )

results_cc_pr_poisson_education_sex$Bisexual_model_1 <- ifelse( is.na( results_cc_pr_poisson_education_sex$Bisexual_model_1 ), "",
                                                             results_cc_pr_poisson_education_sex$Bisexual_model_1 )

results_cc_pr_poisson_education_sex$Bisexual_model_2 <- ifelse( is.na( results_cc_pr_poisson_education_sex$Bisexual_model_2 ), "",
                                                             results_cc_pr_poisson_education_sex$Bisexual_model_2 )

results_cc_pr_poisson_education_sex$Other_crude <- ifelse( is.na( results_cc_pr_poisson_education_sex$Other_crude ), "",
                                                        results_cc_pr_poisson_education_sex$Other_crude )

results_cc_pr_poisson_education_sex$Other_model_1 <- ifelse( is.na( results_cc_pr_poisson_education_sex$Other_model_1 ), "",
                                                          results_cc_pr_poisson_education_sex$Other_model_1 )

results_cc_pr_poisson_education_sex$Other_model_2 <- ifelse( is.na( results_cc_pr_poisson_education_sex$Other_model_2 ), "",
                                                          results_cc_pr_poisson_education_sex$Other_model_2 )
```

##### 3.7.2. Sexual minority group
```{r}
selected_cols <- grep( "exposure|sexual_minority", colnames( results_cc_pr_poisson_education_sex ), ignore.case = TRUE )

results_cc_pr_poisson_education_sex_sexual_minorities <- results_cc_pr_poisson_education_sex[ , selected_cols ]

results_cc_pr_poisson_education_sex_sexual_minorities <- results_cc_pr_poisson_education_sex_sexual_minorities %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_education_sex_sexual_minorities <- results_cc_pr_poisson_education_sex_sexual_minorities %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_education_sex_sexual_minorities <- results_cc_pr_poisson_education_sex_sexual_minorities %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_education_sex_sexual_minorities <- results_cc_pr_poisson_education_sex_sexual_minorities %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_education_sex_sexual_minorities )[1] <- "Education Years"

names( results_cc_pr_poisson_education_sex_sexual_minorities )[ names( results_cc_pr_poisson_education_sex_sexual_minorities ) %in% c( "temp1", "temp2", "temp3", "Sexual_minority_crude", "Sexual_minority_model_1", "Sexual_minority_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_sexual_minority <- forest(
  results_cc_pr_poisson_education_sex_sexual_minorities[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_point_estimate_crude_2010,
              results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_point_estimate_model_1_2010,
              results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_point_estimate_crude_2014,
              results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_point_estimate_model_1_2014,
              results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_point_estimate_crude_2021,
              results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_point_estimate_model_1_2021,
              results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_lower_ci_crude_2010,
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_lower_ci_model_1_2010,
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_lower_ci_crude_2014,
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_lower_ci_model_1_2014,
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_lower_ci_crude_2021,
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_lower_ci_model_1_2021,
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_upper_ci_crude_2010,
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_upper_ci_model_1_2010,
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_upper_ci_crude_2014,
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_upper_ci_model_1_2014,
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_upper_ci_crude_2021,
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_upper_ci_model_1_2021,
                results_cc_pr_poisson_education_sex_sexual_minorities$sexual_minority_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 5 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- insert_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Sexual Minoritiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 5 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 2:4, 6:8 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_sexual_minority <- add_border(
  p_cc_pr_poisson_sexual_minority,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_sexual_minority )
```

##### 3.7.3. Homosexual group
```{r}
selected_cols <- grep( "exposure|homosexual", colnames( results_cc_pr_poisson_education_sex ), ignore.case = TRUE )

results_cc_pr_poisson_education_sex_homosexual <- results_cc_pr_poisson_education_sex[ , selected_cols ]

results_cc_pr_poisson_education_sex_homosexual <- results_cc_pr_poisson_education_sex_homosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_education_sex_homosexual <- results_cc_pr_poisson_education_sex_homosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_education_sex_homosexual <- results_cc_pr_poisson_education_sex_homosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_education_sex_homosexual <- results_cc_pr_poisson_education_sex_homosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_education_sex_homosexual )[1] <- "Education Years"

names( results_cc_pr_poisson_education_sex_homosexual )[ names( results_cc_pr_poisson_education_sex_homosexual ) %in% c( "temp1", "temp2", "temp3", "Homosexual_crude", "Homosexual_model_1", "Homosexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_homosexual <- forest(
  results_cc_pr_poisson_education_sex_homosexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_education_sex_homosexual$homosexual_point_estimate_crude_2010,
              results_cc_pr_poisson_education_sex_homosexual$homosexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_education_sex_homosexual$homosexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_education_sex_homosexual$homosexual_point_estimate_crude_2014,
              results_cc_pr_poisson_education_sex_homosexual$homosexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_education_sex_homosexual$homosexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_education_sex_homosexual$homosexual_point_estimate_crude_2021,
              results_cc_pr_poisson_education_sex_homosexual$homosexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_education_sex_homosexual$homosexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_education_sex_homosexual$homosexual_lower_ci_crude_2010,
                results_cc_pr_poisson_education_sex_homosexual$homosexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_education_sex_homosexual$homosexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_education_sex_homosexual$homosexual_lower_ci_crude_2014,
                results_cc_pr_poisson_education_sex_homosexual$homosexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_education_sex_homosexual$homosexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_education_sex_homosexual$homosexual_lower_ci_crude_2021,
                results_cc_pr_poisson_education_sex_homosexual$homosexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_education_sex_homosexual$homosexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_education_sex_homosexual$homosexual_upper_ci_crude_2010,
                results_cc_pr_poisson_education_sex_homosexual$homosexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_education_sex_homosexual$homosexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_education_sex_homosexual$homosexual_upper_ci_crude_2014,
                results_cc_pr_poisson_education_sex_homosexual$homosexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_education_sex_homosexual$homosexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_education_sex_homosexual$homosexual_upper_ci_crude_2021,
                results_cc_pr_poisson_education_sex_homosexual$homosexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_education_sex_homosexual$homosexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 2 ),
  ticks_at = c( 0, 1, 2 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                         row = c( 1, 5 ),
                                         col = 1,
                                         gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- insert_text(
  p_cc_pr_poisson_homosexual,
  text = "Homosexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                         row = c( 1, 5 ), 
                                         which = "background",
                                         gp = gpar( fill = "white" )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                         row = c( 2:4, 6:8 ), 
                                         which = "background",
                                         gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_homosexual <- add_border(
  p_cc_pr_poisson_homosexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_homosexual )
```

##### 3.7.4. Bisexual group
```{r}
selected_cols <- grep( "exposure|bisexual", colnames( results_cc_pr_poisson_education_sex ), ignore.case = TRUE )

results_cc_pr_poisson_education_sex_bisexual <- results_cc_pr_poisson_education_sex[ , selected_cols ]

results_cc_pr_poisson_education_sex_bisexual <- results_cc_pr_poisson_education_sex_bisexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_education_sex_bisexual <- results_cc_pr_poisson_education_sex_bisexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_education_sex_bisexual <- results_cc_pr_poisson_education_sex_bisexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_education_sex_bisexual <- results_cc_pr_poisson_education_sex_bisexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_education_sex_bisexual )[1] <- "Education Years"

names( results_cc_pr_poisson_education_sex_bisexual )[ names( results_cc_pr_poisson_education_sex_bisexual ) %in% c( "temp1", "temp2", "temp3", "Bisexual_crude", "Bisexual_model_1", "Bisexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_bisexual <- forest(
  results_cc_pr_poisson_education_sex_bisexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_education_sex_bisexual$bisexual_point_estimate_crude_2010,
              results_cc_pr_poisson_education_sex_bisexual$bisexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_education_sex_bisexual$bisexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_education_sex_bisexual$bisexual_point_estimate_crude_2014,
              results_cc_pr_poisson_education_sex_bisexual$bisexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_education_sex_bisexual$bisexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_education_sex_bisexual$bisexual_point_estimate_crude_2021,
              results_cc_pr_poisson_education_sex_bisexual$bisexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_education_sex_bisexual$bisexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_education_sex_bisexual$bisexual_lower_ci_crude_2010,
                results_cc_pr_poisson_education_sex_bisexual$bisexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_education_sex_bisexual$bisexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_education_sex_bisexual$bisexual_lower_ci_crude_2014,
                results_cc_pr_poisson_education_sex_bisexual$bisexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_education_sex_bisexual$bisexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_education_sex_bisexual$bisexual_lower_ci_crude_2021,
                results_cc_pr_poisson_education_sex_bisexual$bisexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_education_sex_bisexual$bisexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_education_sex_bisexual$bisexual_upper_ci_crude_2010,
                results_cc_pr_poisson_education_sex_bisexual$bisexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_education_sex_bisexual$bisexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_education_sex_bisexual$bisexual_upper_ci_crude_2014,
                results_cc_pr_poisson_education_sex_bisexual$bisexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_education_sex_bisexual$bisexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_education_sex_bisexual$bisexual_upper_ci_crude_2021,
                results_cc_pr_poisson_education_sex_bisexual$bisexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_education_sex_bisexual$bisexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 2 ),
  ticks_at = c( 0, 1, 2 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                       row = c( 1, 5 ),
                                       col = 1,
                                       gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- insert_text(
  p_cc_pr_poisson_bisexual,
  text = "Bisexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                       row = c( 1, 5 ), 
                                       which = "background",
                                       gp = gpar( fill = "white" )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                       row = c( 2:4, 6:8 ), 
                                       which = "background",
                                       gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_bisexual <- add_border(
  p_cc_pr_poisson_bisexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_bisexual )
```

##### 3.7.5. Other group
```{r}
selected_cols <- grep( "exposure|other", colnames( results_cc_pr_poisson_education_sex ), ignore.case = TRUE )

results_cc_pr_poisson_education_sex_other <- results_cc_pr_poisson_education_sex[ , selected_cols ]

results_cc_pr_poisson_education_sex_other <- results_cc_pr_poisson_education_sex_other %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_education_sex_other <- results_cc_pr_poisson_education_sex_other %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_education_sex_other <- results_cc_pr_poisson_education_sex_other %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_education_sex_other <- results_cc_pr_poisson_education_sex_other %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_education_sex_other )[1] <- "Education Years"

names( results_cc_pr_poisson_education_sex_other )[ names( results_cc_pr_poisson_education_sex_other ) %in% c( "temp1", "temp2", "temp3", "Other_crude", "Other_model_1", "Other_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_other <- forest(
  results_cc_pr_poisson_education_sex_other[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_education_sex_other$other_point_estimate_crude_2010,
              results_cc_pr_poisson_education_sex_other$other_point_estimate_model_1_2010,
              results_cc_pr_poisson_education_sex_other$other_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_education_sex_other$other_point_estimate_crude_2014,
              results_cc_pr_poisson_education_sex_other$other_point_estimate_model_1_2014,
              results_cc_pr_poisson_education_sex_other$other_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_education_sex_other$other_point_estimate_crude_2021,
              results_cc_pr_poisson_education_sex_other$other_point_estimate_model_1_2021,
              results_cc_pr_poisson_education_sex_other$other_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_education_sex_other$other_lower_ci_crude_2010,
                results_cc_pr_poisson_education_sex_other$other_lower_ci_model_1_2010,
                results_cc_pr_poisson_education_sex_other$other_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_education_sex_other$other_lower_ci_crude_2014,
                results_cc_pr_poisson_education_sex_other$other_lower_ci_model_1_2014,
                results_cc_pr_poisson_education_sex_other$other_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_education_sex_other$other_lower_ci_crude_2021,
                results_cc_pr_poisson_education_sex_other$other_lower_ci_model_1_2021,
                results_cc_pr_poisson_education_sex_other$other_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_education_sex_other$other_upper_ci_crude_2010,
                results_cc_pr_poisson_education_sex_other$other_upper_ci_model_1_2010,
                results_cc_pr_poisson_education_sex_other$other_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_education_sex_other$other_upper_ci_crude_2014,
                results_cc_pr_poisson_education_sex_other$other_upper_ci_model_1_2014,
                results_cc_pr_poisson_education_sex_other$other_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_education_sex_other$other_upper_ci_crude_2021,
                results_cc_pr_poisson_education_sex_other$other_upper_ci_model_1_2021,
                results_cc_pr_poisson_education_sex_other$other_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 6 ),
  ticks_at = c( 0, 1, 2, 4, 6 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                    row = c( 1, 5 ),
                                    col = 1,
                                    gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- insert_text(
  p_cc_pr_poisson_other,
  text = "Uncertain/Other Sexual Identitiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                    row = c( 1, 5 ), 
                                    which = "background",
                                    gp = gpar( fill = "white" )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                    row = c( 2:4, 6:8 ), 
                                    which = "background",
                                    gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_other <- add_border(
  p_cc_pr_poisson_other,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_other )
```

#### 3.8. Income by sex
##### 3.8.1. Prepare dataset for plotting
```{r}
results_cc_pr_poisson_income_sex <- results_cc_pr_poisson[ c( 32:37 ), ]

results_cc_pr_poisson_income_sex <- results_cc_pr_poisson_income_sex %>% 
  add_row( Exposure = "Male", .before = 1 )

results_cc_pr_poisson_income_sex <- results_cc_pr_poisson_income_sex %>% 
  add_row( Exposure = "Female", .before = 5 )

results_cc_pr_poisson_income_sex$Exposure[ results_cc_pr_poisson_income_sex$Exposure == "income_exp<=2,500_Male" ] <- paste0( "   ", "\u2264 2,500\n\n" )
results_cc_pr_poisson_income_sex$Exposure[ results_cc_pr_poisson_income_sex$Exposure == "income_exp(2,500, 3,500]_Male" ] <- paste0( "   ", "(2,500, 3,500]\n\n" )
results_cc_pr_poisson_income_sex$Exposure[ results_cc_pr_poisson_income_sex$Exposure == "income_exp(3,500, 4,500]_Male" ] <- paste0( "   ", "(3,500, 4,500]\n\n" )

results_cc_pr_poisson_income_sex$Exposure[ results_cc_pr_poisson_income_sex$Exposure == "income_exp<=2,500_Female" ] <- paste0( "   ", "\u2264 2,500\n\n" )
results_cc_pr_poisson_income_sex$Exposure[ results_cc_pr_poisson_income_sex$Exposure == "income_exp(2,500, 3,500]_Female" ] <- paste0( "   ", "(2,500, 3,500]\n\n" )
results_cc_pr_poisson_income_sex$Exposure[ results_cc_pr_poisson_income_sex$Exposure == "income_exp(3,500, 4,500]_Female" ] <- paste0( "   ", "(3,500, 4,500]\n\n" )

results_cc_pr_poisson_income_sex <- results_cc_pr_poisson_income_sex %>% 
  add_row( Exposure = paste0( "   ", "> 4,500" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 5 )

results_cc_pr_poisson_income_sex <- results_cc_pr_poisson_income_sex %>% 
  add_row( Exposure = paste0( "   ", "> 4,500" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 10 )

results_cc_pr_poisson_income_sex$Sexual_minority_crude <- ifelse( is.na( results_cc_pr_poisson_income_sex$Sexual_minority_crude ), "",
                                                               results_cc_pr_poisson_income_sex$Sexual_minority_crude )

results_cc_pr_poisson_income_sex$Sexual_minority_model_1 <- ifelse( is.na( results_cc_pr_poisson_income_sex$Sexual_minority_model_1 ), "",
                                                                 results_cc_pr_poisson_income_sex$Sexual_minority_model_1 )

results_cc_pr_poisson_income_sex$Sexual_minority_model_2 <- ifelse( is.na( results_cc_pr_poisson_income_sex$Sexual_minority_model_2 ), "",
                                                                 results_cc_pr_poisson_income_sex$Sexual_minority_model_2 )

results_cc_pr_poisson_income_sex$Homosexual_crude <- ifelse( is.na( results_cc_pr_poisson_income_sex$Homosexual_crude ), "",
                                                          results_cc_pr_poisson_income_sex$Homosexual_crude )

results_cc_pr_poisson_income_sex$Homosexual_model_1 <- ifelse( is.na( results_cc_pr_poisson_income_sex$Homosexual_model_1 ), "",
                                                            results_cc_pr_poisson_income_sex$Homosexual_model_1 )

results_cc_pr_poisson_income_sex$Homosexual_model_2 <- ifelse( is.na( results_cc_pr_poisson_income_sex$Homosexual_model_2 ), "",
                                                            results_cc_pr_poisson_income_sex$Homosexual_model_2 )

results_cc_pr_poisson_income_sex$Bisexual_crude <- ifelse( is.na( results_cc_pr_poisson_income_sex$Bisexual_crude ), "",
                                                        results_cc_pr_poisson_income_sex$Bisexual_crude )

results_cc_pr_poisson_income_sex$Bisexual_model_1 <- ifelse( is.na( results_cc_pr_poisson_income_sex$Bisexual_model_1 ), "",
                                                          results_cc_pr_poisson_income_sex$Bisexual_model_1 )

results_cc_pr_poisson_income_sex$Bisexual_model_2 <- ifelse( is.na( results_cc_pr_poisson_income_sex$Bisexual_model_2 ), "",
                                                          results_cc_pr_poisson_income_sex$Bisexual_model_2 )

results_cc_pr_poisson_income_sex$Other_crude <- ifelse( is.na( results_cc_pr_poisson_income_sex$Other_crude ), "",
                                                     results_cc_pr_poisson_income_sex$Other_crude )

results_cc_pr_poisson_income_sex$Other_model_1 <- ifelse( is.na( results_cc_pr_poisson_income_sex$Other_model_1 ), "",
                                                       results_cc_pr_poisson_income_sex$Other_model_1 )

results_cc_pr_poisson_income_sex$Other_model_2 <- ifelse( is.na( results_cc_pr_poisson_income_sex$Other_model_2 ), "",
                                                       results_cc_pr_poisson_income_sex$Other_model_2 )
```

##### 3.8.2. Sexual minority group
```{r}
selected_cols <- grep( "exposure|sexual_minority", colnames( results_cc_pr_poisson_income_sex ), ignore.case = TRUE )

results_cc_pr_poisson_income_sex_sexual_minorities <- results_cc_pr_poisson_income_sex[ , selected_cols ]

results_cc_pr_poisson_income_sex_sexual_minorities <- results_cc_pr_poisson_income_sex_sexual_minorities %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_income_sex_sexual_minorities <- results_cc_pr_poisson_income_sex_sexual_minorities %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_income_sex_sexual_minorities <- results_cc_pr_poisson_income_sex_sexual_minorities %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_income_sex_sexual_minorities <- results_cc_pr_poisson_income_sex_sexual_minorities %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_income_sex_sexual_minorities )[1] <- "Income (100 kr/yr)ᵃ"

names( results_cc_pr_poisson_income_sex_sexual_minorities )[ names( results_cc_pr_poisson_income_sex_sexual_minorities ) %in% c( "temp1", "temp2", "temp3", "Sexual_minority_crude", "Sexual_minority_model_1", "Sexual_minority_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_sexual_minority <- forest(
  results_cc_pr_poisson_income_sex_sexual_minorities[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_point_estimate_crude_2010,
              results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_point_estimate_model_1_2010,
              results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_point_estimate_crude_2014,
              results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_point_estimate_model_1_2014,
              results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_point_estimate_crude_2021,
              results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_point_estimate_model_1_2021,
              results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_lower_ci_crude_2010,
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_lower_ci_model_1_2010,
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_lower_ci_crude_2014,
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_lower_ci_model_1_2014,
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_lower_ci_crude_2021,
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_lower_ci_model_1_2021,
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_upper_ci_crude_2010,
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_upper_ci_model_1_2010,
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_upper_ci_crude_2014,
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_upper_ci_model_1_2014,
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_upper_ci_crude_2021,
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_upper_ci_model_1_2021,
                results_cc_pr_poisson_income_sex_sexual_minorities$sexual_minority_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 5 ),
  ticks_at = c( 0, 1, 2, 3, 4, 5 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 6 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 1, Proportion Ratio (95% CI)ᶜ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 2, Proportion Ratio (95% CI)ᵈ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- insert_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Sexual Minoritiesᵇ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 6 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 2:5, 7:10 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_sexual_minority <- add_border(
  p_cc_pr_poisson_sexual_minority,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_sexual_minority )
```

##### 3.8.3. Homosexual group
```{r}
selected_cols <- grep( "exposure|homosexual", colnames( results_cc_pr_poisson_income_sex ), ignore.case = TRUE )

results_cc_pr_poisson_income_sex_homosexual <- results_cc_pr_poisson_income_sex[ , selected_cols ]

results_cc_pr_poisson_income_sex_homosexual <- results_cc_pr_poisson_income_sex_homosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_income_sex_homosexual <- results_cc_pr_poisson_income_sex_homosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_income_sex_homosexual <- results_cc_pr_poisson_income_sex_homosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_income_sex_homosexual <- results_cc_pr_poisson_income_sex_homosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_income_sex_homosexual )[1] <- "Income (100 kr/yr)ᵃ"

names( results_cc_pr_poisson_income_sex_homosexual )[ names( results_cc_pr_poisson_income_sex_homosexual ) %in% c( "temp1", "temp2", "temp3", "Homosexual_crude", "Homosexual_model_1", "Homosexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_homosexual <- forest(
  results_cc_pr_poisson_income_sex_homosexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_income_sex_homosexual$homosexual_point_estimate_crude_2010,
              results_cc_pr_poisson_income_sex_homosexual$homosexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_income_sex_homosexual$homosexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_income_sex_homosexual$homosexual_point_estimate_crude_2014,
              results_cc_pr_poisson_income_sex_homosexual$homosexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_income_sex_homosexual$homosexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_income_sex_homosexual$homosexual_point_estimate_crude_2021,
              results_cc_pr_poisson_income_sex_homosexual$homosexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_income_sex_homosexual$homosexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_income_sex_homosexual$homosexual_lower_ci_crude_2010,
                results_cc_pr_poisson_income_sex_homosexual$homosexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_income_sex_homosexual$homosexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_income_sex_homosexual$homosexual_lower_ci_crude_2014,
                results_cc_pr_poisson_income_sex_homosexual$homosexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_income_sex_homosexual$homosexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_income_sex_homosexual$homosexual_lower_ci_crude_2021,
                results_cc_pr_poisson_income_sex_homosexual$homosexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_income_sex_homosexual$homosexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_income_sex_homosexual$homosexual_upper_ci_crude_2010,
                results_cc_pr_poisson_income_sex_homosexual$homosexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_income_sex_homosexual$homosexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_income_sex_homosexual$homosexual_upper_ci_crude_2014,
                results_cc_pr_poisson_income_sex_homosexual$homosexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_income_sex_homosexual$homosexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_income_sex_homosexual$homosexual_upper_ci_crude_2021,
                results_cc_pr_poisson_income_sex_homosexual$homosexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_income_sex_homosexual$homosexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 3 ),
  ticks_at = c( 0, 1, 2, 3 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                         row = c( 1, 6 ),
                                         col = 1,
                                         gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 1, Proportion Ratio (95% CI)ᶜ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 2, Proportion Ratio (95% CI)ᵈ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- insert_text(
  p_cc_pr_poisson_homosexual,
  text = "Homosexual Identityᵇ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                         row = c( 1, 6 ), 
                                         which = "background",
                                         gp = gpar( fill = "white" )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                         row = c( 2:5, 7:10 ), 
                                         which = "background",
                                         gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_homosexual <- add_border(
  p_cc_pr_poisson_homosexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_homosexual )
ggsave( "Final_plots/p_cc_pr_homosexual_income.svg", plot = p_cc_pr_poisson_homosexual, width = 10.7, height = 5.8 )
```

##### 3.8.4. Bisexual group
```{r}
selected_cols <- grep( "exposure|bisexual", colnames( results_cc_pr_poisson_income_sex ), ignore.case = TRUE )

results_cc_pr_poisson_income_sex_bisexual <- results_cc_pr_poisson_income_sex[ , selected_cols ]

results_cc_pr_poisson_income_sex_bisexual <- results_cc_pr_poisson_income_sex_bisexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_income_sex_bisexual <- results_cc_pr_poisson_income_sex_bisexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_income_sex_bisexual <- results_cc_pr_poisson_income_sex_bisexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_income_sex_bisexual <- results_cc_pr_poisson_income_sex_bisexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_income_sex_bisexual )[1] <- "Income (100 kr/yr)ᵃ"

names( results_cc_pr_poisson_income_sex_bisexual )[ names( results_cc_pr_poisson_income_sex_bisexual ) %in% c( "temp1", "temp2", "temp3", "Bisexual_crude", "Bisexual_model_1", "Bisexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_bisexual <- forest(
  results_cc_pr_poisson_income_sex_bisexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_income_sex_bisexual$bisexual_point_estimate_crude_2010,
              results_cc_pr_poisson_income_sex_bisexual$bisexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_income_sex_bisexual$bisexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_income_sex_bisexual$bisexual_point_estimate_crude_2014,
              results_cc_pr_poisson_income_sex_bisexual$bisexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_income_sex_bisexual$bisexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_income_sex_bisexual$bisexual_point_estimate_crude_2021,
              results_cc_pr_poisson_income_sex_bisexual$bisexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_income_sex_bisexual$bisexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_income_sex_bisexual$bisexual_lower_ci_crude_2010,
                results_cc_pr_poisson_income_sex_bisexual$bisexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_income_sex_bisexual$bisexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_income_sex_bisexual$bisexual_lower_ci_crude_2014,
                results_cc_pr_poisson_income_sex_bisexual$bisexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_income_sex_bisexual$bisexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_income_sex_bisexual$bisexual_lower_ci_crude_2021,
                results_cc_pr_poisson_income_sex_bisexual$bisexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_income_sex_bisexual$bisexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_income_sex_bisexual$bisexual_upper_ci_crude_2010,
                results_cc_pr_poisson_income_sex_bisexual$bisexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_income_sex_bisexual$bisexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_income_sex_bisexual$bisexual_upper_ci_crude_2014,
                results_cc_pr_poisson_income_sex_bisexual$bisexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_income_sex_bisexual$bisexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_income_sex_bisexual$bisexual_upper_ci_crude_2021,
                results_cc_pr_poisson_income_sex_bisexual$bisexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_income_sex_bisexual$bisexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 6 ),
  ticks_at = c( 0, 1, 2, 4, 6 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                       row = c( 1, 6 ),
                                       col = 1,
                                       gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 1, Proportion Ratio (95% CI)ᶜ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 2, Proportion Ratio (95% CI)ᵈ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- insert_text(
  p_cc_pr_poisson_bisexual,
  text = "Bisexual Identityᵇ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                       row = c( 1, 6 ), 
                                       which = "background",
                                       gp = gpar( fill = "white" )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                       row = c( 2:5, 7:10 ), 
                                       which = "background",
                                       gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_bisexual <- add_border(
  p_cc_pr_poisson_bisexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_bisexual )
ggsave( "Final_plots/p_cc_pr_bisexual_income.svg", plot = p_cc_pr_poisson_bisexual, width = 10.7, height = 5.8 )
```

##### 3.8.5. Other group
```{r}
selected_cols <- grep( "exposure|other", colnames( results_cc_pr_poisson_income_sex ), ignore.case = TRUE )

results_cc_pr_poisson_income_sex_other <- results_cc_pr_poisson_income_sex[ , selected_cols ]

results_cc_pr_poisson_income_sex_other <- results_cc_pr_poisson_income_sex_other %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_income_sex_other <- results_cc_pr_poisson_income_sex_other %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_income_sex_other <- results_cc_pr_poisson_income_sex_other %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_income_sex_other <- results_cc_pr_poisson_income_sex_other %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_income_sex_other )[1] <- "Income (100 kr/yr)ᵃ"

names( results_cc_pr_poisson_income_sex_other )[ names( results_cc_pr_poisson_income_sex_other ) %in% c( "temp1", "temp2", "temp3", "Other_crude", "Other_model_1", "Other_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_other <- forest(
  results_cc_pr_poisson_income_sex_other[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_income_sex_other$other_point_estimate_crude_2010,
              results_cc_pr_poisson_income_sex_other$other_point_estimate_model_1_2010,
              results_cc_pr_poisson_income_sex_other$other_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_income_sex_other$other_point_estimate_crude_2014,
              results_cc_pr_poisson_income_sex_other$other_point_estimate_model_1_2014,
              results_cc_pr_poisson_income_sex_other$other_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_income_sex_other$other_point_estimate_crude_2021,
              results_cc_pr_poisson_income_sex_other$other_point_estimate_model_1_2021,
              results_cc_pr_poisson_income_sex_other$other_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_income_sex_other$other_lower_ci_crude_2010,
                results_cc_pr_poisson_income_sex_other$other_lower_ci_model_1_2010,
                results_cc_pr_poisson_income_sex_other$other_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_income_sex_other$other_lower_ci_crude_2014,
                results_cc_pr_poisson_income_sex_other$other_lower_ci_model_1_2014,
                results_cc_pr_poisson_income_sex_other$other_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_income_sex_other$other_lower_ci_crude_2021,
                results_cc_pr_poisson_income_sex_other$other_lower_ci_model_1_2021,
                results_cc_pr_poisson_income_sex_other$other_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_income_sex_other$other_upper_ci_crude_2010,
                results_cc_pr_poisson_income_sex_other$other_upper_ci_model_1_2010,
                results_cc_pr_poisson_income_sex_other$other_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_income_sex_other$other_upper_ci_crude_2014,
                results_cc_pr_poisson_income_sex_other$other_upper_ci_model_1_2014,
                results_cc_pr_poisson_income_sex_other$other_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_income_sex_other$other_upper_ci_crude_2021,
                results_cc_pr_poisson_income_sex_other$other_upper_ci_model_1_2021,
                results_cc_pr_poisson_income_sex_other$other_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 10 ),
  ticks_at = c( 0, 1, 2, 4, 6, 8, 10 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                    row = c( 1, 6 ),
                                    col = 1,
                                    gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 1, Proportion Ratio (95% CI)ᶜ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 2, Proportion Ratio (95% CI)ᵈ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- insert_text(
  p_cc_pr_poisson_other,
  text = "Uncertain/Other Sexual Identitiesᵇ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                    row = c( 1, 6 ), 
                                    which = "background",
                                    gp = gpar( fill = "white" )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                    row = c( 2:5, 7:10 ), 
                                    which = "background",
                                    gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_other <- add_border(
  p_cc_pr_poisson_other,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_other )
```

#### 3.9. Compare across models
##### 3.9.1. SPHC-B 2010
```{r}
results_cc_pr_all_models_2010 <- read_xlsx(here("results_cc_pr_all_models_2010.xlsx"))

results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "sex_expFemale" ] <- "Sex: Female"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp18-29" ] <- "Age: 18–29 yrs"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp30-44" ] <- "Age: 30–44 yrs"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp>=60" ] <- "Age: \u2265 60 yrs"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp18-29_Male" ] <- "Age: 18–29 yrs (males)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp30-44_Male" ] <- "Age: 30–44 yrs (males)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp>=60_Male" ] <- "Age: \u2265 60 yrs (males)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp18-29_Female" ] <- "Age: 18–29 yrs (females)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp30-44_Female" ] <- "Age: 30–44 yrs (females)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp>=60_Female" ] <- "Age: \u2265 60 yrs (females)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "country_of_birth_expEurope" ] <- "Country of birth: Europeᵃ"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "country_of_birth_expOutside Europe" ] <- "Country of birth: Outside Europe"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "education_exp<=9 years" ] <- "Education: \u2264 9 yrs"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "education_exp10-12 years" ] <- "Education: 10–12 yrs"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "education_exp<=9 years_Male" ] <- "Education: \u2264 9 yrs (males)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "education_exp10-12 years_Male" ] <- "Education: 10–12 yrs (males)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "education_exp<=9 years_Female" ] <- "Education: \u2264 9 yrs (females)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "education_exp10-12 years_Female" ] <- "Education: 10–12 yrs (females)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "income_exp<=2,500" ] <- "Incomeᵇ: \u2264 2,500"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "income_exp(2,500, 3,500]" ] <- "Incomeᵇ: (2,500, 3,500]"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "income_exp(3,500, 4,500]" ] <- "Incomeᵇ: (3,500, 4,500]"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "income_exp<=2,500_Male" ] <- "Incomeᵇ: \u2264 2,500 (males)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "income_exp(2,500, 3,500]_Male" ] <- "Incomeᵇ: (2,500, 3,500] (males)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "income_exp(3,500, 4,500]_Male" ] <- "Incomeᵇ: (3,500, 4,500] (males)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "income_exp<=2,500_Female" ] <- "Incomeᵇ: \u2264 2,500 (females)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "income_exp(2,500, 3,500]_Female" ] <- "Incomeᵇ: (2,500, 3,500] (females)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "income_exp(3,500, 4,500]_Female" ] <- "Incomeᵇ: (3,500, 4,500] (females)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "marital_status_expNever married" ] <- "Marital status: Never married"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "marital_status_expOther" ] <- "Marital status: Otherᶜ"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "living_status_expyes" ] <- "Living alone: Yes"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "personal_support_expno" ] <- "Personal support: No"

desired_order <- c( "Sex: Female", "Age: 18–29 yrs", "Age: 30–44 yrs", "Age: ≥ 60 yrs", "Age: 18–29 yrs (males)", "Age: 30–44 yrs (males)", "Age: ≥ 60 yrs (males)", "Age: 18–29 yrs (females)", "Age: 30–44 yrs (females)", "Age: ≥ 60 yrs (females)", "Country of birth: Europeᵃ", "Country of birth: Outside Europe", "Education: ≤ 9 yrs", "Education: 10–12 yrs", "Education: ≤ 9 yrs (males)", "Education: 10–12 yrs (males)", "Education: ≤ 9 yrs (females)", "Education: 10–12 yrs (females)", "Incomeᵇ: ≤ 2,500", "Incomeᵇ: (2,500, 3,500]", "Incomeᵇ: (3,500, 4,500]", "Incomeᵇ: ≤ 2,500 (males)", "Incomeᵇ: (2,500, 3,500] (males)", "Incomeᵇ: (3,500, 4,500] (males)", "Incomeᵇ: ≤ 2,500 (females)", "Incomeᵇ: (2,500, 3,500] (females)", "Incomeᵇ: (3,500, 4,500] (females)", "Marital status: Never married", "Marital status: Otherᶜ", "Living alone: Yes", "Personal support: No" )
                    
results_cc_pr_all_models_2010 <- results_cc_pr_all_models_2010 %>%
  mutate( Exposure = factor( Exposure, levels = desired_order ) ) %>%
  arrange( Exposure )

results_cc_pr_all_models_2010 <- results_cc_pr_all_models_2010[ , !grepl( "model_1", names(results_cc_pr_all_models_2010 ) ) ]
names( results_cc_pr_all_models_2010 ) <- gsub( "model_2_poisson", "poisson", names( results_cc_pr_all_models_2010 ) )

long_data_2010 <- results_cc_pr_all_models_2010 %>%
  pivot_longer(
    cols = !Exposure, 
    names_to = "Identity_Statistic_Model", 
    values_to = "Value"
    )

long_data_2010 <- long_data_2010 %>%
  extract(
    col = Identity_Statistic_Model, 
    into = c( "Identity", "Statistic", "Model" ),
    regex = "^(.+?)_(lower_ci|upper_ci|point_estimate)_(\\w+)$",
    remove = TRUE
  )

long_data_2010 <- long_data_2010 %>%
  pivot_wider(
    names_from = Statistic, 
    values_from = Value
    )

long_data_2010 <- long_data_2010 %>%
  mutate(
    Identity = factor(
      case_when(
        Identity == "sexual_minority" ~ "Sexual minorities",
        Identity == "homosexual" ~ "Homosexual",
        Identity == "bisexual" ~ "Bisexual",
        Identity == "other" ~ "Uncertain"
        ),
      levels = c( "Sexual minorities", "Homosexual", "Bisexual", "Uncertain" )
      ),
    
    Model = factor(
      case_when(
        Model == "poisson" ~ "Poisson (PR)",
        Model == "log_binomial" ~ "Log-binomial (PR)",
        Model == "logistic" ~ "Logistic (OR)"
        ),
      levels = c("Poisson (PR)", "Log-binomial (PR)", "Logistic (OR)")
    )
  )


ggplot( long_data_2010, 
        aes( x = Identity, y = point_estimate, color = Identity, shape = Model ) ) +
  
  geom_point( position = position_dodge( width = 0.5 ) ) +
  geom_errorbar( aes( ymin = lower_ci, ymax = upper_ci ), 
                 position = position_dodge( width = 0.5 ), width = 0.2 ) +
  
  scale_color_manual( values = c( "#C77CFF", "#00BFC4", "#7CAE00", "#F8766D" ),
                      breaks = c( "Sexual minorities", "Homosexual", "Bisexual", "Uncertain" )  ) +
  
  facet_wrap( ~ Exposure, scales = "free_y" ) +
  
  theme_minimal() +
  
  labs( x = NULL, y = "Point Estimate (95% CI)", color = "Sexual Identity", shape = "Model" ) +
  
  theme( axis.text.x = element_blank(),
         axis.title.y = element_text( family = "Arial", size = 11, margin = margin( r = 10, unit = "pt" ) ),
         legend.title = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         strip.text = element_text( family = "Arial", size = 9 ),
         panel.spacing = unit( 0.5, "lines" )
         )
```

##### 3.9.2. SPHC-B 2014
```{r}
results_cc_pr_all_models_2014 <- read_xlsx(here("results_cc_pr_all_models_2014.xlsx"))

results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "sex_expFemale" ] <- "Sex: Female"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp16-29" ] <- "Age: 16–29 yrs"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp30-44" ] <- "Age: 30–44 yrs"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp>=60" ] <- "Age: \u2265 60 yrs"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp16-29_Male" ] <- "Age: 16–29 yrs (males)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp30-44_Male" ] <- "Age: 30–44 yrs (males)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp>=60_Male" ] <- "Age: \u2265 60 yrs (males)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp16-29_Female" ] <- "Age: 16–29 yrs (females)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp30-44_Female" ] <- "Age: 30–44 yrs (females)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp>=60_Female" ] <- "Age: \u2265 60 yrs (females)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "country_of_birth_expEurope" ] <- "Country of birth: Europeᵃ"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "country_of_birth_expOutside Europe" ] <- "Country of birth: Outside Europe"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "education_exp<=9 years" ] <- "Education: \u2264 9 yrs"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "education_exp10-12 years" ] <- "Education: 10–12 yrs"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "education_exp<=9 years_Male" ] <- "Education: \u2264 9 yrs (males)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "education_exp10-12 years_Male" ] <- "Education: 10–12 yrs (males)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "education_exp<=9 years_Female" ] <- "Education: \u2264 9 yrs (females)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "education_exp10-12 years_Female" ] <- "Education: 10–12 yrs (females)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "income_exp<=2,500" ] <- "Incomeᵇ: \u2264 2,500"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "income_exp(2,500, 3,500]" ] <- "Incomeᵇ: (2,500, 3,500]"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "income_exp(3,500, 4,500]" ] <- "Incomeᵇ: (3,500, 4,500]"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "income_exp<=2,500_Male" ] <- "Incomeᵇ: \u2264 2,500 (males)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "income_exp(2,500, 3,500]_Male" ] <- "Incomeᵇ: (2,500, 3,500] (males)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "income_exp(3,500, 4,500]_Male" ] <- "Incomeᵇ: (3,500, 4,500] (males)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "income_exp<=2,500_Female" ] <- "Incomeᵇ: \u2264 2,500 (females)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "income_exp(2,500, 3,500]_Female" ] <- "Incomeᵇ: (2,500, 3,500] (females)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "income_exp(3,500, 4,500]_Female" ] <- "Incomeᵇ: (3,500, 4,500] (females)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "marital_status_expNever married" ] <- "Marital status: Never married"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "marital_status_expOther" ] <- "Marital status: Otherᶜ"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "living_status_expyes" ] <- "Living alone: Yes"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "personal_support_expno" ] <- "Personal support: No"

desired_order <- c( "Sex: Female", "Age: 16–29 yrs", "Age: 30–44 yrs", "Age: ≥ 60 yrs", "Age: 16–29 yrs (males)", "Age: 30–44 yrs (males)", "Age: ≥ 60 yrs (males)", "Age: 16–29 yrs (females)", "Age: 30–44 yrs (females)", "Age: ≥ 60 yrs (females)", "Country of birth: Europeᵃ", "Country of birth: Outside Europe", "Education: ≤ 9 yrs", "Education: 10–12 yrs", "Education: ≤ 9 yrs (males)", "Education: 10–12 yrs (males)", "Education: ≤ 9 yrs (females)", "Education: 10–12 yrs (females)", "Incomeᵇ: ≤ 2,500", "Incomeᵇ: (2,500, 3,500]", "Incomeᵇ: (3,500, 4,500]", "Incomeᵇ: ≤ 2,500 (males)", "Incomeᵇ: (2,500, 3,500] (males)", "Incomeᵇ: (3,500, 4,500] (males)", "Incomeᵇ: ≤ 2,500 (females)", "Incomeᵇ: (2,500, 3,500] (females)", "Incomeᵇ: (3,500, 4,500] (females)", "Marital status: Never married", "Marital status: Otherᶜ", "Living alone: Yes", "Personal support: No" )

results_cc_pr_all_models_2014 <- results_cc_pr_all_models_2014 %>%
  mutate( Exposure = factor( Exposure, levels = desired_order ) ) %>%
  arrange( Exposure )

results_cc_pr_all_models_2014 <- results_cc_pr_all_models_2014[ , !grepl( "model_1", names(results_cc_pr_all_models_2014 ) ) ]
names( results_cc_pr_all_models_2014 ) <- gsub( "model_2_poisson", "poisson", names( results_cc_pr_all_models_2014 ) )

long_data_2014 <- results_cc_pr_all_models_2014 %>%
  pivot_longer(
    cols = !Exposure, 
    names_to = "Identity_Statistic_Model", 
    values_to = "Value"
  )

long_data_2014 <- long_data_2014 %>%
  extract(
    col = Identity_Statistic_Model, 
    into = c( "Identity", "Statistic", "Model" ),
    regex = "^(.+?)_(lower_ci|upper_ci|point_estimate)_(\\w+)$",
    remove = TRUE
  )

long_data_2014 <- long_data_2014 %>%
  pivot_wider(
    names_from = Statistic, 
    values_from = Value
  )

long_data_2014 <- long_data_2014 %>%
  mutate(
    
    Identity = factor(
      case_when(
        Identity == "sexual_minority" ~ "Sexual minorities",
        Identity == "homosexual" ~ "Homosexual",
        Identity == "bisexual" ~ "Bisexual",
        Identity == "other" ~ "None of the above"
      ),
      levels = c( "Sexual minorities", "Homosexual", "Bisexual", "None of the above" )
    ),
    
    Model = factor(
      case_when(
        Model == "poisson" ~ "Poisson (PR)",
        Model == "log_binomial" ~ "Log-binomial (PR)",
        Model == "logistic" ~ "Logistic (OR)"
      ),
      levels = c("Poisson (PR)", "Log-binomial (PR)", "Logistic (OR)")
    )
  )


ggplot( long_data_2014, 
        aes( x = Identity, y = point_estimate, color = Identity, shape = Model ) ) +
  
  geom_point( position = position_dodge( width = 0.5 ) ) +
  geom_errorbar( aes( ymin = lower_ci, ymax = upper_ci ), 
                 position = position_dodge( width = 0.5 ), width = 0.2 ) +
  
  scale_color_manual( values = c( "#C77CFF", "#00BFC4", "#7CAE00", "#F8766D" ),
                      breaks = c( "Sexual minorities", "Homosexual", "Bisexual", "None of the above" )  ) +
  
  facet_wrap( ~ Exposure, scales = "free_y" ) +
  
  theme_minimal() +
  
  labs( x = NULL, y = "Point Estimate (95% CI)", color = "Sexual Identity", shape = "Model" ) +
  
  theme( axis.text.x = element_blank(),
         axis.title.y = element_text( family = "Arial", size = 11, margin = margin( r = 10, unit = "pt" ) ),
         legend.title = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         strip.text = element_text( family = "Arial", size = 9 ),
         panel.spacing = unit( 0.5, "lines" )
  )
```

##### 3.9.3. SPHC-B 2021
```{r}
results_cc_pr_all_models_2021 <- read_xlsx(here("results_cc_pr_all_models_2021.xlsx"))

results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "sex_expFemale" ] <- "Sex: Female"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp16-29" ] <- "Age: 16–29 yrs"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp30-44" ] <- "Age: 30–44 yrs"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp>=60" ] <- "Age: \u2265 60 yrs"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp16-29_Male" ] <- "Age: 16–29 yrs (males)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp30-44_Male" ] <- "Age: 30–44 yrs (males)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp>=60_Male" ] <- "Age: \u2265 60 yrs (males)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp16-29_Female" ] <- "Age: 16–29 yrs (females)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp30-44_Female" ] <- "Age: 30–44 yrs (females)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp>=60_Female" ] <- "Age: \u2265 60 yrs (females)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "country_of_birth_expEurope" ] <- "Country of birth: Europeᵃ"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "country_of_birth_expOutside Europe" ] <- "Country of birth: Outside Europe"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "education_exp<=9 years" ] <- "Education: \u2264 9 yrs"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "education_exp10-12 years" ] <- "Education: 10–12 yrs"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "education_exp<=9 years_Male" ] <- "Education: \u2264 9 yrs (males)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "education_exp10-12 years_Male" ] <- "Education: 10–12 yrs (males)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "education_exp<=9 years_Female" ] <- "Education: \u2264 9 yrs (females)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "education_exp10-12 years_Female" ] <- "Education: 10–12 yrs (females)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "income_exp<=2,500" ] <- "Incomeᵇ: \u2264 2,500"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "income_exp(2,500, 3,500]" ] <- "Incomeᵇ: (2,500, 3,500]"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "income_exp(3,500, 4,500]" ] <- "Incomeᵇ: (3,500, 4,500]"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "income_exp<=2,500_Male" ] <- "Incomeᵇ: \u2264 2,500 (males)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "income_exp(2,500, 3,500]_Male" ] <- "Incomeᵇ: (2,500, 3,500] (males)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "income_exp(3,500, 4,500]_Male" ] <- "Incomeᵇ: (3,500, 4,500] (males)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "income_exp<=2,500_Female" ] <- "Incomeᵇ: \u2264 2,500 (females)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "income_exp(2,500, 3,500]_Female" ] <- "Incomeᵇ: (2,500, 3,500] (females)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "income_exp(3,500, 4,500]_Female" ] <- "Incomeᵇ: (3,500, 4,500] (females)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "marital_status_expNever married" ] <- "Marital status: Never married"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "marital_status_expOther" ] <- "Marital status: Otherᶜ"

desired_order <- c( "Sex: Female", "Age: 16–29 yrs", "Age: 30–44 yrs", "Age: ≥ 60 yrs", "Age: 16–29 yrs (males)", "Age: 30–44 yrs (males)", "Age: ≥ 60 yrs (males)", "Age: 16–29 yrs (females)", "Age: 30–44 yrs (females)", "Age: ≥ 60 yrs (females)", "Country of birth: Europeᵃ", "Country of birth: Outside Europe", "Education: ≤ 9 yrs", "Education: 10–12 yrs", "Education: ≤ 9 yrs (males)", "Education: 10–12 yrs (males)", "Education: ≤ 9 yrs (females)", "Education: 10–12 yrs (females)", "Incomeᵇ: ≤ 2,500", "Incomeᵇ: (2,500, 3,500]", "Incomeᵇ: (3,500, 4,500]", "Incomeᵇ: ≤ 2,500 (males)", "Incomeᵇ: (2,500, 3,500] (males)", "Incomeᵇ: (3,500, 4,500] (males)", "Incomeᵇ: ≤ 2,500 (females)", "Incomeᵇ: (2,500, 3,500] (females)", "Incomeᵇ: (3,500, 4,500] (females)", "Marital status: Never married", "Marital status: Otherᶜ" )

results_cc_pr_all_models_2021 <- results_cc_pr_all_models_2021 %>%
  mutate( Exposure = factor( Exposure, levels = desired_order ) ) %>%
  arrange( Exposure )

results_cc_pr_all_models_2021 <- results_cc_pr_all_models_2021[ , !grepl( "model_1", names(results_cc_pr_all_models_2021 ) ) ]
names( results_cc_pr_all_models_2021 ) <- gsub( "model_2_poisson", "poisson", names( results_cc_pr_all_models_2021 ) )

long_data_2021 <- results_cc_pr_all_models_2021 %>%
  pivot_longer(
    cols = !Exposure, 
    names_to = "Identity_Statistic_Model", 
    values_to = "Value"
  )

long_data_2021 <- long_data_2021 %>%
  extract(
    col = Identity_Statistic_Model, 
    into = c( "Identity", "Statistic", "Model" ),
    regex = "^(.+?)_(lower_ci|upper_ci|point_estimate)_(\\w+)$",
    remove = TRUE
  )

long_data_2021 <- long_data_2021 %>%
  pivot_wider(
    names_from = Statistic, 
    values_from = Value
  )

long_data_2021 <- long_data_2021 %>%
  mutate(
    
    Identity = factor(
      case_when(
        Identity == "sexual_minority" ~ "Sexual minorities",
        Identity == "homosexual" ~ "Homosexual",
        Identity == "bisexual" ~ "Bisexual",
        Identity == "other" ~ "None of the above"
      ),
      levels = c( "Sexual minorities", "Homosexual", "Bisexual", "None of the above" )
    ),
    
    Model = factor(
      case_when(
        Model == "poisson" ~ "Poisson (PR)",
        Model == "log_binomial" ~ "Log-binomial (PR)",
        Model == "logistic" ~ "Logistic (OR)"
      ),
      levels = c("Poisson (PR)", "Log-binomial (PR)", "Logistic (OR)")
    )
  )


ggplot( long_data_2021, 
        aes( x = Identity, y = point_estimate, color = Identity, shape = Model ) ) +
  
  geom_point( position = position_dodge( width = 0.5 ) ) +
  geom_errorbar( aes( ymin = lower_ci, ymax = upper_ci ), 
                 position = position_dodge( width = 0.5 ), width = 0.2 ) +
  
  scale_color_manual( values = c( "#C77CFF", "#00BFC4", "#7CAE00", "#F8766D" ),
                      breaks = c( "Sexual minorities", "Homosexual", "Bisexual", "None of the above" )  ) +
  
  facet_wrap( ~ Exposure, scales = "free_y" ) +
  
  theme_minimal() +
  
  labs( x = NULL, y = "Point Estimate (95% CI)", color = "Sexual Identity", shape = "Model" ) +
  
  theme( axis.text.x = element_blank(),
         axis.title.y = element_text( family = "Arial", size = 11, margin = margin( r = 10, unit = "pt" ) ),
         legend.title = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         strip.text = element_text( family = "Arial", size = 9 ),
         panel.spacing = unit( 0.5, "lines" )
  )
```