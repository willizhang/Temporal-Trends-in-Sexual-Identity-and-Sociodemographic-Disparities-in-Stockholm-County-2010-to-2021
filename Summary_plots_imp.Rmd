---
title: "Summary plots of imputation analyses"
author: Guoqiang Zhang
email: guoqiang.zhang@ki.se
output: html_notebook
editor_options: 
  chunk_output_type: console
---

### 1. Load Packages
```{r}
library(forestploter)
library(grid)
library(readxl)
library(dplyr)
library(tidyr)
library(tibble)
library(ggplot2)
library(ggbreak)
library(naniar)
library(ggh4x)
```

### 2. Plots for Proportion of Sexual Identity
#### 2.1. Prepare dataset for plotting
```{r}
# datasets for proportion of sexual identity
prop_imp_summary_2010 <- read_excel("/Users/guoqiang.zhang/Library/CloudStorage/OneDrive-KarolinskaInstitutet/Karolinska Institutet/Research Projects/Population Trends and Individual Fluidity of Sexual Identity in Stockholm County/Original Research/Temporal-Trends-in-Sexual-Identity-and-Sociodemographic-Disparities-in-Stockholm-County-2010-to-2021/prop_imp_summary_2010.xlsx")
prop_imp_summary_2014 <- read_excel("/Users/guoqiang.zhang/Library/CloudStorage/OneDrive-KarolinskaInstitutet/Karolinska Institutet/Research Projects/Population Trends and Individual Fluidity of Sexual Identity in Stockholm County/Original Research/Temporal-Trends-in-Sexual-Identity-and-Sociodemographic-Disparities-in-Stockholm-County-2010-to-2021/prop_imp_summary_2014.xlsx")
prop_imp_summary_2021 <- read_excel("/Users/guoqiang.zhang/Library/CloudStorage/OneDrive-KarolinskaInstitutet/Karolinska Institutet/Research Projects/Population Trends and Individual Fluidity of Sexual Identity in Stockholm County/Original Research/Temporal-Trends-in-Sexual-Identity-and-Sociodemographic-Disparities-in-Stockholm-County-2010-to-2021/prop_imp_summary_2021.xlsx")

prop_imp_summary_2010 <- prop_imp_summary_2010 %>% slice( -c( 5:9 ) )
prop_imp_summary_2014 <- prop_imp_summary_2014 %>% slice( -c( 5:10 ) )
prop_imp_summary_2021 <- prop_imp_summary_2021 %>% slice( -c( 5:10 ) )

# to make it easier to combine across datasets
# a note on these changes will be added on the graph later
prop_imp_summary_2010$subgroup[ prop_imp_summary_2010$subgroup == "18-29" ] <- "16-29"
prop_imp_summary_2010$subgroup[ prop_imp_summary_2010$subgroup == "18-29.Male" ] <- "16-29.Male"
prop_imp_summary_2010$subgroup[ prop_imp_summary_2010$subgroup == "18-29.Female" ] <- "16-29.Female"

# merge datasets
prop_imp_summary <- prop_imp_summary_2010 %>%
  full_join( prop_imp_summary_2014, by = "subgroup" ) %>%
  full_join( prop_imp_summary_2021, by = "subgroup" )

# modify table format
desired_order <- c( "Male", "Female", "16-29", "30-44", "45-59", ">=60", "16-29.Male", "30-44.Male", "45-59.Male", ">=60.Male", "16-29.Female", "30-44.Female", "45-59.Female", ">=60.Female", "Sweden", "Europe", "Outside Europe", "<=9 years", "10-12 years", ">=13 years", "<=2,500", "(2,500, 3,500]", "(3,500, 4,500]", ">4,500", "Currently married", "Never married", "Other", "living_alone_yes", "living_alone_no", "personal_support_yes", "personal_support_no", "Stockholm County" )

prop_imp_summary <- prop_imp_summary %>%
  mutate( subgroup = factor( subgroup, levels = desired_order ) ) %>%
  arrange( subgroup )

prop_imp_summary <- prop_imp_summary %>% 
  add_row( subgroup = "Sex", .before = 1 )

prop_imp_summary <- prop_imp_summary %>% 
  add_row( subgroup = "Age group", .before = 4 )

prop_imp_summary <- prop_imp_summary %>% 
  add_row( subgroup = "Age by sex", .before = 9 )

prop_imp_summary <- prop_imp_summary %>% 
  add_row( subgroup = "Country of birth", .before = 18 )

prop_imp_summary <- prop_imp_summary %>% 
  add_row( subgroup = "Education years", .before = 22 )

prop_imp_summary <- prop_imp_summary %>% 
  add_row( subgroup = "Income (100 kr/yr)ᵈ", .before = 26 )

prop_imp_summary <- prop_imp_summary %>% 
  add_row( subgroup = "Marital statusᵉ", .before = 31 )

prop_imp_summary <- prop_imp_summary %>% 
  add_row( subgroup = "Living alone", .before = 35 )

prop_imp_summary <- prop_imp_summary %>% 
  add_row( subgroup = "Personal support", .before = 38 )

prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "16-29" ] <- "16–29 yrsᵇ"
prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "30-44" ] <- "30–44 yrs"
prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "45-59" ] <- "45–59 yrs"
prop_imp_summary$subgroup[ prop_imp_summary$subgroup == ">=60" ] <- "\u2265 60 yrs"

prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "16-29.Male" ] <- "Male: 16–29 yrsᵇ"
prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "30-44.Male" ] <- "Male: 30–44 yrs"
prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "45-59.Male" ] <- "Male: 45–59 yrs"
prop_imp_summary$subgroup[ prop_imp_summary$subgroup == ">=60.Male" ] <- "Male: \u2265 60 yrs"

prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "16-29.Female" ] <- "Female: 16–29 yrsᵇ"
prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "30-44.Female" ] <- "Female: 30–44 yrs"
prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "45-59.Female" ] <- "Female: 45–59 yrs"
prop_imp_summary$subgroup[ prop_imp_summary$subgroup == ">=60.Female" ] <- "Female: \u2265 60 yrs"

prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "<=9 years" ] <- "\u2264 9 yrs"
prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "10-12 years" ] <- "10–12 yrs"
prop_imp_summary$subgroup[ prop_imp_summary$subgroup == ">=13 years" ] <- "\u2265 13 yrs"

prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "Europe" ] <- "Europeᶜ"

prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "<=2,500" ] <- "\u2264 2,500"
prop_imp_summary$subgroup[ prop_imp_summary$subgroup == ">4,500" ] <- "> 4,500"

prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "living_alone_no" ] <- "No"
prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "living_alone_yes" ] <- "Yes"
prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "personal_support_no" ] <- "No"
prop_imp_summary$subgroup[ prop_imp_summary$subgroup == "personal_support_yes" ] <- "Yes"

prop_imp_summary$subgroup <- ifelse( is.na( prop_imp_summary$Heterosexual_point_estimate_2010 ) | 
                                      prop_imp_summary$subgroup == "Stockholm County", 
                                    prop_imp_summary$subgroup,
                                    paste0( "   ", prop_imp_summary$subgroup ) )

colnames( prop_imp_summary )[ colnames( prop_imp_summary ) == "subgroup" ] <- "Subgroup"

prop_imp_summary$sample_size_2010 <- ifelse( is.na( prop_imp_summary$sample_size_2010 ), "",
                                            prop_imp_summary$sample_size_2010 )

prop_imp_summary$sample_size_2014 <- ifelse( is.na( prop_imp_summary$sample_size_2014 ), "",
                                            prop_imp_summary$sample_size_2014 )

prop_imp_summary$sample_size_2021 <- ifelse( is.na( prop_imp_summary$sample_size_2021 ) &
                                              is.na( prop_imp_summary$Heterosexual_point_estimate_2010 ), "",
                                            ifelse( is.na( prop_imp_summary$sample_size_2021 ),  "\u2013",
                                                    prop_imp_summary$sample_size_2021 ) )
```

#### 2.2. Heterosexual group
```{r}
prop_imp_summary_heterosexual <- prop_imp_summary[ -c( 9:17 ), c( 1:4, 14:17, 27:30, 40 ) ]
  
prop_imp_summary_heterosexual <- prop_imp_summary_heterosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )
  
prop_imp_summary_heterosexual <- prop_imp_summary_heterosexual %>% 
  add_column( "SPHC-B 2010" = paste0(
    sprintf( "%.1f", prop_imp_summary_heterosexual$Heterosexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_heterosexual$Heterosexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_heterosexual$Heterosexual_upper_ci_2010*100 ), ")" ),
    .before = 3 )

prop_imp_summary_heterosexual <- prop_imp_summary_heterosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 8 )
  
prop_imp_summary_heterosexual <- prop_imp_summary_heterosexual %>% 
  add_column( "SPHC-B 2014" = paste0(
    sprintf( "%.1f", prop_imp_summary_heterosexual$Heterosexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_heterosexual$Heterosexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_heterosexual$Heterosexual_upper_ci_2014*100 ), ")" ),
    .before = 9 )
  
prop_imp_summary_heterosexual <- prop_imp_summary_heterosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 14 )
  
prop_imp_summary_heterosexual <- prop_imp_summary_heterosexual %>% 
  add_column( "SPHC-B 2021" = paste0(
  sprintf( "%.1f", prop_imp_summary_heterosexual$Heterosexual_point_estimate_2021*100 ), " (", 
  sprintf( "%.1f", prop_imp_summary_heterosexual$Heterosexual_lower_ci_2021*100 ), ", ", 
  sprintf( "%.1f", prop_imp_summary_heterosexual$Heterosexual_upper_ci_2021*100 ), ")"  ),
  .before = 15 )

prop_imp_summary_heterosexual$`SPHC-B 2010` <- ifelse( 
  is.na( prop_imp_summary_heterosexual$Heterosexual_point_estimate_2010 ), "",
  prop_imp_summary_heterosexual$`SPHC-B 2010` )

prop_imp_summary_heterosexual$`SPHC-B 2014` <- ifelse( 
  is.na( prop_imp_summary_heterosexual$Heterosexual_point_estimate_2014 ), "",
  prop_imp_summary_heterosexual$`SPHC-B 2014` )

prop_imp_summary_heterosexual$`SPHC-B 2021` <- ifelse( 
  is.na( prop_imp_summary_heterosexual$Heterosexual_point_estimate_2010 ) &
    is.na( prop_imp_summary_heterosexual$Heterosexual_point_estimate_2021 ), "",
  ifelse( is.na( prop_imp_summary_heterosexual$Heterosexual_point_estimate_2021 ), "\u2013",
          prop_imp_summary_heterosexual$`SPHC-B 2021` ) )

prop_imp_summary_heterosexual <- prop_imp_summary_heterosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 8 ) %>%
  add_column( temp3 = " ", .before = 10 ) %>%
  add_column( temp4 = " ", .before = 16 ) %>%
  add_column( temp5 = " ", .before = 18 ) %>%
  add_column( temp6 = " ", .before = 24 )

names( prop_imp_summary_heterosexual )[ names( prop_imp_summary_heterosexual ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5", "temp6" ) ] <- ""

colnames( prop_imp_summary_heterosexual )[ colnames( prop_imp_summary_heterosexual ) == "SPHC-B 2010" ] <- ""
colnames( prop_imp_summary_heterosexual )[ colnames( prop_imp_summary_heterosexual ) == "SPHC-B 2014" ] <- ""
colnames( prop_imp_summary_heterosexual )[ colnames( prop_imp_summary_heterosexual ) == "SPHC-B 2021" ] <- ""

colnames( prop_imp_summary_heterosexual )[ colnames( prop_imp_summary_heterosexual ) == "sample_size_2010" ] <- ""
colnames( prop_imp_summary_heterosexual )[ colnames( prop_imp_summary_heterosexual ) == "sample_size_2014" ] <- ""
colnames( prop_imp_summary_heterosexual )[ colnames( prop_imp_summary_heterosexual ) == "sample_size_2021" ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
  )
  
p_imp_heterosexual <- forest(
  prop_imp_summary_heterosexual[ , c( 1:4, 8:12, 16:20, 24, 25 ) ],
    
  est = list( prop_imp_summary_heterosexual$Heterosexual_point_estimate_2010*100,
              prop_imp_summary_heterosexual$Heterosexual_point_estimate_2014*100,
              prop_imp_summary_heterosexual$Heterosexual_point_estimate_2021*100
              ),
  
  lower = list( prop_imp_summary_heterosexual$Heterosexual_lower_ci_2010*100,
                prop_imp_summary_heterosexual$Heterosexual_lower_ci_2014*100,
                prop_imp_summary_heterosexual$Heterosexual_lower_ci_2021*100
                ),
  
  upper = list( prop_imp_summary_heterosexual$Heterosexual_upper_ci_2010*100,
                prop_imp_summary_heterosexual$Heterosexual_upper_ci_2014*100,
                prop_imp_summary_heterosexual$Heterosexual_upper_ci_2021*100
                ),
  
  ci_column = c( 3, 8, 13 ),
  is_summary = c( rep( FALSE, nrow( prop_imp_summary_heterosexual ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( prop_imp_summary_heterosexual[ prop_imp_summary_heterosexual$Subgroup == "Stockholm County", ]$Heterosexual_point_estimate_2010*100,
                prop_imp_summary_heterosexual[ prop_imp_summary_heterosexual$Subgroup == "Stockholm County", ]$Heterosexual_point_estimate_2014*100,
                prop_imp_summary_heterosexual[ prop_imp_summary_heterosexual$Subgroup == "Stockholm County", ]$Heterosexual_point_estimate_2021*100 ),
  
  vert_line = prop_imp_summary_heterosexual[ prop_imp_summary_heterosexual$Subgroup == "Stockholm County", ]$Heterosexual_point_estimate_2010*100,
    
  xlim = list( c( 80, 100 ), c( 60, 100 ), c( 60, 100 ) ),
  ticks_at = list( c( 80, 90, 100 ), c( 60, 80, 100 ), c( 60, 80, 100 ) ),
  xlab = "Proportion (%) (95% CI)",
  theme = tm
  )

p_imp_heterosexual <- edit_plot(
  p_imp_heterosexual,
  row = c( 1, 4, 9, 13, 17, 22, 26, 29, 32 ),
  gp = gpar(fontface = "bold")
)

p_imp_heterosexual <- add_text(
  p_imp_heterosexual,
  text = "Heterosexual, Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_heterosexual <- add_text(
  p_imp_heterosexual,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_heterosexual <- add_text(
  p_imp_heterosexual,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_heterosexual <- add_text(
  p_imp_heterosexual,
  text = "SSᵃ",
  col = 16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_heterosexual <- insert_text(
  p_imp_heterosexual,
  text = "SPHC-B 2010",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_heterosexual <- add_text(
  p_imp_heterosexual,
  text = "SPHC-B 2014",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_heterosexual <- add_text(
  p_imp_heterosexual,
  text = "Heterosexual, Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_heterosexual <- add_text(
  p_imp_heterosexual,
  text = "SPHC-B 2021",
  col = 13:16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_heterosexual <- add_text(
  p_imp_heterosexual,
  text = "Heterosexual, Proportion (%) (95% CI)",
  col = 13:14,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_heterosexual <- add_border(
  p_imp_heterosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_imp_heterosexual <- add_border(
  p_imp_heterosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_imp_heterosexual <- add_border(
  p_imp_heterosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 13:16,
  gp = gpar(lwd = 1)
)

p_imp_heterosexual <- edit_plot( p_imp_heterosexual,
                                row = c( 1, 4, 9, 13, 17, 22, 26, 29, 32 ), 
                                which = "background",
                                gp = gpar( fill = "white" )
                                )

p_imp_heterosexual <- edit_plot( p_imp_heterosexual,
                                row = c( 2, 3, 5:8, 10:12, 14:16, 18:21, 23:25, 27, 28, 30, 31 ), 
                                which = "background",
                                gp = gpar( fill = "#eff3f2" )
                                )
 
plot( p_imp_heterosexual )
```

#### 2.3. Homosexual group
```{r}
prop_imp_summary_homosexual <- prop_imp_summary[ -c( 9:17 ), c( 1, 5:7, 14, 18:20, 27, 31:33, 40 ) ]

prop_imp_summary_homosexual <- prop_imp_summary_homosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

prop_imp_summary_homosexual <- prop_imp_summary_homosexual %>% 
  add_column( "SPHC-B 2010" = paste0(
    sprintf( "%.1f", prop_imp_summary_homosexual$Homosexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_homosexual$Homosexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_homosexual$Homosexual_upper_ci_2010*100 ), ")" ),
    .before = 3 )

prop_imp_summary_homosexual <- prop_imp_summary_homosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 8 )

prop_imp_summary_homosexual <- prop_imp_summary_homosexual %>% 
  add_column( "SPHC-B 2014" = paste0(
    sprintf( "%.1f", prop_imp_summary_homosexual$Homosexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_homosexual$Homosexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_homosexual$Homosexual_upper_ci_2014*100 ), ")" ),
    .before = 9 )

prop_imp_summary_homosexual <- prop_imp_summary_homosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 14 )

prop_imp_summary_homosexual <- prop_imp_summary_homosexual %>% 
  add_column( "SPHC-B 2021" = paste0(
    sprintf( "%.1f", prop_imp_summary_homosexual$Homosexual_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_homosexual$Homosexual_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_homosexual$Homosexual_upper_ci_2021*100 ), ")"  ),
    .before = 15 )

prop_imp_summary_homosexual$`SPHC-B 2010` <- ifelse( 
  is.na( prop_imp_summary_homosexual$Homosexual_point_estimate_2010 ), "",
  prop_imp_summary_homosexual$`SPHC-B 2010` )

prop_imp_summary_homosexual$`SPHC-B 2014` <- ifelse( 
  is.na( prop_imp_summary_homosexual$Homosexual_point_estimate_2014 ), "",
  prop_imp_summary_homosexual$`SPHC-B 2014` )

prop_imp_summary_homosexual$`SPHC-B 2021` <- ifelse( 
  is.na( prop_imp_summary_homosexual$Homosexual_point_estimate_2010 ) &
    is.na( prop_imp_summary_homosexual$Homosexual_point_estimate_2021 ), "",
  ifelse( is.na( prop_imp_summary_homosexual$Homosexual_point_estimate_2021 ), "\u2013",
          prop_imp_summary_homosexual$`SPHC-B 2021` ) )

prop_imp_summary_homosexual <- prop_imp_summary_homosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 8 ) %>%
  add_column( temp3 = " ", .before = 10 ) %>%
  add_column( temp4 = " ", .before = 16 ) %>%
  add_column( temp5 = " ", .before = 18 ) %>%
  add_column( temp6 = " ", .before = 24 )

names( prop_imp_summary_homosexual )[ names( prop_imp_summary_homosexual ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5", "temp6" ) ] <- ""

colnames( prop_imp_summary_homosexual )[ colnames( prop_imp_summary_homosexual ) == "SPHC-B 2010" ] <- ""
colnames( prop_imp_summary_homosexual )[ colnames( prop_imp_summary_homosexual ) == "SPHC-B 2014" ] <- ""
colnames( prop_imp_summary_homosexual )[ colnames( prop_imp_summary_homosexual ) == "SPHC-B 2021" ] <- ""

colnames( prop_imp_summary_homosexual )[ colnames( prop_imp_summary_homosexual ) == "sample_size_2010" ] <- ""
colnames( prop_imp_summary_homosexual )[ colnames( prop_imp_summary_homosexual ) == "sample_size_2014" ] <- ""
colnames( prop_imp_summary_homosexual )[ colnames( prop_imp_summary_homosexual ) == "sample_size_2021" ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
)

p_imp_homosexual <- forest(
  prop_imp_summary_homosexual[ , c( 1:4, 8:12, 16:20, 24, 25 ) ],
  
  est = list( prop_imp_summary_homosexual$Homosexual_point_estimate_2010*100,
              prop_imp_summary_homosexual$Homosexual_point_estimate_2014*100,
              prop_imp_summary_homosexual$Homosexual_point_estimate_2021*100
  ),
  
  lower = list( prop_imp_summary_homosexual$Homosexual_lower_ci_2010*100,
                prop_imp_summary_homosexual$Homosexual_lower_ci_2014*100,
                prop_imp_summary_homosexual$Homosexual_lower_ci_2021*100
  ),
  
  upper = list( prop_imp_summary_homosexual$Homosexual_upper_ci_2010*100,
                prop_imp_summary_homosexual$Homosexual_upper_ci_2014*100,
                prop_imp_summary_homosexual$Homosexual_upper_ci_2021*100
  ),
  
  ci_column = c( 3, 8, 13 ),
  is_summary = c( rep( FALSE, nrow( prop_imp_summary_homosexual ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( prop_imp_summary_homosexual[ prop_imp_summary_homosexual$Subgroup == "Stockholm County", ]$Homosexual_point_estimate_2010*100,
                prop_imp_summary_homosexual[ prop_imp_summary_homosexual$Subgroup == "Stockholm County", ]$Homosexual_point_estimate_2014*100,
                prop_imp_summary_homosexual[ prop_imp_summary_homosexual$Subgroup == "Stockholm County", ]$Homosexual_point_estimate_2021*100 ),
  
  vert_line = prop_imp_summary_homosexual[ prop_imp_summary_homosexual$Subgroup == "Stockholm County", ]$Homosexual_point_estimate_2010*100,
  
  xlim = list( c( 0, 4 ), c( 0, 4 ), c( 0, 4 ) ),
  ticks_at = list( c( 0, 1, 2, 3, 4 ), c( 0, 1, 2, 3, 4 ), c( 0, 1, 2, 3, 4 ) ),
  xlab = "Proportion (%) (95% CI)",
  theme = tm
)

p_imp_homosexual <- edit_plot(
  p_imp_homosexual,
  row = c( 1, 4, 9, 13, 17, 22, 26, 29, 32 ),
  gp = gpar(fontface = "bold")
)

p_imp_homosexual <- add_text(
  p_imp_homosexual,
  text = "Homosexual, Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_homosexual <- add_text(
  p_imp_homosexual,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_homosexual <- add_text(
  p_imp_homosexual,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_homosexual <- add_text(
  p_imp_homosexual,
  text = "SSᵃ",
  col = 16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_homosexual <- insert_text(
  p_imp_homosexual,
  text = "SPHC-B 2010",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_homosexual <- add_text(
  p_imp_homosexual,
  text = "SPHC-B 2014",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_homosexual <- add_text(
  p_imp_homosexual,
  text = "Homosexual, Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_homosexual <- add_text(
  p_imp_homosexual,
  text = "SPHC-B 2021",
  col = 13:16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_homosexual <- add_text(
  p_imp_homosexual,
  text = "Homosexual, Proportion (%) (95% CI)",
  col = 13:14,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_homosexual <- add_border(
  p_imp_homosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_imp_homosexual <- add_border(
  p_imp_homosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_imp_homosexual <- add_border(
  p_imp_homosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 13:16,
  gp = gpar(lwd = 1)
)

p_imp_homosexual <- edit_plot( p_imp_homosexual,
                              row = c( 1, 4, 9, 13, 17, 22, 26, 29, 32 ), 
                              which = "background",
                              gp = gpar( fill = "white" )
                              )

p_imp_homosexual <- edit_plot( p_imp_homosexual,
                              row = c( 2, 3, 5:8, 10:12, 14:16, 18:21, 23:25, 27, 28, 30, 31 ), 
                              which = "background",
                              gp = gpar( fill = "#eff3f2" )
                              )

plot( p_imp_homosexual )
```

#### 2.4. Bisexual group
```{r}
prop_imp_summary_bisexual <- prop_imp_summary[ -c( 9:17 ), c( 1, 8:10, 14, 21:23, 27, 34:36, 40 ) ]

prop_imp_summary_bisexual <- prop_imp_summary_bisexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

prop_imp_summary_bisexual <- prop_imp_summary_bisexual %>% 
  add_column( "SPHC-B 2010" = paste0(
    sprintf( "%.1f", prop_imp_summary_bisexual$Bisexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_bisexual$Bisexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_bisexual$Bisexual_upper_ci_2010*100 ), ")" ),
    .before = 3 )

prop_imp_summary_bisexual <- prop_imp_summary_bisexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 8 )

prop_imp_summary_bisexual <- prop_imp_summary_bisexual %>% 
  add_column( "SPHC-B 2014" = paste0(
    sprintf( "%.1f", prop_imp_summary_bisexual$Bisexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_bisexual$Bisexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_bisexual$Bisexual_upper_ci_2014*100 ), ")" ),
    .before = 9 )

prop_imp_summary_bisexual <- prop_imp_summary_bisexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 14 )

prop_imp_summary_bisexual <- prop_imp_summary_bisexual %>% 
  add_column( "SPHC-B 2021" = paste0(
    sprintf( "%.1f", prop_imp_summary_bisexual$Bisexual_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_bisexual$Bisexual_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_bisexual$Bisexual_upper_ci_2021*100 ), ")"  ),
    .before = 15 )

prop_imp_summary_bisexual$`SPHC-B 2010` <- ifelse( 
  is.na( prop_imp_summary_bisexual$Bisexual_point_estimate_2010 ), "",
  prop_imp_summary_bisexual$`SPHC-B 2010` )

prop_imp_summary_bisexual$`SPHC-B 2014` <- ifelse( 
  is.na( prop_imp_summary_bisexual$Bisexual_point_estimate_2014 ), "",
  prop_imp_summary_bisexual$`SPHC-B 2014` )

prop_imp_summary_bisexual$`SPHC-B 2021` <- ifelse( 
  is.na( prop_imp_summary_bisexual$Bisexual_point_estimate_2010 ) &
    is.na( prop_imp_summary_bisexual$Bisexual_point_estimate_2021 ), "",
  ifelse( is.na( prop_imp_summary_bisexual$Bisexual_point_estimate_2021 ), "\u2013",
          prop_imp_summary_bisexual$`SPHC-B 2021` ) )

prop_imp_summary_bisexual <- prop_imp_summary_bisexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 8 ) %>%
  add_column( temp3 = " ", .before = 10 ) %>%
  add_column( temp4 = " ", .before = 16 ) %>%
  add_column( temp5 = " ", .before = 18 ) %>%
  add_column( temp6 = " ", .before = 24 )

names( prop_imp_summary_bisexual )[ names( prop_imp_summary_bisexual ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5", "temp6" ) ] <- ""

colnames( prop_imp_summary_bisexual )[ colnames( prop_imp_summary_bisexual ) == "SPHC-B 2010" ] <- ""
colnames( prop_imp_summary_bisexual )[ colnames( prop_imp_summary_bisexual ) == "SPHC-B 2014" ] <- ""
colnames( prop_imp_summary_bisexual )[ colnames( prop_imp_summary_bisexual ) == "SPHC-B 2021" ] <- ""

colnames( prop_imp_summary_bisexual )[ colnames( prop_imp_summary_bisexual ) == "sample_size_2010" ] <- ""
colnames( prop_imp_summary_bisexual )[ colnames( prop_imp_summary_bisexual ) == "sample_size_2014" ] <- ""
colnames( prop_imp_summary_bisexual )[ colnames( prop_imp_summary_bisexual ) == "sample_size_2021" ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
)

p_imp_bisexual <- forest(
  prop_imp_summary_bisexual[ , c( 1:4, 8:12, 16:20, 24, 25 ) ],
  
  est = list( prop_imp_summary_bisexual$Bisexual_point_estimate_2010*100,
              prop_imp_summary_bisexual$Bisexual_point_estimate_2014*100,
              prop_imp_summary_bisexual$Bisexual_point_estimate_2021*100
  ),
  
  lower = list( prop_imp_summary_bisexual$Bisexual_lower_ci_2010*100,
                prop_imp_summary_bisexual$Bisexual_lower_ci_2014*100,
                prop_imp_summary_bisexual$Bisexual_lower_ci_2021*100
  ),
  
  upper = list( prop_imp_summary_bisexual$Bisexual_upper_ci_2010*100,
                prop_imp_summary_bisexual$Bisexual_upper_ci_2014*100,
                prop_imp_summary_bisexual$Bisexual_upper_ci_2021*100
  ),
  
  ci_column = c( 3, 8, 13 ),
  is_summary = c( rep( FALSE, nrow( prop_imp_summary_bisexual ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( prop_imp_summary_bisexual[ prop_imp_summary_bisexual$Subgroup == "Stockholm County", ]$Bisexual_point_estimate_2010*100,
                prop_imp_summary_bisexual[ prop_imp_summary_bisexual$Subgroup == "Stockholm County", ]$Bisexual_point_estimate_2014*100,
                prop_imp_summary_bisexual[ prop_imp_summary_bisexual$Subgroup == "Stockholm County", ]$Bisexual_point_estimate_2021*100 ),
  
  vert_line = prop_imp_summary_bisexual[ prop_imp_summary_bisexual$Subgroup == "Stockholm County", ]$Bisexual_point_estimate_2010*100,
  
  xlim = list( c( 0, 5 ), c( 0, 8 ), c( 0, 10 ) ),
  ticks_at = list( c( 0, 1, 2, 3, 4, 5 ), c( 0, 2, 4, 6, 8 ), c( 0, 2, 4, 6, 8, 10 ) ),
  xlab = "Proportion (%) (95% CI)",
  theme = tm
)

p_imp_bisexual <- edit_plot(
  p_imp_bisexual,
  row = c( 1, 4, 9, 13, 17, 22, 26, 29, 32 ),
  gp = gpar(fontface = "bold")
)

p_imp_bisexual <- add_text(
  p_imp_bisexual,
  text = "Bisexual, Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_bisexual <- add_text(
  p_imp_bisexual,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_bisexual <- add_text(
  p_imp_bisexual,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_bisexual <- add_text(
  p_imp_bisexual,
  text = "SSᵃ",
  col = 16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_bisexual <- insert_text(
  p_imp_bisexual,
  text = "SPHC-B 2010",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_bisexual <- add_text(
  p_imp_bisexual,
  text = "SPHC-B 2014",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_bisexual <- add_text(
  p_imp_bisexual,
  text = "Bisexual, Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_bisexual <- add_text(
  p_imp_bisexual,
  text = "SPHC-B 2021",
  col = 13:16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_bisexual <- add_text(
  p_imp_bisexual,
  text = "Bisexual, Proportion (%) (95% CI)",
  col = 13:14,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_bisexual <- add_border(
  p_imp_bisexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_imp_bisexual <- add_border(
  p_imp_bisexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_imp_bisexual <- add_border(
  p_imp_bisexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 13:16,
  gp = gpar(lwd = 1)
)

p_imp_bisexual <- edit_plot( p_imp_bisexual,
                            row = c( 1, 4, 9, 13, 17, 22, 26, 29, 32 ), 
                            which = "background",
                            gp = gpar( fill = "white" )
                            )

p_imp_bisexual <- edit_plot( p_imp_bisexual,
                            row = c( 2, 3, 5:8, 10:12, 14:16, 18:21, 23:25, 27, 28, 30, 31 ), 
                            which = "background",
                            gp = gpar( fill = "#eff3f2" )
                            )

plot( p_imp_bisexual )
```

#### 2.5. Other group
```{r}
prop_imp_summary_other <- prop_imp_summary[ -c( 9:17 ), c( 1, 11:13, 14, 24:26, 27, 37:39, 40 ) ]

prop_imp_summary_other$Subgroup[ prop_imp_summary_other$Subgroup == "   16–29 yrsᵇ" ] <- "   16–29 yrsᶜ"
prop_imp_summary_other$Subgroup[ prop_imp_summary_other$Subgroup == "   Europeᶜ" ] <- "   Europeᵈ"
prop_imp_summary_other$Subgroup[ prop_imp_summary_other$Subgroup == "Income (100 kr/yr)ᵈ" ] <- "Income (100 kr/yr)ᵉ"
prop_imp_summary_other$Subgroup[ prop_imp_summary_other$Subgroup == "Marital statusᵉ" ] <- "Marital statusᶠ"

prop_imp_summary_other <- prop_imp_summary_other %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

prop_imp_summary_other <- prop_imp_summary_other %>% 
  add_column( "SPHC-B 2010" = paste0(
    sprintf( "%.1f", prop_imp_summary_other$Other_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_other$Other_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_other$Other_upper_ci_2010*100 ), ")" ),
    .before = 3 )

prop_imp_summary_other <- prop_imp_summary_other %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 8 )

prop_imp_summary_other <- prop_imp_summary_other %>% 
  add_column( "SPHC-B 2014" = paste0(
    sprintf( "%.1f", prop_imp_summary_other$Other_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_other$Other_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_other$Other_upper_ci_2014*100 ), ")" ),
    .before = 9 )

prop_imp_summary_other <- prop_imp_summary_other %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 14 )

prop_imp_summary_other <- prop_imp_summary_other %>% 
  add_column( "SPHC-B 2021" = paste0(
    sprintf( "%.1f", prop_imp_summary_other$Other_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_other$Other_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_other$Other_upper_ci_2021*100 ), ")"  ),
    .before = 15 )

prop_imp_summary_other$`SPHC-B 2010` <- ifelse( 
  is.na( prop_imp_summary_other$Other_point_estimate_2010 ), "",
  prop_imp_summary_other$`SPHC-B 2010` )

prop_imp_summary_other$`SPHC-B 2014` <- ifelse( 
  is.na( prop_imp_summary_other$Other_point_estimate_2014 ), "",
  prop_imp_summary_other$`SPHC-B 2014` )

prop_imp_summary_other$`SPHC-B 2021` <- ifelse( 
  is.na( prop_imp_summary_other$Other_point_estimate_2010 ) &
    is.na( prop_imp_summary_other$Other_point_estimate_2021 ), "",
  ifelse( is.na( prop_imp_summary_other$Other_point_estimate_2021 ), "\u2013",
          prop_imp_summary_other$`SPHC-B 2021` ) )

prop_imp_summary_other <- prop_imp_summary_other %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 8 ) %>%
  add_column( temp3 = " ", .before = 10 ) %>%
  add_column( temp4 = " ", .before = 16 ) %>%
  add_column( temp5 = " ", .before = 18 ) %>%
  add_column( temp6 = " ", .before = 24 )

names( prop_imp_summary_other )[ names( prop_imp_summary_other ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5", "temp6" ) ] <- ""

colnames( prop_imp_summary_other )[ colnames( prop_imp_summary_other ) == "SPHC-B 2010" ] <- ""
colnames( prop_imp_summary_other )[ colnames( prop_imp_summary_other ) == "SPHC-B 2014" ] <- ""
colnames( prop_imp_summary_other )[ colnames( prop_imp_summary_other ) == "SPHC-B 2021" ] <- ""

colnames( prop_imp_summary_other )[ colnames( prop_imp_summary_other ) == "sample_size_2010" ] <- ""
colnames( prop_imp_summary_other )[ colnames( prop_imp_summary_other ) == "sample_size_2014" ] <- ""
colnames( prop_imp_summary_other )[ colnames( prop_imp_summary_other ) == "sample_size_2021" ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
)

p_imp_other <- forest(
  prop_imp_summary_other[ , c( 1:4, 8:12, 16:20, 24, 25 ) ],
  
  est = list( prop_imp_summary_other$Other_point_estimate_2010*100,
              prop_imp_summary_other$Other_point_estimate_2014*100,
              prop_imp_summary_other$Other_point_estimate_2021*100
  ),
  
  lower = list( prop_imp_summary_other$Other_lower_ci_2010*100,
                prop_imp_summary_other$Other_lower_ci_2014*100,
                prop_imp_summary_other$Other_lower_ci_2021*100
  ),
  
  upper = list( prop_imp_summary_other$Other_upper_ci_2010*100,
                prop_imp_summary_other$Other_upper_ci_2014*100,
                prop_imp_summary_other$Other_upper_ci_2021*100
  ),
  
  ci_column = c( 3, 8, 13 ),
  is_summary = c( rep( FALSE, nrow( prop_imp_summary_other ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( prop_imp_summary_other[ prop_imp_summary_other$Subgroup == "Stockholm County", ]$Other_point_estimate_2010*100,
                prop_imp_summary_other[ prop_imp_summary_other$Subgroup == "Stockholm County", ]$Other_point_estimate_2014*100,
                prop_imp_summary_other[ prop_imp_summary_other$Subgroup == "Stockholm County", ]$Other_point_estimate_2021*100 ),
  
  vert_line = prop_imp_summary_other[ prop_imp_summary_other$Subgroup == "Stockholm County", ]$Other_point_estimate_2010*100,
  
  xlim = list( c( 0, 8 ), c( 0, 30 ), c( 0, 30 ) ),
  ticks_at = list( c( 0, 2, 4, 6, 8 ), c( 0, 5, 10, 15, 20, 25, 30 ), c( 0, 5, 10, 15, 20, 25, 30 ) ),
  xlab = "Proportion (%) (95% CI)",
  theme = tm
)

p_imp_other <- edit_plot(
  p_imp_other,
  row = c( 1, 4, 9, 13, 17, 22, 26, 29, 32 ),
  gp = gpar(fontface = "bold")
)

p_imp_other <- add_text(
  p_imp_other,
  text = "Uncertain, Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_other <- add_text(
  p_imp_other,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_other <- add_text(
  p_imp_other,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_other <- add_text(
  p_imp_other,
  text = "SSᵃ",
  col = 16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_other <- insert_text(
  p_imp_other,
  text = "SPHC-B 2010",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_other <- add_text(
  p_imp_other,
  text = "SPHC-B 2014",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_other <- add_text(
  p_imp_other,
  text = "Otherᵇ, Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_other <- add_text(
  p_imp_other,
  text = "SPHC-B 2021",
  col = 13:16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_other <- add_text(
  p_imp_other,
  text = "Otherᵇ, Proportion (%) (95% CI)",
  col = 13:14,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_other <- add_border(
  p_imp_other,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_imp_other <- add_border(
  p_imp_other,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_imp_other <- add_border(
  p_imp_other,
  part = "header",
  row = 1,
  where = "bottom",
  col = 13:16,
  gp = gpar(lwd = 1)
)

p_imp_other <- edit_plot( p_imp_other,
                         row = c( 1, 4, 9, 13, 17, 22, 26, 29, 32 ), 
                         which = "background",
                         gp = gpar( fill = "white" )
                         )

p_imp_other <- edit_plot( p_imp_other,
                         row = c( 2, 3, 5:8, 10:12, 14:16, 18:21, 23:25, 27, 28, 30, 31 ), 
                         which = "background",
                         gp = gpar( fill = "#eff3f2" )
                         )

plot( p_imp_other )
```

#### 2.6. Age by sex
```{r}
prop_imp_summary_age_sex <- prop_imp_summary[ c( 10:17 ), ]

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_row( Subgroup = "Male", .before = 1 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_row( Subgroup = "Female", .before = 6 )

prop_imp_summary_age_sex$Subgroup[ prop_imp_summary_age_sex$Subgroup == "   Male: 16–29 yrsᵇ" ] <- "   16–29 yrsᶜ\n\n"
prop_imp_summary_age_sex$Subgroup[ prop_imp_summary_age_sex$Subgroup == "   Male: 30–44 yrs" ] <- "   30–44 yrs\n\n"
prop_imp_summary_age_sex$Subgroup[ prop_imp_summary_age_sex$Subgroup == "   Male: 45–59 yrs" ] <- "   45–59 yrs\n\n"
prop_imp_summary_age_sex$Subgroup[ prop_imp_summary_age_sex$Subgroup == "   Male: \u2265 60 yrs" ] <- "   \u2265 60 yrs\n\n"

prop_imp_summary_age_sex$Subgroup[ prop_imp_summary_age_sex$Subgroup == "   Female: 16–29 yrsᵇ" ] <- "   16–29 yrsᶜ\n\n"
prop_imp_summary_age_sex$Subgroup[ prop_imp_summary_age_sex$Subgroup == "   Female: 30–44 yrs" ] <- "   30–44 yrs\n\n"
prop_imp_summary_age_sex$Subgroup[ prop_imp_summary_age_sex$Subgroup == "   Female: 45–59 yrs" ] <- "   45–59 yrs\n\n"
prop_imp_summary_age_sex$Subgroup[ prop_imp_summary_age_sex$Subgroup == "   Female: \u2265 60 yrs" ] <- "   \u2265 60 yrs\n\n"

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Heterosexual_2010" = paste0(
    sprintf( "%.1f", prop_imp_summary_age_sex$Heterosexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Heterosexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Heterosexual_upper_ci_2010*100 ), ")" ),
    .before = 2 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Homosexual_2010" = paste0(
    sprintf( "%.1f", prop_imp_summary_age_sex$Homosexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Homosexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Homosexual_upper_ci_2010*100 ), ")" ),
    .before = 6 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Bisexual_2010" = paste0(
    sprintf( "%.1f", prop_imp_summary_age_sex$Bisexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Bisexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Bisexual_upper_ci_2010*100 ), ")" ),
    .before = 10 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Other_2010" = paste0(
    sprintf( "%.1f", prop_imp_summary_age_sex$Other_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Other_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Other_upper_ci_2010*100 ), ")" ),
    .before = 14 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Heterosexual_2014" = paste0(
    sprintf( "%.1f", prop_imp_summary_age_sex$Heterosexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Heterosexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Heterosexual_upper_ci_2014*100 ), ")" ),
    .before = 19 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Homosexual_2014" = paste0(
    sprintf( "%.1f", prop_imp_summary_age_sex$Homosexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Homosexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Homosexual_upper_ci_2014*100 ), ")" ),
    .before = 23 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Bisexual_2014" = paste0(
    sprintf( "%.1f", prop_imp_summary_age_sex$Bisexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Bisexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Bisexual_upper_ci_2014*100 ), ")" ),
    .before = 27 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Other_2014" = paste0(
    sprintf( "%.1f", prop_imp_summary_age_sex$Other_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Other_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Other_upper_ci_2014*100 ), ")" ),
    .before = 31 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Heterosexual_2021" = paste0(
    sprintf( "%.1f", prop_imp_summary_age_sex$Heterosexual_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Heterosexual_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Heterosexual_upper_ci_2021*100 ), ")" ),
    .before = 36 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Homosexual_2021" = paste0(
    sprintf( "%.1f", prop_imp_summary_age_sex$Homosexual_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Homosexual_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Homosexual_upper_ci_2021*100 ), ")" ),
    .before = 40 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Bisexual_2021" = paste0(
    sprintf( "%.1f", prop_imp_summary_age_sex$Bisexual_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Bisexual_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Bisexual_upper_ci_2021*100 ), ")" ),
    .before = 44 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Other_2021" = paste0(
    sprintf( "%.1f", prop_imp_summary_age_sex$Other_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Other_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_imp_summary_age_sex$Other_upper_ci_2021*100 ), ")" ),
    .before = 48 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Heterosexual" = paste( prop_imp_summary_age_sex$`Heterosexual_2010`,
                                      prop_imp_summary_age_sex$`Heterosexual_2014`,
                                      prop_imp_summary_age_sex$`Heterosexual_2021`,
                                      sep = "\n" ),
              .before = 2 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Homosexual" = paste( prop_imp_summary_age_sex$`Homosexual_2010`,
                                    prop_imp_summary_age_sex$`Homosexual_2014`,
                                    prop_imp_summary_age_sex$`Homosexual_2021`,
                                    sep = "\n" ),
              .before = 3 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Bisexual" = paste( prop_imp_summary_age_sex$`Bisexual_2010`,
                                  prop_imp_summary_age_sex$`Bisexual_2014`,
                                  prop_imp_summary_age_sex$`Bisexual_2021`,
                                  sep = "\n" ),
              .before = 4 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Otherᵇ" = paste( prop_imp_summary_age_sex$`Other_2010`,
                                prop_imp_summary_age_sex$`Other_2014`,
                                prop_imp_summary_age_sex$`Other_2021`,
                                sep = "\n" ),
              .before = 5 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( "Nᵃ" = paste( prop_imp_summary_age_sex$sample_size_2010,
                            prop_imp_summary_age_sex$sample_size_2014,
                            prop_imp_summary_age_sex$sample_size_2021,
                            sep = "\n" ),
              .before = 2 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 3 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 5 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 7 )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>% 
  add_column( `    ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 9 )

prop_imp_summary_age_sex$`Nᵃ` <- ifelse( is.na( prop_imp_summary_age_sex$Heterosexual_point_estimate_2010 ), "",
                                      prop_imp_summary_age_sex$`Nᵃ` )

prop_imp_summary_age_sex$`Heterosexual` <- ifelse( is.na( prop_imp_summary_age_sex$Heterosexual_point_estimate_2010 ), "",
                                                   prop_imp_summary_age_sex$`Heterosexual` )

prop_imp_summary_age_sex$`Homosexual` <- ifelse( is.na( prop_imp_summary_age_sex$Heterosexual_point_estimate_2010 ), "",
                                                 prop_imp_summary_age_sex$`Homosexual` )

prop_imp_summary_age_sex$`Bisexual` <- ifelse( is.na( prop_imp_summary_age_sex$Heterosexual_point_estimate_2010 ), "",
                                               prop_imp_summary_age_sex$`Bisexual` )

prop_imp_summary_age_sex$`Otherᵇ` <- ifelse( is.na( prop_imp_summary_age_sex$Heterosexual_point_estimate_2010 ), "",
                                                   prop_imp_summary_age_sex$`Otherᵇ` )

prop_imp_summary_age_sex <- prop_imp_summary_age_sex %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 4 ) %>%
  add_column( temp3 = " ", .before = 7 ) %>%
  add_column( temp4 = " ", .before = 10 ) %>%
  add_column( temp5 = " ", .before = 13 )

names( prop_imp_summary_age_sex )[ names( prop_imp_summary_age_sex ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5" ) ] <- ""

colnames( prop_imp_summary_age_sex )[ colnames( prop_imp_summary_age_sex ) == "Nᵃ" ] <- ""
colnames( prop_imp_summary_age_sex )[ colnames( prop_imp_summary_age_sex ) == "Heterosexual" ] <- ""
colnames( prop_imp_summary_age_sex )[ colnames( prop_imp_summary_age_sex ) == "Homosexual" ] <- ""
colnames( prop_imp_summary_age_sex )[ colnames( prop_imp_summary_age_sex ) == "Bisexual" ] <- ""
colnames( prop_imp_summary_age_sex )[ colnames( prop_imp_summary_age_sex ) == "Otherᵇ" ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "#DF536B",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = c( "#2297E6", "#61D04F" )
  )

p_imp_age_sex <- forest(
  prop_imp_summary_age_sex[ , 1:15 ],
  
  est = list( prop_imp_summary_age_sex$Heterosexual_point_estimate_2010*100,
              prop_imp_summary_age_sex$Homosexual_point_estimate_2010*100,
              prop_imp_summary_age_sex$Bisexual_point_estimate_2010*100,
              prop_imp_summary_age_sex$Other_point_estimate_2010*100,
              prop_imp_summary_age_sex$Heterosexual_point_estimate_2014*100,
              prop_imp_summary_age_sex$Homosexual_point_estimate_2014*100,
              prop_imp_summary_age_sex$Bisexual_point_estimate_2014*100,
              prop_imp_summary_age_sex$Other_point_estimate_2014*100,
              prop_imp_summary_age_sex$Heterosexual_point_estimate_2021*100,
              prop_imp_summary_age_sex$Homosexual_point_estimate_2021*100,
              prop_imp_summary_age_sex$Bisexual_point_estimate_2021*100,
              prop_imp_summary_age_sex$Other_point_estimate_2021*100
              ),
  
  lower = list( prop_imp_summary_age_sex$Heterosexual_lower_ci_2010*100,
                prop_imp_summary_age_sex$Homosexual_lower_ci_2010*100,
                prop_imp_summary_age_sex$Bisexual_lower_ci_2010*100,
                prop_imp_summary_age_sex$Other_lower_ci_2010*100,
                prop_imp_summary_age_sex$Heterosexual_lower_ci_2014*100,
                prop_imp_summary_age_sex$Homosexual_lower_ci_2014*100,
                prop_imp_summary_age_sex$Bisexual_lower_ci_2014*100,
                prop_imp_summary_age_sex$Other_lower_ci_2014*100,
                prop_imp_summary_age_sex$Heterosexual_lower_ci_2021*100,
                prop_imp_summary_age_sex$Homosexual_lower_ci_2021*100,
                prop_imp_summary_age_sex$Bisexual_lower_ci_2021*100,
                prop_imp_summary_age_sex$Other_lower_ci_2021*100
                ),
  
  upper = list( prop_imp_summary_age_sex$Heterosexual_upper_ci_2010*100,
                prop_imp_summary_age_sex$Homosexual_upper_ci_2010*100,
                prop_imp_summary_age_sex$Bisexual_upper_ci_2010*100,
                prop_imp_summary_age_sex$Other_upper_ci_2010*100,
                prop_imp_summary_age_sex$Heterosexual_upper_ci_2014*100,
                prop_imp_summary_age_sex$Homosexual_upper_ci_2014*100,
                prop_imp_summary_age_sex$Bisexual_upper_ci_2014*100,
                prop_imp_summary_age_sex$Other_upper_ci_2014*100,
                prop_imp_summary_age_sex$Heterosexual_upper_ci_2021*100,
                prop_imp_summary_age_sex$Homosexual_upper_ci_2021*100,
                prop_imp_summary_age_sex$Bisexual_upper_ci_2021*100,
                prop_imp_summary_age_sex$Other_upper_ci_2021*100
                ),
  
  ci_column = c( 5, 8, 11, 14 ),
  sizes = 0.4,
  
  ref_line = c( 
    prop_imp_summary[ prop_imp_summary$Subgroup == "Stockholm County", ]$Heterosexual_point_estimate_2010*100,
    prop_imp_summary[ prop_imp_summary$Subgroup == "Stockholm County", ]$Homosexual_point_estimate_2010*100,
    prop_imp_summary[ prop_imp_summary$Subgroup == "Stockholm County", ]$Bisexual_point_estimate_2010*100,
    prop_imp_summary[ prop_imp_summary$Subgroup == "Stockholm County", ]$Other_point_estimate_2010*100
    ),
  
  xlim = list( c( 70, 100 ), c( 0, 5 ), c( 0, 15 ), c( 0, 20 ) ),
  ticks_at = list( c( 70, 80, 90, 100 ), c( 0, 1, 2, 3, 4, 5 ), c( 0, 5, 10, 15 ), c( 0, 5, 10, 15, 20 ) ),
  
  xlab = "Proportion (%) (95% CI)",
  nudge_y = 0.33,
  theme = tm
 )

p_imp_age_sex <- edit_plot(p_imp_age_sex,
                          row = c( 1, 6 ),
                          gp = gpar(fontface = "bold"))

p_imp_age_sex <- add_text(
  p_imp_age_sex,
  text = "SSᵃ",
  col = 3,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_age_sex <- add_text(
  p_imp_age_sex,
  text = "Proportion (%) (95% CI)",
  col = 5:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_age_sex <- add_text(
  p_imp_age_sex,
  text = "Proportion (%) (95% CI)",
  col = 8:9,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_age_sex <- add_text(
  p_imp_age_sex,
  text = "Proportion (%) (95% CI)",
  col = 11:12,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_age_sex <- add_text(
  p_imp_age_sex,
  text = "Proportion (%) (95% CI)",
  col = 14:15,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_age_sex <- insert_text(
  p_imp_age_sex,
  text = "Heterosexual",
  col = 5:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_age_sex <- add_text(
  p_imp_age_sex,
  text = "Homosexual",
  col = 8:9,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_age_sex <- add_text(
  p_imp_age_sex,
  text = "Bisexual",
  col = 11:12,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_age_sex <- add_text(
  p_imp_age_sex,
  text = "Uncertain/Otherᵇ",
  col = 14:15,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_age_sex <- edit_plot( p_imp_age_sex,
                           row = c( 1, 6 ), 
                           which = "background",
                           gp = gpar( fill = "white" )
                           )

p_imp_age_sex <- edit_plot( p_imp_age_sex,
                           row = c( 2:5, 7:10 ), 
                           which = "background",
                           gp = gpar( fill = "#eff3f2" )
                           )

p_imp_age_sex <- add_border(
  p_imp_age_sex,
  part = "header",
  row = 2,
  col = c( 5:6, 8:9, 11:12, 14:15 ),
  where = "bottom",
  gp = gpar(lwd = 1)
)

plot( p_imp_age_sex )
```

#### 2.7. By generation
```{r}
# datasets for proportion of sexual identity
prop_imp_summary_2010_generation <- read_excel("/Users/guoqiang.zhang/Library/CloudStorage/OneDrive-KarolinskaInstitutet/Karolinska Institutet/Research Projects/Population Trends and Individual Fluidity of Sexual Identity in Stockholm County/Original Research/Temporal-Trends-in-Sexual-Identity-and-Sociodemographic-Disparities-in-Stockholm-County-2010-to-2021/prop_cc_summary_2010.xlsx")
prop_imp_summary_2014_generation <- read_excel("/Users/guoqiang.zhang/Library/CloudStorage/OneDrive-KarolinskaInstitutet/Karolinska Institutet/Research Projects/Population Trends and Individual Fluidity of Sexual Identity in Stockholm County/Original Research/Temporal-Trends-in-Sexual-Identity-and-Sociodemographic-Disparities-in-Stockholm-County-2010-to-2021/prop_cc_summary_2014.xlsx")
prop_imp_summary_2021_generation <- read_excel("/Users/guoqiang.zhang/Library/CloudStorage/OneDrive-KarolinskaInstitutet/Karolinska Institutet/Research Projects/Population Trends and Individual Fluidity of Sexual Identity in Stockholm County/Original Research/Temporal-Trends-in-Sexual-Identity-and-Sociodemographic-Disparities-in-Stockholm-County-2010-to-2021/prop_cc_summary_2021.xlsx")

prop_imp_summary_2010_generation <- prop_imp_summary_2010_generation %>% slice( 7:16 )
prop_imp_summary_2014_generation <- prop_imp_summary_2014_generation %>% slice( 7:18 )
prop_imp_summary_2021_generation <- prop_imp_summary_2021_generation %>% slice( 7:18 )

# merge datasets
prop_imp_summary_generation <- prop_imp_summary_2010_generation %>%
  full_join( prop_imp_summary_2014_generation, by = "subgroup" ) %>%
  full_join( prop_imp_summary_2021_generation, by = "subgroup" )

prop_imp_summary_generation <- prop_imp_summary_generation %>% 
  separate( subgroup, into = c( "generation", "sex" ), sep = "\\." )

# convert to long format
long_data_generation <- prop_imp_summary_generation %>%
  select( generation, sex, contains( "point_estimate" ) ) %>%
  pivot_longer(
    cols = -c( generation, sex ),
    names_to = "year_identity",
    values_to = "proportion"
    ) %>%
  separate( year_identity, into = c( "identity", "year" ), sep = "_point_estimate_" )

unique( long_data_generation$identity )
long_data_generation$identity <- ifelse( long_data_generation$identity == "Uncertain" |
                                           long_data_generation$identity == "None of the above", "Other",
                                         long_data_generation$identity )
table( long_data_generation$identity, useNA = "always" )
  
long_data_generation <- long_data_generation %>%
  mutate( identity = factor( identity, levels = c( "Heterosexual", "Bisexual", "Homosexual", "Other" ) ) )
str( long_data_generation )

# plot
# for bisexual and homosexual
ggplot( drop_na( long_data_generation %>% 
                   filter( identity %in% c( "Homosexual", "Bisexual" ) ) ), 
        aes( x = year, y = proportion, color = generation, linetype = sex, group = interaction( generation, sex ) ) ) +
  
  geom_line( linewidth = 0.5 ) + 
  geom_point( size = 2 ) +
  
  scale_x_discrete( expand = c( 0.05, 0 ) ) +
  scale_y_continuous( labels = scales::percent ) +
  
  scale_color_manual( values = c( "#C77CFF", "#7CAE00", "orange", "#00BFC4", "#F8766D", "brown" ),
                      breaks = c( "Generation Z (1997–2012)", "Millennials (1981–1996)", "Generation X (1965–1980)", "Baby Boomers (1946–1964)", "Silent Generation (1928–1945)", "Greatest Generation (1901–1927)" ),
                      labels = c( "Generation Z (1997–2012)ᵃ", "Millennials (1981–1996)", "Generation X (1965–1980)", "Baby Boomers (1946–1964)", "Silent Generation (1928–1945)", "Greatest Generation (1901–1927)" ),
                      guide = guide_legend( nrow = 6 ) ) +
  
  scale_linetype_manual( values = c( "solid", "dotdash" ),
                         breaks = c( "Female", "Male" ),
                         guide = guide_legend( nrow = 2 ) ) + 
  
  labs(
    x = "Survey Year",
    y = "Proportion" ) +
  
  theme_classic() +
  theme( axis.title.x = element_text( family = "Arial", size = 11 ),
         axis.text.x = element_text( family = "Arial", size = 11 ),
         axis.text.y = element_text( family = "Arial", size = 11 ),
         axis.title.y = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         legend.title = element_blank(),
         legend.position = "right",
         strip.background = element_blank(),
         strip.text = element_text( family = "Arial", size = 12 ),
         panel.spacing = unit( 2, "lines" ) ) +
  
  facet_wrap( ~ identity, 
              ncol = 1, 
              scales = "free_y",
              labeller = labeller( identity = c( "Homosexual" = "Homosexual Identity",
                                                 "Bisexual" = "Bisexual Identity" ) ) ) +
  ggh4x::facetted_pos_scales( y = list(
    identity == "Homosexual" ~ scale_y_continuous( labels = scales::percent, limits = c( 0, 0.04 ), breaks = c( 0, 0.01, 0.02, 0.03, 0.04 ) ),
    identity == "Bisexual" ~ scale_y_continuous( labels = scales::percent, limits = c( 0, 0.15 ), breaks = c( 0, 0.05, 0.1, 0.15 ) )
  ) )

# for heterosexual and other
ggplot( drop_na( long_data_generation %>% 
                   filter( identity %in% c( "Heterosexual", "Other" ) ) ), 
        aes( x = year, y = proportion, color = generation, linetype = sex, group = interaction( generation, sex ) ) ) +
  
  geom_line( linewidth = 0.5 ) + 
  geom_point( size = 2 ) +
  
  scale_x_discrete( expand = c( 0.05, 0 ) ) +
  scale_y_continuous( labels = scales::percent ) +
  
  scale_color_manual( values = c( "#C77CFF", "#7CAE00", "orange", "#00BFC4", "#F8766D", "brown" ),
                      breaks = c( "Generation Z (1997–2012)", "Millennials (1981–1996)", "Generation X (1965–1980)", "Baby Boomers (1946–1964)", "Silent Generation (1928–1945)", "Greatest Generation (1901–1927)" ),
                      labels = c( "Generation Z (1997–2012)ᵇ", "Millennials (1981–1996)", "Generation X (1965–1980)", "Baby Boomers (1946–1964)", "Silent Generation (1928–1945)", "Greatest Generation (1901–1927)" ),
                      guide = guide_legend( nrow = 6 ) ) +
  
  scale_linetype_manual( values = c( "solid", "dotdash" ),
                         breaks = c( "Female", "Male" ),
                         guide = guide_legend( nrow = 2 ) ) + 
  
  labs(
    x = "Survey Year",
    y = "Proportion" ) +
  
  theme_classic() +
  theme( axis.title.x = element_text( family = "Arial", size = 11 ),
         axis.text.x = element_text( family = "Arial", size = 11 ),
         axis.text.y = element_text( family = "Arial", size = 11 ),
         axis.title.y = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         legend.title = element_blank(),
         legend.position = "right",
         strip.background = element_blank(),
         strip.text = element_text( family = "Arial", size = 12 ),
         panel.spacing = unit( 2, "lines" ) ) +
  
  facet_wrap( ~ identity, 
              ncol = 1, 
              scales = "free_y",
              labeller = labeller( identity = c( "Heterosexual" = "Heterosexual Identity",
                                                 "Other" = "Other Identitiesᵃ" ) ) ) +
  ggh4x::facetted_pos_scales( y = list(
    identity == "Heterosexual" ~ scale_y_continuous( labels = scales::percent, limits = c( 0.65, 1 ), breaks = c( 0.7, 0.8, 0.9, 1 ) ),
    identity == "Other" ~ scale_y_continuous( labels = scales::percent, limits = c( 0, 0.35 ), breaks = c( 0, 0.1, 0.2, 0.3 ) )
  ) )
```

#### 2.8. Proportion by varing age cut-offs
```{r}
prop_imp_age_iteration_2010 <- read_excel("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/prop_imp_age_iteration_2010.xlsx") %>%
  filter( subgroup == 'young' ) %>%
  select( -subgroup )

prop_imp_age_iteration_2014 <- read_excel("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/prop_imp_age_iteration_2014.xlsx") %>%
  filter( subgroup == 'young' ) %>%
  select( -subgroup )

prop_imp_age_iteration_2021 <- read_excel("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/prop_imp_age_iteration_2021.xlsx") %>%
  filter( subgroup == 'young' ) %>%
  select( -subgroup )

prop_imp_age_iteration_merged <- prop_imp_age_iteration_2010 %>%
  full_join( prop_imp_age_iteration_2014, by = "cut_off" ) %>%
  full_join( prop_imp_age_iteration_2021, by = "cut_off" )

long_data <- prop_imp_age_iteration_merged %>% 
  pivot_longer( 
    cols = - cut_off, 
    names_to = c( "Sexuality", "Estimate_Type", "Year" ), 
    names_pattern = "([A-Za-z]+)_(\\w+)_(\\d+)", 
    values_to = "Value" 
  )


ggplot( long_data, 
        aes( x = cut_off, y = Value, color = Sexuality, linetype = Year ) 
        ) +
  
  geom_line( ) +
  
  scale_linetype_manual( values = c( "2010" = "dotdash", "2014" = "dashed", "2021" = "solid" ),
                         labels = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ) 
  ) +
  
  scale_color_manual( values = c( "#C77CFF", "#00BFC4", "#7CAE00", "#F8766D" ),
                      breaks = c( "Heterosexual", "Homosexual", "Bisexual", "Other" ),
                      labels = c( "Heterosexual", "Homosexual", "Bisexual", "Otherᶜ" )
  ) +
  
  scale_x_continuous( limits = c( 15, 100 ), 
                      breaks = seq( 15, 100, by = 5 ),
                      expand = c( 0.02, 0 )
  ) +
  
  scale_y_continuous( labels = scales::percent,
                      limits = c( 0, 1 ), 
                      breaks = c( 0, 0.02, 0.04, 0.06, 0.08, 0.1, 0.8, 0.9, 1 )
  ) +
  
  scale_y_break( c( 0.12, 0.75 ), scales = 1, space = 0.3, expand = c( 0, 0 ) ) +
  
  labs( x = "Age cut-off (years)ᵃ", 
        y = "Proportionᵇ"
  ) +
  
  theme_classic() +
  
  theme( axis.text.y = element_text( family = "Arial", size = 11 ),
         axis.title.y = element_text( family = "Arial", size = 11 ),
         axis.title.x = element_text( family = "Arial", size = 11 ),
         axis.text.x = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         legend.position = "right",
         legend.title = element_blank(),
         axis.text.y.right = element_blank(),
         axis.ticks.y.right = element_blank(),
         axis.line.y.right = element_blank()
  )
```

#### 2.9. By age group
##### 2.9.1. Prepare dataset for plotting
```{r}
prop_imp_age_group_2010 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/prop_imp_age_group_2010.xlsx") %>%
  select( "subgroup", "Heterosexual_point_estimate_2010", "Homosexual_point_estimate_2010", "Bisexual_point_estimate_2010", "Other_point_estimate_2010" )

prop_imp_age_group_2014 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/prop_imp_age_group_2014.xlsx") %>%
  select( "subgroup", "Heterosexual_point_estimate_2014", "Homosexual_point_estimate_2014", "Bisexual_point_estimate_2014", "Other_point_estimate_2014" )

prop_imp_age_group_2021 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/prop_imp_age_group_2021.xlsx") %>%
  select( "subgroup", "Heterosexual_point_estimate_2021", "Homosexual_point_estimate_2021", "Bisexual_point_estimate_2021", "Other_point_estimate_2021" )

prop_imp_age_group_2010$subgroup[ prop_imp_age_group_2010$subgroup == "[17,19]" ] <- "(17,19]"
prop_imp_age_group_2014$subgroup[ prop_imp_age_group_2014$subgroup == "[15,17]" ] <- "[16,17]"
prop_imp_age_group_2021$subgroup[ prop_imp_age_group_2021$subgroup == "[15,17]" ] <- "[16,17]"

prop_imp_age_group_merged <- prop_imp_age_group_2010 %>%
  full_join( prop_imp_age_group_2014, by = "subgroup" ) %>%
  full_join( prop_imp_age_group_2021, by = "subgroup" )

new_subgroup_label <- function( label ) {
  if ( startsWith( label, "(" ) ) {
    nums <- as.numeric( unlist( strsplit( gsub( "[^0-9,]", "", label ), "," ) ) )
    new_label <- sprintf( "[%d,%d]", nums[1] + 1, nums[2] )
    return( new_label )
  } else {
    return( label )
  }
}

prop_imp_age_group_merged$new_subgroup <- sapply( prop_imp_age_group_merged$subgroup, new_subgroup_label )

prop_imp_age_group_merged <- prop_imp_age_group_merged %>% relocate( new_subgroup, .after = subgroup )

age_group_order <- c( "[16,17]", "[18,19]", "[20,21]", "[22,23]", "[24,25]", "[26,27]", "[28,29]", "[30,31]", 
                      "[32,33]", "[34,35]", "[36,37]", "[38,39]", "[40,41]", "[42,43]", "[44,45]", "[46,47]", 
                      "[48,49]", "[50,51]", "[52,53]", "[54,55]", "[56,57]", "[58,59]", "[60,61]", "[62,63]", 
                      "[64,65]", "[66,67]", "[68,69]", "[70,71]", "[72,73]", "[74,75]", "[76,77]", "[78,79]" )

prop_imp_age_group_merged$new_subgroup <- factor( prop_imp_age_group_merged$new_subgroup, levels = age_group_order )

long_data_age_group <- prop_imp_age_group_merged %>% 
  pivot_longer( 
    cols = - c( subgroup, new_subgroup ), 
    names_to = c( "Sexuality", "Estimate_Type", "Year" ), 
    names_pattern = "([A-Za-z]+)_(\\w+)_(\\d+)", 
    values_to = "Value" 
  )
```

##### 2.9.2. Plotting
```{r}
ggplot( long_data_age_group, 
        aes( x = new_subgroup, y = Value, color = Sexuality, linetype = Year,  group = interaction( Sexuality, Year ) ) ) +
  
  geom_line( ) +
  
  scale_linetype_manual( values = c( "2010" = "dotdash", "2014" = "dashed", "2021" = "solid" ),
                         labels = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ) 
                         ) +
  
  scale_color_manual( values = c( "#C77CFF", "#00BFC4", "#7CAE00", "#F8766D" ),
                      breaks = c( "Heterosexual", "Homosexual", "Bisexual", "Other" ),
                      labels = c( "Heterosexual", "Homosexual", "Bisexual", "Otherᵇ" )
                      ) +
  
  scale_y_continuous( labels = scales::percent,
                      limits = c( 0, 1 ), 
                      breaks = c( 0, 0.05, 0.1, 0.15, 0.2, 0.8, 0.9, 1 )
                      ) +
  
  scale_y_break( c( 0.19, 0.74 ), scales = 1, space = 0.3, expand = c( 0, 0 ) ) +
  
  labs( x = "Age group (years)ᵃ", 
        y = "Proportion"
        ) +
  
  theme_classic() +
  
  theme( axis.text.y = element_text( family = "Arial", size = 11 ),
         axis.title.y = element_text( family = "Arial", size = 11 ),
         axis.title.x = element_text( family = "Arial", size = 11 ),
         axis.text.x = element_text( family = "Arial", size = 11, angle = 45, vjust = 0.5, hjust = 0.5 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         legend.position = "right",
         legend.title = element_blank(),
         axis.text.y.right = element_blank(),
         axis.ticks.y.right = element_blank(),
         axis.line.y.right = element_blank()
         )
```

### 3. Plots for Relation between Sexual Identity and Demographic Factors
#### 3.1. Prepare dataset for plotting
```{r}
results_imp_pr_poisson_2010 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/results_imp_pr_poisson_2010.xlsx")

results_imp_pr_poisson_2014 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/results_imp_pr_poisson_2014.xlsx")

results_imp_pr_poisson_2021 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/results_imp_pr_poisson_2021.xlsx")

# to make it easier to combine across datasets
# a note on these changes will be added on the graph later
results_imp_pr_poisson_2010$subgroup[ results_imp_pr_poisson_2010$subgroup == "age_exp18-29" ] <- "age_exp16-29"
results_imp_pr_poisson_2010$subgroup[ results_imp_pr_poisson_2010$subgroup == "male_ age_exp18-29" ] <- "male_ age_exp16-29"
results_imp_pr_poisson_2010$subgroup[ results_imp_pr_poisson_2010$subgroup == "female_ age_exp18-29" ] <- "female_ age_exp16-29"

# merge datasets
results_imp_pr_poisson <- results_imp_pr_poisson_2010 %>%
  full_join( results_imp_pr_poisson_2014, by = "subgroup" ) %>%
  full_join( results_imp_pr_poisson_2021, by = "subgroup" )

# modify table format
desired_order <- c( "sex_expFemale", "age_exp16-29", "age_exp30-44", "age_exp>=60", "male_ age_exp16-29", "male_ age_exp30-44", "male_ age_exp>=60", "female_ age_exp16-29", "female_ age_exp30-44", "female_ age_exp>=60", "country_of_birth_expEurope", "country_of_birth_expOutside Europe", "education_exp<=9 years", "education_exp10-12 years", "income_exp<=2,500", "income_exp(2,500, 3,500]", "income_exp(3,500, 4,500]", "marital_status_expNever married", "marital_status_expOther", "living_status_expliving_alone_yes", "personal_support_exppersonal_support_no" )
                    
results_imp_pr_poisson <- results_imp_pr_poisson %>%
  mutate( subgroup = factor( subgroup, levels = desired_order ) ) %>%
  arrange( subgroup )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = "Sex", .before = 1 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = "Age group", .before = 3 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = "Country of birth", .before = 13 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = "Education years", .before = 16 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = "Income (100 kr/yr)ᶠ", .before = 19 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = "Marital statusᵍ", .before = 23 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = "Living alone", .before = 26 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = "Personal support", .before = 28 )

results_imp_pr_poisson$subgroup[ results_imp_pr_poisson$subgroup == "sex_expFemale" ] <- paste0( "   ", "Female\n\n" )
results_imp_pr_poisson$subgroup[ results_imp_pr_poisson$subgroup == "age_exp16-29" ] <- paste0( "   ", "16–29 yrsᵈ\n\n" )
results_imp_pr_poisson$subgroup[ results_imp_pr_poisson$subgroup == "age_exp30-44" ] <- paste0( "   ", "30–44 yrs\n\n" )
results_imp_pr_poisson$subgroup[ results_imp_pr_poisson$subgroup == "age_exp>=60" ] <- paste0( "   ", "\u2265 60 yrs\n\n" )
results_imp_pr_poisson$subgroup[ results_imp_pr_poisson$subgroup == "country_of_birth_expEurope" ] <- paste0( "   ", "Europeᵉ\n\n" )
results_imp_pr_poisson$subgroup[ results_imp_pr_poisson$subgroup == "country_of_birth_expOutside Europe" ] <- paste0( "   ", "Outside Europe\n\n" )
results_imp_pr_poisson$subgroup[ results_imp_pr_poisson$subgroup == "education_exp<=9 years" ] <- paste0( "   ", "\u2264 9 yrs\n\n" )
results_imp_pr_poisson$subgroup[ results_imp_pr_poisson$subgroup == "education_exp10-12 years" ] <- paste0( "   ", "10–12 yrs\n\n" )
results_imp_pr_poisson$subgroup[ results_imp_pr_poisson$subgroup == "income_exp<=2,500" ] <- paste0( "   ", "\u2264 2,500\n\n" )
results_imp_pr_poisson$subgroup[ results_imp_pr_poisson$subgroup == "income_exp(2,500, 3,500]" ] <- paste0( "   ", "(2,500, 3,500]\n\n" )
results_imp_pr_poisson$subgroup[ results_imp_pr_poisson$subgroup == "income_exp(3,500, 4,500]" ] <- paste0( "   ", "(3,500, 4,500]\n\n" )
results_imp_pr_poisson$subgroup[ results_imp_pr_poisson$subgroup == "marital_status_expNever married" ] <- paste0( "   ", "Never married\n\n" )
results_imp_pr_poisson$subgroup[ results_imp_pr_poisson$subgroup == "marital_status_expOther" ] <- paste0( "   ", "Other\n\n" )
results_imp_pr_poisson$subgroup[ results_imp_pr_poisson$subgroup == "living_status_expliving_alone_yes" ] <- paste0( "   ", "Yes\n\n" )
results_imp_pr_poisson$subgroup[ results_imp_pr_poisson$subgroup == "personal_support_exppersonal_support_no" ] <- paste0( "   ", "No\n\n" )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Sexual_minority_2010_crude" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_point_estimate_2010_crude ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_lower_ci_2010_crude ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_upper_ci_2010_crude ), ")" ),
    .before = 2 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Sexual_minority_2010_model_1" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_point_estimate_2010_model_1 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_lower_ci_2010_model_1 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_upper_ci_2010_model_1 ), ")" ),
    .before = 3 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Sexual_minority_2010_model_2" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_point_estimate_2010_model_2 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_lower_ci_2010_model_2 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_upper_ci_2010_model_2 ), ")" ),
    .before = 4 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Homosexual_2010_crude" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_point_estimate_2010_crude ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_lower_ci_2010_crude ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_upper_ci_2010_crude ), ")" ),
    .before = 5 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Homosexual_2010_model_1" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_point_estimate_2010_model_1 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_lower_ci_2010_model_1 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_upper_ci_2010_model_1 ), ")" ),
    .before = 6 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Homosexual_2010_model_2" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_point_estimate_2010_model_2 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_lower_ci_2010_model_2 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_upper_ci_2010_model_2 ), ")" ),
    .before = 7 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Bisexual_2010_crude" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_point_estimate_2010_crude ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_lower_ci_2010_crude ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_upper_ci_2010_crude ), ")" ),
    .before = 8 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Bisexual_2010_model_1" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_point_estimate_2010_model_1 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_lower_ci_2010_model_1 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_upper_ci_2010_model_1 ), ")" ),
    .before = 9 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Bisexual_2010_model_2" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_point_estimate_2010_model_2 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_lower_ci_2010_model_2 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_upper_ci_2010_model_2 ), ")" ),
    .before = 10 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Other_2010_crude" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$other_point_estimate_2010_crude ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$other_lower_ci_2010_crude ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$other_upper_ci_2010_crude ), ")" ),
    .before = 11 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Other_2010_model_1" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$other_point_estimate_2010_model_1 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$other_lower_ci_2010_model_1 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$other_upper_ci_2010_model_1 ), ")" ),
    .before = 12 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Other_2010_model_2" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$other_point_estimate_2010_model_2 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$other_lower_ci_2010_model_2 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$other_upper_ci_2010_model_2 ), ")" ),
    .before = 13 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Sexual_minority_2014_crude" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_point_estimate_2014_crude ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_lower_ci_2014_crude ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_upper_ci_2014_crude ), ")" ),
    .before = 14 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Sexual_minority_2014_model_1" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_point_estimate_2014_model_1 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_lower_ci_2014_model_1 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_upper_ci_2014_model_1 ), ")" ),
    .before = 15 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Sexual_minority_2014_model_2" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_point_estimate_2014_model_2 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_lower_ci_2014_model_2 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_upper_ci_2014_model_2 ), ")" ),
    .before = 16 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Homosexual_2014_crude" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_point_estimate_2014_crude ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_lower_ci_2014_crude ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_upper_ci_2014_crude ), ")" ),
    .before = 17 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Homosexual_2014_model_1" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_point_estimate_2014_model_1 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_lower_ci_2014_model_1 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_upper_ci_2014_model_1 ), ")" ),
    .before = 18 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Homosexual_2014_model_2" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_point_estimate_2014_model_2 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_lower_ci_2014_model_2 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_upper_ci_2014_model_2 ), ")" ),
    .before = 19 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Bisexual_2014_crude" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_point_estimate_2014_crude ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_lower_ci_2014_crude ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_upper_ci_2014_crude ), ")" ),
    .before = 20 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Bisexual_2014_model_1" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_point_estimate_2014_model_1 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_lower_ci_2014_model_1 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_upper_ci_2014_model_1 ), ")" ),
    .before = 21 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Bisexual_2014_model_2" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_point_estimate_2014_model_2 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_lower_ci_2014_model_2 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_upper_ci_2014_model_2 ), ")" ),
    .before = 22 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Other_2014_crude" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$other_point_estimate_2014_crude ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$other_lower_ci_2014_crude ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$other_upper_ci_2014_crude ), ")" ),
    .before = 23 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Other_2014_model_1" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$other_point_estimate_2014_model_1 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$other_lower_ci_2014_model_1 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$other_upper_ci_2014_model_1 ), ")" ),
    .before = 24 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Other_2014_model_2" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$other_point_estimate_2014_model_2 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$other_lower_ci_2014_model_2 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$other_upper_ci_2014_model_2 ), ")" ),
    .before = 25 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Sexual_minority_2021_crude" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_point_estimate_2021_crude ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_lower_ci_2021_crude ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_upper_ci_2021_crude ), ")" ),
    .before = 26 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Sexual_minority_2021_model_1" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_point_estimate_2021_model_1 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_lower_ci_2021_model_1 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_upper_ci_2021_model_1 ), ")" ),
    .before = 27 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Sexual_minority_2021_model_2" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_point_estimate_2021_model_2 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_lower_ci_2021_model_2 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$sexual_minority_upper_ci_2021_model_2 ), ")" ),
    .before = 28 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Homosexual_2021_crude" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_point_estimate_2021_crude ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_lower_ci_2021_crude ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_upper_ci_2021_crude ), ")" ),
    .before = 29 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Homosexual_2021_model_1" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_point_estimate_2021_model_1 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_lower_ci_2021_model_1 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_upper_ci_2021_model_1 ), ")" ),
    .before = 30 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Homosexual_2021_model_2" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_point_estimate_2021_model_2 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_lower_ci_2021_model_2 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$homosexual_upper_ci_2021_model_2 ), ")" ),
    .before = 31 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Bisexual_2021_crude" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_point_estimate_2021_crude ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_lower_ci_2021_crude ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_upper_ci_2021_crude ), ")" ),
    .before = 32 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Bisexual_2021_model_1" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_point_estimate_2021_model_1 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_lower_ci_2021_model_1 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_upper_ci_2021_model_1 ), ")" ),
    .before = 33 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Bisexual_2021_model_2" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_point_estimate_2021_model_2 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_lower_ci_2021_model_2 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$bisexual_upper_ci_2021_model_2 ), ")" ),
    .before = 34 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Other_2021_crude" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$other_point_estimate_2021_crude ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$other_lower_ci_2021_crude ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$other_upper_ci_2021_crude ), ")" ),
    .before = 35 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Other_2021_model_1" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$other_point_estimate_2021_model_1 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$other_lower_ci_2021_model_1 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$other_upper_ci_2021_model_1 ), ")" ),
    .before = 36 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Other_2021_model_2" = paste0(
    sprintf( "%.2f", results_imp_pr_poisson$other_point_estimate_2021_model_2 ), " (", 
    sprintf( "%.2f", results_imp_pr_poisson$other_lower_ci_2021_model_2 ), ", ", 
    sprintf( "%.2f", results_imp_pr_poisson$other_upper_ci_2021_model_2 ), ")" ),
    .before = 37 )


results_imp_pr_poisson$Sexual_minority_2021_crude <- ifelse( !is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_model_1 ) & is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2021_model_1 ), "\u2013",
                                                      results_imp_pr_poisson$Sexual_minority_2021_crude )

results_imp_pr_poisson$Sexual_minority_2021_model_1 <- ifelse( !is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_model_1 ) & is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2021_model_1 ), "\u2013",
                                                      results_imp_pr_poisson$Sexual_minority_2021_model_1 )

results_imp_pr_poisson$Sexual_minority_2021_model_2 <- ifelse( !is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_model_1 ) & is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2021_model_1 ), "\u2013",
                                                      results_imp_pr_poisson$Sexual_minority_2021_model_2 )

results_imp_pr_poisson$Homosexual_2021_crude <- ifelse( !is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_model_1 ) & is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2021_model_1 ), "\u2013",
                                                      results_imp_pr_poisson$Homosexual_2021_crude )

results_imp_pr_poisson$Homosexual_2021_model_1 <- ifelse( !is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_model_1 ) & is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2021_model_1 ), "\u2013",
                                                      results_imp_pr_poisson$Homosexual_2021_model_1 )

results_imp_pr_poisson$Homosexual_2021_model_2 <- ifelse( !is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_model_1 ) & is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2021_model_1 ), "\u2013",
                                                      results_imp_pr_poisson$Homosexual_2021_model_2 )

results_imp_pr_poisson$Bisexual_2021_crude <- ifelse( !is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_model_1 ) & is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2021_model_1 ), "\u2013",
                                                      results_imp_pr_poisson$Bisexual_2021_crude )

results_imp_pr_poisson$Bisexual_2021_model_1 <- ifelse( !is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_model_1 ) & is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2021_model_1 ), "\u2013",
                                                      results_imp_pr_poisson$Bisexual_2021_model_1 )

results_imp_pr_poisson$Bisexual_2021_model_2 <- ifelse( !is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_model_1 ) & is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2021_model_1 ), "\u2013",
                                                      results_imp_pr_poisson$Bisexual_2021_model_2 )

results_imp_pr_poisson$Other_2021_crude <- ifelse( !is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_model_1 ) & is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2021_model_1 ), "\u2013",
                                                      results_imp_pr_poisson$Other_2021_crude )

results_imp_pr_poisson$Other_2021_model_1 <- ifelse( !is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_model_1 ) & is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2021_model_1 ), "\u2013",
                                                      results_imp_pr_poisson$Other_2021_model_1 )

results_imp_pr_poisson$Other_2021_model_2 <- ifelse( !is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_model_1 ) & is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2021_model_1 ), "\u2013",
                                                      results_imp_pr_poisson$Other_2021_model_2 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Sexual_minority_crude" = paste( results_imp_pr_poisson$Sexual_minority_2010_crude,
                                               results_imp_pr_poisson$Sexual_minority_2014_crude,
                                               results_imp_pr_poisson$Sexual_minority_2021_crude,
                                               sep = "\n" ),
              .before = 2 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Sexual_minority_model_1" = paste( results_imp_pr_poisson$Sexual_minority_2010_model_1,
                                                 results_imp_pr_poisson$Sexual_minority_2014_model_1,
                                                 results_imp_pr_poisson$Sexual_minority_2021_model_1,
                                                 sep = "\n" ),
              .before = 3 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Sexual_minority_model_2" = paste( results_imp_pr_poisson$Sexual_minority_2010_model_2,
                                                 results_imp_pr_poisson$Sexual_minority_2014_model_2,
                                                 results_imp_pr_poisson$Sexual_minority_2021_model_2,
                                                 sep = "\n" ),
              .before = 4 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Homosexual_crude" = paste( results_imp_pr_poisson$Homosexual_2010_crude,
                                          results_imp_pr_poisson$Homosexual_2014_crude,
                                          results_imp_pr_poisson$Homosexual_2021_crude,
                                          sep = "\n" ),
              .before = 5 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Homosexual_model_1" = paste( results_imp_pr_poisson$Homosexual_2010_model_1,
                                            results_imp_pr_poisson$Homosexual_2014_model_1,
                                            results_imp_pr_poisson$Homosexual_2021_model_1,
                                            sep = "\n" ),
              .before = 6 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Homosexual_model_2" = paste( results_imp_pr_poisson$Homosexual_2010_model_2,
                                            results_imp_pr_poisson$Homosexual_2014_model_2,
                                            results_imp_pr_poisson$Homosexual_2021_model_2,
                                            sep = "\n" ),
              .before = 7 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Bisexual_crude" = paste( results_imp_pr_poisson$Bisexual_2010_crude,
                                        results_imp_pr_poisson$Bisexual_2014_crude,
                                        results_imp_pr_poisson$Bisexual_2021_crude,
                                        sep = "\n" ),
              .before = 8 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Bisexual_model_1" = paste( results_imp_pr_poisson$Bisexual_2010_model_1,
                                          results_imp_pr_poisson$Bisexual_2014_model_1,
                                          results_imp_pr_poisson$Bisexual_2021_model_1,
                                          sep = "\n" ),
              .before = 9 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Bisexual_model_2" = paste( results_imp_pr_poisson$Bisexual_2010_model_2,
                                          results_imp_pr_poisson$Bisexual_2014_model_2,
                                          results_imp_pr_poisson$Bisexual_2021_model_2,
                                          sep = "\n" ),
              .before = 10 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Other_crude" = paste( results_imp_pr_poisson$Other_2010_crude,
                                     results_imp_pr_poisson$Other_2014_crude,
                                     results_imp_pr_poisson$Other_2021_crude,
                                     sep = "\n" ),
              .before = 11 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Other_model_1" = paste( results_imp_pr_poisson$Other_2010_model_1,
                                       results_imp_pr_poisson$Other_2014_model_1,
                                       results_imp_pr_poisson$Other_2021_model_1,
                                       sep = "\n" ),
              .before = 12 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_column( "Other_model_2" = paste( results_imp_pr_poisson$Other_2010_model_2,
                                       results_imp_pr_poisson$Other_2014_model_2,
                                       results_imp_pr_poisson$Other_2021_model_2,
                                       sep = "\n" ),
              .before = 13 )


results_imp_pr_poisson$Sexual_minority_crude <- ifelse( is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_crude ), "",
                                                      results_imp_pr_poisson$Sexual_minority_crude )

results_imp_pr_poisson$Sexual_minority_model_1 <- ifelse( is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_crude ), "",
                                                      results_imp_pr_poisson$Sexual_minority_model_1 )

results_imp_pr_poisson$Sexual_minority_model_2 <- ifelse( is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_crude ), "",
                                                      results_imp_pr_poisson$Sexual_minority_model_2 )

results_imp_pr_poisson$Homosexual_crude <- ifelse( is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_crude ), "",
                                                      results_imp_pr_poisson$Homosexual_crude )

results_imp_pr_poisson$Homosexual_model_1 <- ifelse( is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_crude ), "",
                                                      results_imp_pr_poisson$Homosexual_model_1 )

results_imp_pr_poisson$Homosexual_model_2 <- ifelse( is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_crude ), "",
                                                      results_imp_pr_poisson$Homosexual_model_2 )

results_imp_pr_poisson$Bisexual_crude <- ifelse( is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_crude ), "",
                                                      results_imp_pr_poisson$Bisexual_crude )

results_imp_pr_poisson$Bisexual_model_1 <- ifelse( is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_crude ), "",
                                                      results_imp_pr_poisson$Bisexual_model_1 )

results_imp_pr_poisson$Bisexual_model_2 <- ifelse( is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_crude ), "",
                                                      results_imp_pr_poisson$Bisexual_model_2 )

results_imp_pr_poisson$Other_crude <- ifelse( is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_crude ), "",
                                                      results_imp_pr_poisson$Other_crude )

results_imp_pr_poisson$Other_model_1 <- ifelse( is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_crude ), "",
                                                      results_imp_pr_poisson$Other_model_1 )

results_imp_pr_poisson$Other_model_2 <- ifelse( is.na( results_imp_pr_poisson$sexual_minority_point_estimate_2010_crude ), "",
                                                      results_imp_pr_poisson$Other_model_2 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = paste0( "   ", "Male" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 2 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = paste0( "   ", "45–59 yrs" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 7 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = paste0( "   ", "Sweden" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 16 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = paste0( "   ", "\u2265 13 yrs" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 22 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = paste0( "   ", "> 4,500" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 27 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = paste0( "   ", "Currently married" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 29 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = paste0( "   ", "No" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 34 )

results_imp_pr_poisson <- results_imp_pr_poisson %>% 
  add_row( subgroup = paste0( "   ", "Yes" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 36 )
```

#### 3.2. Sexual minority group
##### 3.2.1. Part 1
```{r}
selected_cols <- grep( "subgroup|sexual_minority", colnames( results_imp_pr_poisson ), ignore.case = TRUE )

results_imp_pr_poisson_sexual_minority <- results_imp_pr_poisson[ -c( 9:14, 23:37 ), selected_cols ]

results_imp_pr_poisson_sexual_minority <- results_imp_pr_poisson_sexual_minority %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_imp_pr_poisson_sexual_minority <- results_imp_pr_poisson_sexual_minority %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_imp_pr_poisson_sexual_minority <- results_imp_pr_poisson_sexual_minority %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_imp_pr_poisson_sexual_minority <- results_imp_pr_poisson_sexual_minority %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_imp_pr_poisson_sexual_minority )[1] <- "Demographic Factor"

names( results_imp_pr_poisson_sexual_minority )[ names( results_imp_pr_poisson_sexual_minority ) %in% c( "temp1", "temp2", "temp3", "Sexual_minority_crude", "Sexual_minority_model_1", "Sexual_minority_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
  )

p_imp_pr_poisson_sexual_minority <- forest(
  results_imp_pr_poisson_sexual_minority[ , c( 1:10 ) ],
  
  est = list( results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2010_crude,
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2010_model_1,
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2010_model_2,
              
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2014_crude,
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2014_model_1,
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2014_model_2,
              
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2021_crude,
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2021_model_1,
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2021_model_2
              ),
  
  lower = list( results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2010_crude,
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2010_model_1,
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2010_model_2,
                
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2014_crude,
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2014_model_1,
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2014_model_2,
                
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2021_crude,
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2021_model_1,
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2021_model_2
                ),
  
  upper = list( results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2010_crude,
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2010_model_1,
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2010_model_2,
                
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2014_crude,
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2014_model_1,
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2014_model_2,
                
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2021_crude,
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2021_model_1,
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2021_model_2
                ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_imp_pr_poisson_sexual_minority <- edit_plot( p_imp_pr_poisson_sexual_minority,
                                              row = c( 1, 4, 9, 13 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
                                              )

p_imp_pr_poisson_sexual_minority <- add_text(
  p_imp_pr_poisson_sexual_minority,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_minority <- add_text(
  p_imp_pr_poisson_sexual_minority,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_minority <- add_text(
  p_imp_pr_poisson_sexual_minority,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_minority <- insert_text(
  p_imp_pr_poisson_sexual_minority,
  text = "Sexual Minoritiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_minority <- edit_plot( p_imp_pr_poisson_sexual_minority,
                                              row = c( 1, 4, 9, 13 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
                                              )

p_imp_pr_poisson_sexual_minority <- edit_plot( p_imp_pr_poisson_sexual_minority,
                                              row = c( 2, 3, 5:8, 10:12, 14:16 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
                                              )

p_imp_pr_poisson_sexual_minority <- add_border(
  p_imp_pr_poisson_sexual_minority,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_imp_pr_poisson_sexual_minority )
```

##### 3.2.2. Part 2
```{r}
results_imp_pr_poisson_sexual_minority <- results_imp_pr_poisson[ -c( 1:22 ), selected_cols ]

results_imp_pr_poisson_sexual_minority <- results_imp_pr_poisson_sexual_minority %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_imp_pr_poisson_sexual_minority <- results_imp_pr_poisson_sexual_minority %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_imp_pr_poisson_sexual_minority <- results_imp_pr_poisson_sexual_minority %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_imp_pr_poisson_sexual_minority <- results_imp_pr_poisson_sexual_minority %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_imp_pr_poisson_sexual_minority )[1] <- "Demographic Factor"

names( results_imp_pr_poisson_sexual_minority )[ names( results_imp_pr_poisson_sexual_minority ) %in% c( "temp1", "temp2", "temp3", "Sexual_minority_crude", "Sexual_minority_model_1", "Sexual_minority_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
  )

p_imp_pr_poisson_sexual_minority <- forest(
  results_imp_pr_poisson_sexual_minority[ , c( 1:10 ) ],
  
  est = list( results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2010_crude,
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2010_model_1,
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2010_model_2,
              
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2014_crude,
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2014_model_1,
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2014_model_2,
              
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2021_crude,
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2021_model_1,
              results_imp_pr_poisson_sexual_minority$sexual_minority_point_estimate_2021_model_2
              ),
  
  lower = list( results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2010_crude,
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2010_model_1,
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2010_model_2,
                
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2014_crude,
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2014_model_1,
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2014_model_2,
                
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2021_crude,
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2021_model_1,
                results_imp_pr_poisson_sexual_minority$sexual_minority_lower_ci_2021_model_2
                ),
  
  upper = list( results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2010_crude,
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2010_model_1,
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2010_model_2,
                
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2014_crude,
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2014_model_1,
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2014_model_2,
                
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2021_crude,
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2021_model_1,
                results_imp_pr_poisson_sexual_minority$sexual_minority_upper_ci_2021_model_2
                ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_imp_pr_poisson_sexual_minority <- edit_plot( p_imp_pr_poisson_sexual_minority,
                                              row = c( 1, 6, 10, 13 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_imp_pr_poisson_sexual_minority <- add_text(
  p_imp_pr_poisson_sexual_minority,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_minority <- add_text(
  p_imp_pr_poisson_sexual_minority,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_minority <- add_text(
  p_imp_pr_poisson_sexual_minority,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_minority <- insert_text(
  p_imp_pr_poisson_sexual_minority,
  text = "Sexual Minoritiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_minority <- edit_plot( p_imp_pr_poisson_sexual_minority,
                                              row = c( 1, 6, 10, 13 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
                                              )

p_imp_pr_poisson_sexual_minority <- edit_plot( p_imp_pr_poisson_sexual_minority,
                                              row = c( 2:5, 7:9, 11, 12, 14, 15 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
                                              )

p_imp_pr_poisson_sexual_minority <- add_border(
  p_imp_pr_poisson_sexual_minority,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_imp_pr_poisson_sexual_minority )
```

#### 3.3. Homosexual group
##### 3.3.1. Part 1
```{r}
selected_cols <- grep( "subgroup|homosexual", colnames( results_imp_pr_poisson ), ignore.case = TRUE )

results_imp_pr_poisson_homosexual <- results_imp_pr_poisson[ c( 1:3, 19:34 ), selected_cols ]

results_imp_pr_poisson_homosexual <- results_imp_pr_poisson_homosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_imp_pr_poisson_homosexual <- results_imp_pr_poisson_homosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_imp_pr_poisson_homosexual <- results_imp_pr_poisson_homosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_imp_pr_poisson_homosexual <- results_imp_pr_poisson_homosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

results_imp_pr_poisson_homosexual$subgroup[ results_imp_pr_poisson_homosexual$subgroup == "Income (100 kr/yr)ᶠ" ] <- "Income (100 kr/yr)ᵈ"
results_imp_pr_poisson_homosexual$subgroup[ results_imp_pr_poisson_homosexual$subgroup == "Marital statusᵍ" ] <- "Marital statusᵉ"
colnames( results_imp_pr_poisson_homosexual )[1] <- "Demographic Factor"

names( results_imp_pr_poisson_homosexual )[ names( results_imp_pr_poisson_homosexual ) %in% c( "temp1", "temp2", "temp3", "Homosexual_crude", "Homosexual_model_1", "Homosexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_imp_pr_poisson_homosexual <- forest(
  results_imp_pr_poisson_homosexual[ , c( 1:10 ) ],
  
  est = list( results_imp_pr_poisson_homosexual$homosexual_point_estimate_2010_crude,
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2010_model_1,
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2010_model_2,
              
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2014_crude,
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2014_model_1,
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2014_model_2,
              
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2021_crude,
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2021_model_1,
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2021_model_2
  ),
  
  lower = list( results_imp_pr_poisson_homosexual$homosexual_lower_ci_2010_crude,
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2010_model_1,
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2010_model_2,
                
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2014_crude,
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2014_model_1,
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2014_model_2,
                
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2021_crude,
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2021_model_1,
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2021_model_2
  ),
  
  upper = list( results_imp_pr_poisson_homosexual$homosexual_upper_ci_2010_crude,
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2010_model_1,
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2010_model_2,
                
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2014_crude,
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2014_model_1,
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2014_model_2,
                
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2021_crude,
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2021_model_1,
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2021_model_2
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_imp_pr_poisson_homosexual <- edit_plot( p_imp_pr_poisson_homosexual,
                                          row = c( 1, 4, 8, 13, 17 ),
                                          col = 1,
                                          gp = gpar( fontface = "bold" ) 
)

p_imp_pr_poisson_homosexual <- add_text(
  p_imp_pr_poisson_homosexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_homosexual <- add_text(
  p_imp_pr_poisson_homosexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_homosexual <- add_text(
  p_imp_pr_poisson_homosexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_homosexual <- insert_text(
  p_imp_pr_poisson_homosexual,
  text = "Homosexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_homosexual <- edit_plot( p_imp_pr_poisson_homosexual,
                                          row = c( 1, 4, 8, 13, 17 ), 
                                          which = "background",
                                          gp = gpar( fill = "white" )
)

p_imp_pr_poisson_homosexual <- edit_plot( p_imp_pr_poisson_homosexual,
                                          row = c( 2, 3, 5:7, 9:12, 14:16, 18, 19 ), 
                                          which = "background",
                                          gp = gpar( fill = "#eff3f2" )
)

p_imp_pr_poisson_homosexual <- add_border(
  p_imp_pr_poisson_homosexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_imp_pr_poisson_homosexual )
```

##### 3.3.2. Part 2
```{r}
results_imp_pr_poisson_homosexual <- results_imp_pr_poisson[ c( 4:8, 15:18, 35:37 ), selected_cols ]

results_imp_pr_poisson_homosexual <- results_imp_pr_poisson_homosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_imp_pr_poisson_homosexual <- results_imp_pr_poisson_homosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_imp_pr_poisson_homosexual <- results_imp_pr_poisson_homosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_imp_pr_poisson_homosexual <- results_imp_pr_poisson_homosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_imp_pr_poisson_homosexual )[1] <- "Demographic Factor"

names( results_imp_pr_poisson_homosexual )[ names( results_imp_pr_poisson_homosexual ) %in% c( "temp1", "temp2", "temp3", "Homosexual_crude", "Homosexual_model_1", "Homosexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_imp_pr_poisson_homosexual <- forest(
  results_imp_pr_poisson_homosexual[ , c( 1:10 ) ],
  
  est = list( results_imp_pr_poisson_homosexual$homosexual_point_estimate_2010_crude,
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2010_model_1,
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2010_model_2,
              
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2014_crude,
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2014_model_1,
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2014_model_2,
              
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2021_crude,
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2021_model_1,
              results_imp_pr_poisson_homosexual$homosexual_point_estimate_2021_model_2
  ),
  
  lower = list( results_imp_pr_poisson_homosexual$homosexual_lower_ci_2010_crude,
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2010_model_1,
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2010_model_2,
                
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2014_crude,
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2014_model_1,
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2014_model_2,
                
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2021_crude,
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2021_model_1,
                results_imp_pr_poisson_homosexual$homosexual_lower_ci_2021_model_2
  ),
  
  upper = list( results_imp_pr_poisson_homosexual$homosexual_upper_ci_2010_crude,
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2010_model_1,
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2010_model_2,
                
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2014_crude,
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2014_model_1,
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2014_model_2,
                
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2021_crude,
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2021_model_1,
                results_imp_pr_poisson_homosexual$homosexual_upper_ci_2021_model_2
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 3 ),
  ticks_at = c( 0, 1, 2, 3 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_imp_pr_poisson_homosexual <- edit_plot( p_imp_pr_poisson_homosexual,
                                         row = c( 1, 6, 10 ),
                                         col = 1,
                                         gp = gpar( fontface = "bold" ) 
)

p_imp_pr_poisson_homosexual <- add_text(
  p_imp_pr_poisson_homosexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_homosexual <- add_text(
  p_imp_pr_poisson_homosexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_homosexual <- add_text(
  p_imp_pr_poisson_homosexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_homosexual <- insert_text(
  p_imp_pr_poisson_homosexual,
  text = "Homosexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_homosexual <- edit_plot( p_imp_pr_poisson_homosexual,
                                         row = c( 1, 6, 10 ), 
                                         which = "background",
                                         gp = gpar( fill = "white" )
)

p_imp_pr_poisson_homosexual <- edit_plot( p_imp_pr_poisson_homosexual,
                                         row = c( 2:5, 7:9, 11, 12 ), 
                                         which = "background",
                                         gp = gpar( fill = "#eff3f2" )
)

p_imp_pr_poisson_homosexual <- add_border(
  p_imp_pr_poisson_homosexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_imp_pr_poisson_homosexual )
```

#### 3.4. Bisexual group
##### 3.4.1. Part 1
```{r}
selected_cols <- grep( "subgroup|bisexual", colnames( results_imp_pr_poisson ), ignore.case = TRUE )

results_imp_pr_poisson_bisexual <- results_imp_pr_poisson[ c( 1:8, 23:31 ), selected_cols ]

results_imp_pr_poisson_bisexual <- results_imp_pr_poisson_bisexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_imp_pr_poisson_bisexual <- results_imp_pr_poisson_bisexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_imp_pr_poisson_bisexual <- results_imp_pr_poisson_bisexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_imp_pr_poisson_bisexual <- results_imp_pr_poisson_bisexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

results_imp_pr_poisson_bisexual$subgroup[ results_imp_pr_poisson_bisexual$subgroup == "Income (100 kr/yr)ᶠ" ] <- "Income (100 kr/yr)ᵉ"
results_imp_pr_poisson_bisexual$subgroup[ results_imp_pr_poisson_bisexual$subgroup == "Marital statusᵍ" ] <- "Marital statusᶠ"
colnames( results_imp_pr_poisson_bisexual )[1] <- "Demographic Factor"

names( results_imp_pr_poisson_bisexual )[ names( results_imp_pr_poisson_bisexual ) %in% c( "temp1", "temp2", "temp3", "Bisexual_crude", "Bisexual_model_1", "Bisexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_imp_pr_poisson_bisexual <- forest(
  results_imp_pr_poisson_bisexual[ , c( 1:10 ) ],
  
  est = list( results_imp_pr_poisson_bisexual$bisexual_point_estimate_2010_crude,
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2010_model_1,
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2010_model_2,
              
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2014_crude,
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2014_model_1,
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2014_model_2,
              
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2021_crude,
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2021_model_1,
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2021_model_2
  ),
  
  lower = list( results_imp_pr_poisson_bisexual$bisexual_lower_ci_2010_crude,
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2010_model_1,
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2010_model_2,
                
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2014_crude,
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2014_model_1,
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2014_model_2,
                
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2021_crude,
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2021_model_1,
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2021_model_2
  ),
  
  upper = list( results_imp_pr_poisson_bisexual$bisexual_upper_ci_2010_crude,
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2010_model_1,
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2010_model_2,
                
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2014_crude,
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2014_model_1,
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2014_model_2,
                
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2021_crude,
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2021_model_1,
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2021_model_2
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 8 ),
  ticks_at = c( 0, 1, 2, 4, 6, 8 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_imp_pr_poisson_bisexual <- edit_plot( p_imp_pr_poisson_bisexual,
                                         row = c( 1, 4, 9, 14 ),
                                         col = 1,
                                         gp = gpar( fontface = "bold" ) 
)

p_imp_pr_poisson_bisexual <- add_text(
  p_imp_pr_poisson_bisexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_bisexual <- add_text(
  p_imp_pr_poisson_bisexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_bisexual <- add_text(
  p_imp_pr_poisson_bisexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_bisexual <- insert_text(
  p_imp_pr_poisson_bisexual,
  text = "Bisexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_bisexual <- edit_plot( p_imp_pr_poisson_bisexual,
                                         row = c( 1, 4, 9, 14 ), 
                                         which = "background",
                                         gp = gpar( fill = "white" )
)

p_imp_pr_poisson_bisexual <- edit_plot( p_imp_pr_poisson_bisexual,
                                         row = c( 2, 3, 5:8, 10:13, 15:17 ), 
                                         which = "background",
                                         gp = gpar( fill = "#eff3f2" )
)

p_imp_pr_poisson_bisexual <- add_border(
  p_imp_pr_poisson_bisexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_imp_pr_poisson_bisexual )
```

##### 3.4.2. Part 2
```{r}
results_imp_pr_poisson_bisexual <- results_imp_pr_poisson[ c( 15:22, 32:37  ), selected_cols ]

results_imp_pr_poisson_bisexual <- results_imp_pr_poisson_bisexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_imp_pr_poisson_bisexual <- results_imp_pr_poisson_bisexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_imp_pr_poisson_bisexual <- results_imp_pr_poisson_bisexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_imp_pr_poisson_bisexual <- results_imp_pr_poisson_bisexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

results_imp_pr_poisson_bisexual$subgroup[ results_imp_pr_poisson_bisexual$subgroup == "   Europeᵉ\n\n" ] <- "   Europeᵈ\n\n"
colnames( results_imp_pr_poisson_bisexual )[1] <- "Demographic Factor"

names( results_imp_pr_poisson_bisexual )[ names( results_imp_pr_poisson_bisexual ) %in% c( "temp1", "temp2", "temp3", "Bisexual_crude", "Bisexual_model_1", "Bisexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_imp_pr_poisson_bisexual <- forest(
  results_imp_pr_poisson_bisexual[ , c( 1:10 ) ],
  
  est = list( results_imp_pr_poisson_bisexual$bisexual_point_estimate_2010_crude,
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2010_model_1,
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2010_model_2,
              
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2014_crude,
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2014_model_1,
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2014_model_2,
              
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2021_crude,
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2021_model_1,
              results_imp_pr_poisson_bisexual$bisexual_point_estimate_2021_model_2
  ),
  
  lower = list( results_imp_pr_poisson_bisexual$bisexual_lower_ci_2010_crude,
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2010_model_1,
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2010_model_2,
                
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2014_crude,
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2014_model_1,
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2014_model_2,
                
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2021_crude,
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2021_model_1,
                results_imp_pr_poisson_bisexual$bisexual_lower_ci_2021_model_2
  ),
  
  upper = list( results_imp_pr_poisson_bisexual$bisexual_upper_ci_2010_crude,
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2010_model_1,
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2010_model_2,
                
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2014_crude,
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2014_model_1,
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2014_model_2,
                
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2021_crude,
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2021_model_1,
                results_imp_pr_poisson_bisexual$bisexual_upper_ci_2021_model_2
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 3 ),
  ticks_at = c( 0, 1, 2, 3 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_imp_pr_poisson_bisexual <- edit_plot( p_imp_pr_poisson_bisexual,
                                       row = c( 1, 5, 9, 12 ),
                                       col = 1,
                                       gp = gpar( fontface = "bold" ) 
)

p_imp_pr_poisson_bisexual <- add_text(
  p_imp_pr_poisson_bisexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_bisexual <- add_text(
  p_imp_pr_poisson_bisexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_bisexual <- add_text(
  p_imp_pr_poisson_bisexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_bisexual <- insert_text(
  p_imp_pr_poisson_bisexual,
  text = "Bisexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_bisexual <- edit_plot( p_imp_pr_poisson_bisexual,
                                       row = c( 1, 5, 9, 12 ), 
                                       which = "background",
                                       gp = gpar( fill = "white" )
)

p_imp_pr_poisson_bisexual <- edit_plot( p_imp_pr_poisson_bisexual,
                                       row = c( 2:4, 6:8, 10, 11, 13, 14 ), 
                                       which = "background",
                                       gp = gpar( fill = "#eff3f2" )
)

p_imp_pr_poisson_bisexual <- add_border(
  p_imp_pr_poisson_bisexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_imp_pr_poisson_bisexual )
```

#### 3.5. Other group
##### 3.5.1. Part 1
```{r}
selected_cols <- grep( "subgroup|other", colnames( results_imp_pr_poisson ), ignore.case = TRUE )

results_imp_pr_poisson_other <- results_imp_pr_poisson[ -c( 9:14, 23:37 ), selected_cols ]

results_imp_pr_poisson_other <- results_imp_pr_poisson_other %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_imp_pr_poisson_other <- results_imp_pr_poisson_other %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_imp_pr_poisson_other <- results_imp_pr_poisson_other %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_imp_pr_poisson_other <- results_imp_pr_poisson_other %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_imp_pr_poisson_other )[1] <- "Demographic Factor"

names( results_imp_pr_poisson_other )[ names( results_imp_pr_poisson_other ) %in% c( "temp1", "temp2", "temp3", "Other_crude", "Other_model_1", "Other_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_imp_pr_poisson_other <- forest(
  results_imp_pr_poisson_other[ , c( 1:10 ) ],
  
  est = list( results_imp_pr_poisson_other$other_point_estimate_2010_crude,
              results_imp_pr_poisson_other$other_point_estimate_2010_model_1,
              results_imp_pr_poisson_other$other_point_estimate_2010_model_2,
              
              results_imp_pr_poisson_other$other_point_estimate_2014_crude,
              results_imp_pr_poisson_other$other_point_estimate_2014_model_1,
              results_imp_pr_poisson_other$other_point_estimate_2014_model_2,
              
              results_imp_pr_poisson_other$other_point_estimate_2021_crude,
              results_imp_pr_poisson_other$other_point_estimate_2021_model_1,
              results_imp_pr_poisson_other$other_point_estimate_2021_model_2
  ),
  
  lower = list( results_imp_pr_poisson_other$other_lower_ci_2010_crude,
                results_imp_pr_poisson_other$other_lower_ci_2010_model_1,
                results_imp_pr_poisson_other$other_lower_ci_2010_model_2,
                
                results_imp_pr_poisson_other$other_lower_ci_2014_crude,
                results_imp_pr_poisson_other$other_lower_ci_2014_model_1,
                results_imp_pr_poisson_other$other_lower_ci_2014_model_2,
                
                results_imp_pr_poisson_other$other_lower_ci_2021_crude,
                results_imp_pr_poisson_other$other_lower_ci_2021_model_1,
                results_imp_pr_poisson_other$other_lower_ci_2021_model_2
  ),
  
  upper = list( results_imp_pr_poisson_other$other_upper_ci_2010_crude,
                results_imp_pr_poisson_other$other_upper_ci_2010_model_1,
                results_imp_pr_poisson_other$other_upper_ci_2010_model_2,
                
                results_imp_pr_poisson_other$other_upper_ci_2014_crude,
                results_imp_pr_poisson_other$other_upper_ci_2014_model_1,
                results_imp_pr_poisson_other$other_upper_ci_2014_model_2,
                
                results_imp_pr_poisson_other$other_upper_ci_2021_crude,
                results_imp_pr_poisson_other$other_upper_ci_2021_model_1,
                results_imp_pr_poisson_other$other_upper_ci_2021_model_2
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 8 ),
  ticks_at = c( 0, 1, 2, 4, 6, 8 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_imp_pr_poisson_other <- edit_plot( p_imp_pr_poisson_other,
                                       row = c( 1, 4, 9, 13 ),
                                       col = 1,
                                       gp = gpar( fontface = "bold" ) 
)

p_imp_pr_poisson_other <- add_text(
  p_imp_pr_poisson_other,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_other <- add_text(
  p_imp_pr_poisson_other,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_other <- add_text(
  p_imp_pr_poisson_other,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_other <- insert_text(
  p_imp_pr_poisson_other,
  text = "Uncertain/Other Sexual Identitiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_other <- edit_plot( p_imp_pr_poisson_other,
                                       row = c( 1, 4, 9, 13 ), 
                                       which = "background",
                                       gp = gpar( fill = "white" )
)

p_imp_pr_poisson_other <- edit_plot( p_imp_pr_poisson_other,
                                       row = c( 2, 3, 5:8, 10:12, 14:16 ), 
                                       which = "background",
                                       gp = gpar( fill = "#eff3f2" )
)

p_imp_pr_poisson_other <- add_border(
  p_imp_pr_poisson_other,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_imp_pr_poisson_other )
```

##### 3.5.2. Part 2
```{r}
results_imp_pr_poisson_other <- results_imp_pr_poisson[ -c( 1:22 ), selected_cols ]

results_imp_pr_poisson_other <- results_imp_pr_poisson_other %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_imp_pr_poisson_other <- results_imp_pr_poisson_other %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_imp_pr_poisson_other <- results_imp_pr_poisson_other %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_imp_pr_poisson_other <- results_imp_pr_poisson_other %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_imp_pr_poisson_other )[1] <- "Demographic Factor"

names( results_imp_pr_poisson_other )[ names( results_imp_pr_poisson_other ) %in% c( "temp1", "temp2", "temp3", "Other_crude", "Other_model_1", "Other_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_imp_pr_poisson_other <- forest(
  results_imp_pr_poisson_other[ , c( 1:10 ) ],
  
  est = list( results_imp_pr_poisson_other$other_point_estimate_2010_crude,
              results_imp_pr_poisson_other$other_point_estimate_2010_model_1,
              results_imp_pr_poisson_other$other_point_estimate_2010_model_2,
              
              results_imp_pr_poisson_other$other_point_estimate_2014_crude,
              results_imp_pr_poisson_other$other_point_estimate_2014_model_1,
              results_imp_pr_poisson_other$other_point_estimate_2014_model_2,
              
              results_imp_pr_poisson_other$other_point_estimate_2021_crude,
              results_imp_pr_poisson_other$other_point_estimate_2021_model_1,
              results_imp_pr_poisson_other$other_point_estimate_2021_model_2
  ),
  
  lower = list( results_imp_pr_poisson_other$other_lower_ci_2010_crude,
                results_imp_pr_poisson_other$other_lower_ci_2010_model_1,
                results_imp_pr_poisson_other$other_lower_ci_2010_model_2,
                
                results_imp_pr_poisson_other$other_lower_ci_2014_crude,
                results_imp_pr_poisson_other$other_lower_ci_2014_model_1,
                results_imp_pr_poisson_other$other_lower_ci_2014_model_2,
                
                results_imp_pr_poisson_other$other_lower_ci_2021_crude,
                results_imp_pr_poisson_other$other_lower_ci_2021_model_1,
                results_imp_pr_poisson_other$other_lower_ci_2021_model_2
  ),
  
  upper = list( results_imp_pr_poisson_other$other_upper_ci_2010_crude,
                results_imp_pr_poisson_other$other_upper_ci_2010_model_1,
                results_imp_pr_poisson_other$other_upper_ci_2010_model_2,
                
                results_imp_pr_poisson_other$other_upper_ci_2014_crude,
                results_imp_pr_poisson_other$other_upper_ci_2014_model_1,
                results_imp_pr_poisson_other$other_upper_ci_2014_model_2,
                
                results_imp_pr_poisson_other$other_upper_ci_2021_crude,
                results_imp_pr_poisson_other$other_upper_ci_2021_model_1,
                results_imp_pr_poisson_other$other_upper_ci_2021_model_2
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 8 ),
  ticks_at = c( 0, 1, 2, 4, 6, 8 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_imp_pr_poisson_other <- edit_plot( p_imp_pr_poisson_other,
                                    row = c( 1, 6, 10, 13 ),
                                    col = 1,
                                    gp = gpar( fontface = "bold" ) 
)

p_imp_pr_poisson_other <- add_text(
  p_imp_pr_poisson_other,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_other <- add_text(
  p_imp_pr_poisson_other,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_other <- add_text(
  p_imp_pr_poisson_other,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_other <- insert_text(
  p_imp_pr_poisson_other,
  text = "Uncertain/Other Sexual Identitiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_other <- edit_plot( p_imp_pr_poisson_other,
                                    row = c( 1, 6, 10, 13 ), 
                                    which = "background",
                                    gp = gpar( fill = "white" )
)

p_imp_pr_poisson_other <- edit_plot( p_imp_pr_poisson_other,
                                    row = c( 2:5, 7:9, 11, 12, 14, 15 ), 
                                    which = "background",
                                    gp = gpar( fill = "#eff3f2" )
)

p_imp_pr_poisson_other <- add_border(
  p_imp_pr_poisson_other,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_imp_pr_poisson_other )
```

#### 3.6. Age by sex
##### 3.6.1. Prepare dataset for plotting
```{r}
results_imp_pr_poisson_age_sex <- results_imp_pr_poisson[ c( 9:14 ), ]

results_imp_pr_poisson_age_sex <- results_imp_pr_poisson_age_sex %>% 
  add_row( subgroup = "Male", .before = 1 )

results_imp_pr_poisson_age_sex <- results_imp_pr_poisson_age_sex %>% 
  add_row( subgroup = "Female", .before = 5 )

results_imp_pr_poisson_age_sex$subgroup[ results_imp_pr_poisson_age_sex$subgroup == "male_ age_exp16-29" ] <- paste0( "   ", "16–29 yrsᵈ\n\n" )
results_imp_pr_poisson_age_sex$subgroup[ results_imp_pr_poisson_age_sex$subgroup == "male_ age_exp30-44" ] <- paste0( "   ", "30–44 yrs\n\n" )
results_imp_pr_poisson_age_sex$subgroup[ results_imp_pr_poisson_age_sex$subgroup == "male_ age_exp>=60" ] <- paste0( "   ", "\u2265 60 yrs\n\n" )

results_imp_pr_poisson_age_sex$subgroup[ results_imp_pr_poisson_age_sex$subgroup == "female_ age_exp16-29" ] <- paste0( "   ", "16–29 yrsᵈ\n\n" )
results_imp_pr_poisson_age_sex$subgroup[ results_imp_pr_poisson_age_sex$subgroup == "female_ age_exp30-44" ] <- paste0( "   ", "30–44 yrs\n\n" )
results_imp_pr_poisson_age_sex$subgroup[ results_imp_pr_poisson_age_sex$subgroup == "female_ age_exp>=60" ] <- paste0( "   ", "\u2265 60 yrs\n\n" )

results_imp_pr_poisson_age_sex <- results_imp_pr_poisson_age_sex %>% 
  add_row( subgroup = paste0( "   ", "45–59 yrs" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 4 )

results_imp_pr_poisson_age_sex <- results_imp_pr_poisson_age_sex %>% 
  add_row( subgroup = paste0( "   ", "45–59 yrs" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 9 )

results_imp_pr_poisson_age_sex$Sexual_minority_crude <- ifelse( is.na( results_imp_pr_poisson_age_sex$Sexual_minority_crude ), "",
                                                      results_imp_pr_poisson_age_sex$Sexual_minority_crude )

results_imp_pr_poisson_age_sex$Sexual_minority_model_1 <- ifelse( is.na( results_imp_pr_poisson_age_sex$Sexual_minority_model_1 ), "",
                                                      results_imp_pr_poisson_age_sex$Sexual_minority_model_1 )

results_imp_pr_poisson_age_sex$Sexual_minority_model_2 <- ifelse( is.na( results_imp_pr_poisson_age_sex$Sexual_minority_model_2 ), "",
                                                      results_imp_pr_poisson_age_sex$Sexual_minority_model_2 )

results_imp_pr_poisson_age_sex$Homosexual_crude <- ifelse( is.na( results_imp_pr_poisson_age_sex$Homosexual_crude ), "",
                                                      results_imp_pr_poisson_age_sex$Homosexual_crude )

results_imp_pr_poisson_age_sex$Homosexual_model_1 <- ifelse( is.na( results_imp_pr_poisson_age_sex$Homosexual_model_1 ), "",
                                                      results_imp_pr_poisson_age_sex$Homosexual_model_1 )

results_imp_pr_poisson_age_sex$Homosexual_model_2 <- ifelse( is.na( results_imp_pr_poisson_age_sex$Homosexual_model_2 ), "",
                                                      results_imp_pr_poisson_age_sex$Homosexual_model_2 )

results_imp_pr_poisson_age_sex$Bisexual_crude <- ifelse( is.na( results_imp_pr_poisson_age_sex$Bisexual_crude ), "",
                                                      results_imp_pr_poisson_age_sex$Bisexual_crude )

results_imp_pr_poisson_age_sex$Bisexual_model_1 <- ifelse( is.na( results_imp_pr_poisson_age_sex$Bisexual_model_1 ), "",
                                                      results_imp_pr_poisson_age_sex$Bisexual_model_1 )

results_imp_pr_poisson_age_sex$Bisexual_model_2 <- ifelse( is.na( results_imp_pr_poisson_age_sex$Bisexual_model_2 ), "",
                                                      results_imp_pr_poisson_age_sex$Bisexual_model_2 )

results_imp_pr_poisson_age_sex$Other_crude <- ifelse( is.na( results_imp_pr_poisson_age_sex$Other_crude ), "",
                                                      results_imp_pr_poisson_age_sex$Other_crude )

results_imp_pr_poisson_age_sex$Other_model_1 <- ifelse( is.na( results_imp_pr_poisson_age_sex$Other_model_1 ), "",
                                                      results_imp_pr_poisson_age_sex$Other_model_1 )

results_imp_pr_poisson_age_sex$Other_model_2 <- ifelse( is.na( results_imp_pr_poisson_age_sex$Other_model_2 ), "",
                                                      results_imp_pr_poisson_age_sex$Other_model_2 )
```

##### 3.6.2. Sexual minority group
```{r}
selected_cols <- grep( "subgroup|sexual_minority", colnames( results_imp_pr_poisson_age_sex ), ignore.case = TRUE )

results_imp_pr_poisson_age_sex_sexual_minorities <- results_imp_pr_poisson_age_sex[ , selected_cols ]

results_imp_pr_poisson_age_sex_sexual_minorities <- results_imp_pr_poisson_age_sex_sexual_minorities %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_imp_pr_poisson_age_sex_sexual_minorities <- results_imp_pr_poisson_age_sex_sexual_minorities %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_imp_pr_poisson_age_sex_sexual_minorities <- results_imp_pr_poisson_age_sex_sexual_minorities %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_imp_pr_poisson_age_sex_sexual_minorities <- results_imp_pr_poisson_age_sex_sexual_minorities %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_imp_pr_poisson_age_sex_sexual_minorities )[1] <- "Age Group"

names( results_imp_pr_poisson_age_sex_sexual_minorities )[ names( results_imp_pr_poisson_age_sex_sexual_minorities ) %in% c( "temp1", "temp2", "temp3", "Sexual_minority_crude", "Sexual_minority_model_1", "Sexual_minority_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_imp_pr_poisson_sexual_minority <- forest(
  results_imp_pr_poisson_age_sex_sexual_minorities[ , c( 1:10 ) ],
  
  est = list( results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_2010_crude,
              results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_2010_model_1,
              results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_2010_model_2,
              
              results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_2014_crude,
              results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_2014_model_1,
              results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_2014_model_2,
              
              results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_2021_crude,
              results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_2021_model_1,
              results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_2021_model_2
  ),
  
  lower = list( results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_2010_crude,
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_2010_model_1,
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_2010_model_2,
                
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_2014_crude,
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_2014_model_1,
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_2014_model_2,
                
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_2021_crude,
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_2021_model_1,
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_2021_model_2
  ),
  
  upper = list( results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_2010_crude,
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_2010_model_1,
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_2010_model_2,
                
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_2014_crude,
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_2014_model_1,
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_2014_model_2,
                
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_2021_crude,
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_2021_model_1,
                results_imp_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_2021_model_2
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 3 ),
  ticks_at = c( 0, 1, 2, 3 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_imp_pr_poisson_sexual_minority <- edit_plot( p_imp_pr_poisson_sexual_minority,
                                              row = c( 1, 6 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_imp_pr_poisson_sexual_minority <- add_text(
  p_imp_pr_poisson_sexual_minority,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_minority <- add_text(
  p_imp_pr_poisson_sexual_minority,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_minority <- add_text(
  p_imp_pr_poisson_sexual_minority,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_minority <- insert_text(
  p_imp_pr_poisson_sexual_minority,
  text = "Sexual Minoritiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_minority <- edit_plot( p_imp_pr_poisson_sexual_minority,
                                              row = c( 1, 6 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_imp_pr_poisson_sexual_minority <- edit_plot( p_imp_pr_poisson_sexual_minority,
                                              row = c( 2:5, 7:10 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_imp_pr_poisson_sexual_minority <- add_border(
  p_imp_pr_poisson_sexual_minority,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_imp_pr_poisson_sexual_minority )
```

##### 3.6.3. Homosexual group
```{r}
selected_cols <- grep( "subgroup|homosexual", colnames( results_imp_pr_poisson_age_sex ), ignore.case = TRUE )

results_imp_pr_poisson_age_sex_homosexual <- results_imp_pr_poisson_age_sex[ , selected_cols ]

results_imp_pr_poisson_age_sex_homosexual <- results_imp_pr_poisson_age_sex_homosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_imp_pr_poisson_age_sex_homosexual <- results_imp_pr_poisson_age_sex_homosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_imp_pr_poisson_age_sex_homosexual <- results_imp_pr_poisson_age_sex_homosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_imp_pr_poisson_age_sex_homosexual <- results_imp_pr_poisson_age_sex_homosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_imp_pr_poisson_age_sex_homosexual )[1] <- "Age Group"

names( results_imp_pr_poisson_age_sex_homosexual )[ names( results_imp_pr_poisson_age_sex_homosexual ) %in% c( "temp1", "temp2", "temp3", "Homosexual_crude", "Homosexual_model_1", "Homosexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_imp_pr_poisson_homosexual <- forest(
  results_imp_pr_poisson_age_sex_homosexual[ , c( 1:10 ) ],
  
  est = list( results_imp_pr_poisson_age_sex_homosexual$homosexual_point_estimate_2010_crude,
              results_imp_pr_poisson_age_sex_homosexual$homosexual_point_estimate_2010_model_1,
              results_imp_pr_poisson_age_sex_homosexual$homosexual_point_estimate_2010_model_2,
              
              results_imp_pr_poisson_age_sex_homosexual$homosexual_point_estimate_2014_crude,
              results_imp_pr_poisson_age_sex_homosexual$homosexual_point_estimate_2014_model_1,
              results_imp_pr_poisson_age_sex_homosexual$homosexual_point_estimate_2014_model_2,
              
              results_imp_pr_poisson_age_sex_homosexual$homosexual_point_estimate_2021_crude,
              results_imp_pr_poisson_age_sex_homosexual$homosexual_point_estimate_2021_model_1,
              results_imp_pr_poisson_age_sex_homosexual$homosexual_point_estimate_2021_model_2
  ),
  
  lower = list( results_imp_pr_poisson_age_sex_homosexual$homosexual_lower_ci_2010_crude,
                results_imp_pr_poisson_age_sex_homosexual$homosexual_lower_ci_2010_model_1,
                results_imp_pr_poisson_age_sex_homosexual$homosexual_lower_ci_2010_model_2,
                
                results_imp_pr_poisson_age_sex_homosexual$homosexual_lower_ci_2014_crude,
                results_imp_pr_poisson_age_sex_homosexual$homosexual_lower_ci_2014_model_1,
                results_imp_pr_poisson_age_sex_homosexual$homosexual_lower_ci_2014_model_2,
                
                results_imp_pr_poisson_age_sex_homosexual$homosexual_lower_ci_2021_crude,
                results_imp_pr_poisson_age_sex_homosexual$homosexual_lower_ci_2021_model_1,
                results_imp_pr_poisson_age_sex_homosexual$homosexual_lower_ci_2021_model_2
  ),
  
  upper = list( results_imp_pr_poisson_age_sex_homosexual$homosexual_upper_ci_2010_crude,
                results_imp_pr_poisson_age_sex_homosexual$homosexual_upper_ci_2010_model_1,
                results_imp_pr_poisson_age_sex_homosexual$homosexual_upper_ci_2010_model_2,
                
                results_imp_pr_poisson_age_sex_homosexual$homosexual_upper_ci_2014_crude,
                results_imp_pr_poisson_age_sex_homosexual$homosexual_upper_ci_2014_model_1,
                results_imp_pr_poisson_age_sex_homosexual$homosexual_upper_ci_2014_model_2,
                
                results_imp_pr_poisson_age_sex_homosexual$homosexual_upper_ci_2021_crude,
                results_imp_pr_poisson_age_sex_homosexual$homosexual_upper_ci_2021_model_1,
                results_imp_pr_poisson_age_sex_homosexual$homosexual_upper_ci_2021_model_2
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_imp_pr_poisson_homosexual <- edit_plot( p_imp_pr_poisson_homosexual,
                                              row = c( 1, 6 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_imp_pr_poisson_homosexual <- add_text(
  p_imp_pr_poisson_homosexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_homosexual <- add_text(
  p_imp_pr_poisson_homosexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_homosexual <- add_text(
  p_imp_pr_poisson_homosexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_homosexual <- insert_text(
  p_imp_pr_poisson_homosexual,
  text = "Homosexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_homosexual <- edit_plot( p_imp_pr_poisson_homosexual,
                                              row = c( 1, 6 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_imp_pr_poisson_homosexual <- edit_plot( p_imp_pr_poisson_homosexual,
                                              row = c( 2:5, 7:10 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_imp_pr_poisson_homosexual <- add_border(
  p_imp_pr_poisson_homosexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_imp_pr_poisson_homosexual )
```

##### 3.6.4. Bisexual group
```{r}
selected_cols <- grep( "subgroup|bisexual", colnames( results_imp_pr_poisson_age_sex ), ignore.case = TRUE )

results_imp_pr_poisson_age_sex_bisexual <- results_imp_pr_poisson_age_sex[ , selected_cols ]

results_imp_pr_poisson_age_sex_bisexual <- results_imp_pr_poisson_age_sex_bisexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_imp_pr_poisson_age_sex_bisexual <- results_imp_pr_poisson_age_sex_bisexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_imp_pr_poisson_age_sex_bisexual <- results_imp_pr_poisson_age_sex_bisexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_imp_pr_poisson_age_sex_bisexual <- results_imp_pr_poisson_age_sex_bisexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_imp_pr_poisson_age_sex_bisexual )[1] <- "Age Group"

names( results_imp_pr_poisson_age_sex_bisexual )[ names( results_imp_pr_poisson_age_sex_bisexual ) %in% c( "temp1", "temp2", "temp3", "Bisexual_crude", "Bisexual_model_1", "Bisexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_imp_pr_poisson_bisexual <- forest(
  results_imp_pr_poisson_age_sex_bisexual[ , c( 1:10 ) ],
  
  est = list( results_imp_pr_poisson_age_sex_bisexual$bisexual_point_estimate_2010_crude,
              results_imp_pr_poisson_age_sex_bisexual$bisexual_point_estimate_2010_model_1,
              results_imp_pr_poisson_age_sex_bisexual$bisexual_point_estimate_2010_model_2,
              
              results_imp_pr_poisson_age_sex_bisexual$bisexual_point_estimate_2014_crude,
              results_imp_pr_poisson_age_sex_bisexual$bisexual_point_estimate_2014_model_1,
              results_imp_pr_poisson_age_sex_bisexual$bisexual_point_estimate_2014_model_2,
              
              results_imp_pr_poisson_age_sex_bisexual$bisexual_point_estimate_2021_crude,
              results_imp_pr_poisson_age_sex_bisexual$bisexual_point_estimate_2021_model_1,
              results_imp_pr_poisson_age_sex_bisexual$bisexual_point_estimate_2021_model_2
  ),
  
  lower = list( results_imp_pr_poisson_age_sex_bisexual$bisexual_lower_ci_2010_crude,
                results_imp_pr_poisson_age_sex_bisexual$bisexual_lower_ci_2010_model_1,
                results_imp_pr_poisson_age_sex_bisexual$bisexual_lower_ci_2010_model_2,
                
                results_imp_pr_poisson_age_sex_bisexual$bisexual_lower_ci_2014_crude,
                results_imp_pr_poisson_age_sex_bisexual$bisexual_lower_ci_2014_model_1,
                results_imp_pr_poisson_age_sex_bisexual$bisexual_lower_ci_2014_model_2,
                
                results_imp_pr_poisson_age_sex_bisexual$bisexual_lower_ci_2021_crude,
                results_imp_pr_poisson_age_sex_bisexual$bisexual_lower_ci_2021_model_1,
                results_imp_pr_poisson_age_sex_bisexual$bisexual_lower_ci_2021_model_2
  ),
  
  upper = list( results_imp_pr_poisson_age_sex_bisexual$bisexual_upper_ci_2010_crude,
                results_imp_pr_poisson_age_sex_bisexual$bisexual_upper_ci_2010_model_1,
                results_imp_pr_poisson_age_sex_bisexual$bisexual_upper_ci_2010_model_2,
                
                results_imp_pr_poisson_age_sex_bisexual$bisexual_upper_ci_2014_crude,
                results_imp_pr_poisson_age_sex_bisexual$bisexual_upper_ci_2014_model_1,
                results_imp_pr_poisson_age_sex_bisexual$bisexual_upper_ci_2014_model_2,
                
                results_imp_pr_poisson_age_sex_bisexual$bisexual_upper_ci_2021_crude,
                results_imp_pr_poisson_age_sex_bisexual$bisexual_upper_ci_2021_model_1,
                results_imp_pr_poisson_age_sex_bisexual$bisexual_upper_ci_2021_model_2
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 8 ),
  ticks_at = c( 0, 1, 2, 4, 6, 8 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_imp_pr_poisson_bisexual <- edit_plot( p_imp_pr_poisson_bisexual,
                                         row = c( 1, 6 ),
                                         col = 1,
                                         gp = gpar( fontface = "bold" ) 
)

p_imp_pr_poisson_bisexual <- add_text(
  p_imp_pr_poisson_bisexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_bisexual <- add_text(
  p_imp_pr_poisson_bisexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_bisexual <- add_text(
  p_imp_pr_poisson_bisexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_bisexual <- insert_text(
  p_imp_pr_poisson_bisexual,
  text = "Bisexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_bisexual <- edit_plot( p_imp_pr_poisson_bisexual,
                                         row = c( 1, 6 ), 
                                         which = "background",
                                         gp = gpar( fill = "white" )
)

p_imp_pr_poisson_bisexual <- edit_plot( p_imp_pr_poisson_bisexual,
                                         row = c( 2:5, 7:10 ), 
                                         which = "background",
                                         gp = gpar( fill = "#eff3f2" )
)

p_imp_pr_poisson_bisexual <- add_border(
  p_imp_pr_poisson_bisexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_imp_pr_poisson_bisexual )
```

##### 3.6.5. Other group
```{r}
selected_cols <- grep( "subgroup|other", colnames( results_imp_pr_poisson_age_sex ), ignore.case = TRUE )

results_imp_pr_poisson_age_sex_other <- results_imp_pr_poisson_age_sex[ , selected_cols ]

results_imp_pr_poisson_age_sex_other <- results_imp_pr_poisson_age_sex_other %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_imp_pr_poisson_age_sex_other <- results_imp_pr_poisson_age_sex_other %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_imp_pr_poisson_age_sex_other <- results_imp_pr_poisson_age_sex_other %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_imp_pr_poisson_age_sex_other <- results_imp_pr_poisson_age_sex_other %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_imp_pr_poisson_age_sex_other )[1] <- "Age Group"

names( results_imp_pr_poisson_age_sex_other )[ names( results_imp_pr_poisson_age_sex_other ) %in% c( "temp1", "temp2", "temp3", "Other_crude", "Other_model_1", "Other_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_imp_pr_poisson_other <- forest(
  results_imp_pr_poisson_age_sex_other[ , c( 1:10 ) ],
  
  est = list( results_imp_pr_poisson_age_sex_other$other_point_estimate_2010_crude,
              results_imp_pr_poisson_age_sex_other$other_point_estimate_2010_model_1,
              results_imp_pr_poisson_age_sex_other$other_point_estimate_2010_model_2,
              
              results_imp_pr_poisson_age_sex_other$other_point_estimate_2014_crude,
              results_imp_pr_poisson_age_sex_other$other_point_estimate_2014_model_1,
              results_imp_pr_poisson_age_sex_other$other_point_estimate_2014_model_2,
              
              results_imp_pr_poisson_age_sex_other$other_point_estimate_2021_crude,
              results_imp_pr_poisson_age_sex_other$other_point_estimate_2021_model_1,
              results_imp_pr_poisson_age_sex_other$other_point_estimate_2021_model_2
  ),
  
  lower = list( results_imp_pr_poisson_age_sex_other$other_lower_ci_2010_crude,
                results_imp_pr_poisson_age_sex_other$other_lower_ci_2010_model_1,
                results_imp_pr_poisson_age_sex_other$other_lower_ci_2010_model_2,
                
                results_imp_pr_poisson_age_sex_other$other_lower_ci_2014_crude,
                results_imp_pr_poisson_age_sex_other$other_lower_ci_2014_model_1,
                results_imp_pr_poisson_age_sex_other$other_lower_ci_2014_model_2,
                
                results_imp_pr_poisson_age_sex_other$other_lower_ci_2021_crude,
                results_imp_pr_poisson_age_sex_other$other_lower_ci_2021_model_1,
                results_imp_pr_poisson_age_sex_other$other_lower_ci_2021_model_2
  ),
  
  upper = list( results_imp_pr_poisson_age_sex_other$other_upper_ci_2010_crude,
                results_imp_pr_poisson_age_sex_other$other_upper_ci_2010_model_1,
                results_imp_pr_poisson_age_sex_other$other_upper_ci_2010_model_2,
                
                results_imp_pr_poisson_age_sex_other$other_upper_ci_2014_crude,
                results_imp_pr_poisson_age_sex_other$other_upper_ci_2014_model_1,
                results_imp_pr_poisson_age_sex_other$other_upper_ci_2014_model_2,
                
                results_imp_pr_poisson_age_sex_other$other_upper_ci_2021_crude,
                results_imp_pr_poisson_age_sex_other$other_upper_ci_2021_model_1,
                results_imp_pr_poisson_age_sex_other$other_upper_ci_2021_model_2
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 3 ),
  ticks_at = c( 0, 1, 2, 3 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_imp_pr_poisson_other <- edit_plot( p_imp_pr_poisson_other,
                                       row = c( 1, 6 ),
                                       col = 1,
                                       gp = gpar( fontface = "bold" ) 
)

p_imp_pr_poisson_other <- add_text(
  p_imp_pr_poisson_other,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_other <- add_text(
  p_imp_pr_poisson_other,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_other <- add_text(
  p_imp_pr_poisson_other,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_other <- insert_text(
  p_imp_pr_poisson_other,
  text = "Uncertain/Other Sexual Identitiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_other <- edit_plot( p_imp_pr_poisson_other,
                                       row = c( 1, 6 ), 
                                       which = "background",
                                       gp = gpar( fill = "white" )
)

p_imp_pr_poisson_other <- edit_plot( p_imp_pr_poisson_other,
                                       row = c( 2:5, 7:10 ), 
                                       which = "background",
                                       gp = gpar( fill = "#eff3f2" )
)

p_imp_pr_poisson_other <- add_border(
  p_imp_pr_poisson_other,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_imp_pr_poisson_other )
```

### 4. Plots for Proportion of Change in Sexual Identity
#### 4.1. Prepare dataset for plotting
```{r}
fluidity_imp_prop_summary_2010 <- read_excel("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/fluidity_imp_prop_summary_2010.xlsx")
fluidity_imp_prop_summary_2014 <- read_excel("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/fluidity_imp_prop_summary_2014.xlsx")

fluidity_imp_prop_summary_2010[ 4,1 ] <- "Other_identity"
fluidity_imp_prop_summary_2010$subgroup[ fluidity_imp_prop_summary_2010$subgroup == "18-29" ] <- "16-29"
fluidity_imp_prop_summary_2010$subgroup[ fluidity_imp_prop_summary_2010$subgroup == "18-29.Male" ] <- "16-29.Male"
fluidity_imp_prop_summary_2010$subgroup[ fluidity_imp_prop_summary_2010$subgroup == "18-29.Female" ] <- "16-29.Female"

fluidity_imp_prop_summary_2014[ 4,1 ] <- "Other_identity"

# merge datasets
fluidity_imp_prop_summary <- fluidity_imp_prop_summary_2010 %>% 
  full_join( fluidity_imp_prop_summary_2014, by = "subgroup" )

# modify table format
desired_order <- c( "Heterosexual", "Homosexual", "Bisexual", "Other_identity", "Male", "Female", "16-29", "30-44", "45-59", ">=60", "16-29.Male", "30-44.Male", "45-59.Male", ">=60.Male", "16-29.Female", "30-44.Female", "45-59.Female", ">=60.Female", "Sweden", "Europe", "Outside Europe", "<=9 years", "10-12 years", ">=13 years", "<=2,500", "(2,500, 3,500]", "(3,500, 4,500]", ">4,500", "Currently married", "Never married", "Other", "living_alone_yes", "living_alone_no", "personal_support_yes", "personal_support_no", "Stockholm County" )

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>%
  mutate( subgroup = factor( subgroup, levels = desired_order ) ) %>%
  arrange( subgroup )

fluidity_imp_prop_summary[ 4,1 ] <- "Other"

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>% 
  add_row( subgroup = "Sexual identityᵇ", .before = 1 )

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>% 
  add_row( subgroup = "Sex", .before = 6 )

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>% 
  add_row( subgroup = "Age group", .before = 9 )

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>% 
  add_row( subgroup = "Male", .before = 14 )

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>% 
  add_row( subgroup = "Female", .before = 19 )

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>% 
  add_row( subgroup = "Country of birth", .before = 24 )

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>% 
  add_row( subgroup = "Education years", .before = 28 )

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>% 
  add_row( subgroup = "Income (100 kr/yr)ᵉ", .before = 32 )

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>% 
  add_row( subgroup = "Marital statusᶠ", .before = 37 )

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>% 
  add_row( subgroup = "Living alone", .before = 41 )

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>% 
  add_row( subgroup = "Personal support", .before = 44 )

fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "16-29" ] <- "16–29 yrsᶜ"
fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "30-44" ] <- "30–44 yrs"
fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "45-59" ] <- "45–59 yrs"
fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == ">=60" ] <- "\u2265 60 yrs"

fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "16-29.Male" ] <- "16–29 yrsᵇ"
fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "30-44.Male" ] <- "30–44 yrs"
fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "45-59.Male" ] <- "45–59 yrs"
fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == ">=60.Male" ] <- "\u2265 60 yrs"

fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "16-29.Female" ] <- "16–29 yrsᵇ"
fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "30-44.Female" ] <- "30–44 yrs"
fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "45-59.Female" ] <- "45–59 yrs"
fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == ">=60.Female" ] <- "\u2265 60 yrs"

fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "<=9 years" ] <- "\u2264 9 yrs"
fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "10-12 years" ] <- "10–12 yrs"
fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == ">=13 years" ] <- "\u2265 13 yrs"

fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "Europe" ] <- "Europeᵈ"

fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "<=2,500" ] <- "\u2264 2,500"
fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == ">4,500" ] <- "> 4,500"

fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "living_alone_no" ] <- "No"
fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "living_alone_yes" ] <- "Yes"
fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "personal_support_no" ] <- "No"
fluidity_imp_prop_summary$subgroup[ fluidity_imp_prop_summary$subgroup == "personal_support_yes" ] <- "Yes"

fluidity_imp_prop_summary$subgroup <- ifelse( is.na( fluidity_imp_prop_summary$changed_point_estimate_2010 ) | 
                                      fluidity_imp_prop_summary$subgroup == "Stockholm County", 
                                    fluidity_imp_prop_summary$subgroup,
                                    paste0( "   ", fluidity_imp_prop_summary$subgroup ) )

colnames( fluidity_imp_prop_summary )[ colnames( fluidity_imp_prop_summary ) == "subgroup" ] <- "Subgroup"

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>% 
  add_column( "SPHC 2010" = paste0(
    sprintf( "%.1f", fluidity_imp_prop_summary$changed_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", fluidity_imp_prop_summary$changed_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", fluidity_imp_prop_summary$changed_upper_ci_2010*100 ), ")" ),
    .before = 3 )

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

fluidity_imp_prop_summary <- fluidity_imp_prop_summary %>% 
  add_column( "SPHC 2014" = paste0(
    sprintf( "%.1f", fluidity_imp_prop_summary$changed_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", fluidity_imp_prop_summary$changed_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", fluidity_imp_prop_summary$changed_upper_ci_2014*100 ), ")"  ),
    .before = 5 )

fluidity_imp_prop_summary$`SPHC 2010` <- ifelse( is.na( fluidity_imp_prop_summary$changed_point_estimate_2010 ), "",
  fluidity_imp_prop_summary$`SPHC 2010` )

fluidity_imp_prop_summary$`SPHC 2014` <- ifelse( is.na( fluidity_imp_prop_summary$changed_point_estimate_2010 ), "",
  fluidity_imp_prop_summary$`SPHC 2014` )

fluidity_imp_prop_summary$sample_size_2010 <- ifelse( is.na( fluidity_imp_prop_summary$changed_point_estimate_2010 ), "",
  fluidity_imp_prop_summary$sample_size_2010 )

fluidity_imp_prop_summary$sample_size_2014 <- ifelse( is.na( fluidity_imp_prop_summary$changed_point_estimate_2010 ), "",
  fluidity_imp_prop_summary$sample_size_2014 )

fluidity_imp_prop_summary_updated <- fluidity_imp_prop_summary %>%
  select( 1:3, 9, 4, 5, 13, everything() )

fluidity_imp_prop_summary_updated <- fluidity_imp_prop_summary_updated %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 7 ) %>%
  add_column( temp4 = " ", .before = 10 )

names( fluidity_imp_prop_summary_updated )[ names( fluidity_imp_prop_summary_updated ) %in% c( "temp1", "temp2", "temp3", "temp4", "SPHC 2010", "SPHC 2014", "sample_size_2010", "sample_size_2014" ) ] <- ""
```

#### 4.2. Plotting
##### 4.2.1. Part 1
```{r}
tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
)

fluidity_imp_prop_summary_updated_part_1 <- fluidity_imp_prop_summary_updated[ c( 1:13, 24:47 ), ]

p_prop_imp_fluidity <- forest(
  fluidity_imp_prop_summary_updated_part_1[ , c( 1:11 ) ],
  
  est = list( fluidity_imp_prop_summary_updated_part_1$changed_point_estimate_2010*100,
              fluidity_imp_prop_summary_updated_part_1$changed_point_estimate_2014*100 ),
  
  lower = list( fluidity_imp_prop_summary_updated_part_1$changed_lower_ci_2010*100,
                fluidity_imp_prop_summary_updated_part_1$changed_lower_ci_2014*100 ),
  
  upper = list( fluidity_imp_prop_summary_updated_part_1$changed_upper_ci_2010*100,
                fluidity_imp_prop_summary_updated_part_1$changed_upper_ci_2014*100 ),
  
  ci_column = c( 3, 8 ),
  is_summary = c( rep( FALSE, nrow( fluidity_imp_prop_summary_updated_part_1 ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( fluidity_imp_prop_summary_2010[ fluidity_imp_prop_summary_2010$subgroup == "Stockholm County", ]$changed_point_estimate_2010*100, fluidity_imp_prop_summary_2014[ fluidity_imp_prop_summary_2014$subgroup == "Stockholm County", ]$changed_point_estimate_2014*100 ),
  
  xlim = list( c( 0, 80 ), c( 0, 60 ) ),
  ticks_at = list( c( 0, 20, 40, 60, 80 ), c( 0, 20, 40, 60 ) ),
  
  xlab = "Proportion (%) (95% CI)",
  theme = tm
)

p_prop_imp_fluidity <- edit_plot(
  p_prop_imp_fluidity,
  row = c( 1, 6, 9, 14, 18, 22, 27, 31, 34, 37 ),
  gp = gpar(fontface = "bold")
)

p_prop_imp_fluidity <- add_text(
  p_prop_imp_fluidity,
  text = "Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_imp_fluidity <- add_text(
  p_prop_imp_fluidity,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_imp_fluidity <- add_text(
  p_prop_imp_fluidity,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_imp_fluidity <- insert_text(
  p_prop_imp_fluidity,
  text = "SPHC 2010",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_imp_fluidity <- add_text(
  p_prop_imp_fluidity,
  text = "SPHC 2014",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_imp_fluidity <- add_text(
  p_prop_imp_fluidity,
  text = "Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_imp_fluidity <- add_border(
  p_prop_imp_fluidity,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_prop_imp_fluidity <- add_border(
  p_prop_imp_fluidity,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_prop_imp_fluidity <- edit_plot( p_prop_imp_fluidity,
                                 row = c( 1, 6, 9, 14, 18, 22, 27, 31, 34, 37 ), 
                                 which = "background",
                                 gp = gpar( fill = "white" )
)

p_prop_imp_fluidity <- edit_plot( p_prop_imp_fluidity,
                                 row = c( 2:5, 7, 8, 10:13, 15:17, 19:21, 23:26, 28:30, 32, 33, 35, 36 ), 
                                 which = "background",
                                 gp = gpar( fill = "#eff3f2" )
)

plot( p_prop_imp_fluidity )
```

##### 4.2.2. Part 2 (age by sex)
```{r}
tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
)

fluidity_imp_prop_summary_updated_part_2 <- fluidity_imp_prop_summary_updated[ c( 14:23, 47 ), ]
colnames( fluidity_imp_prop_summary_updated_part_2 )[1] <- "Age Group"

p_prop_imp_fluidity <- forest(
  fluidity_imp_prop_summary_updated_part_2[ , c( 1:11 ) ],
  
  est = list( fluidity_imp_prop_summary_updated_part_2$changed_point_estimate_2010*100,
              fluidity_imp_prop_summary_updated_part_2$changed_point_estimate_2014*100 ),
  
  lower = list( fluidity_imp_prop_summary_updated_part_2$changed_lower_ci_2010*100,
                fluidity_imp_prop_summary_updated_part_2$changed_lower_ci_2014*100 ),
  
  upper = list( fluidity_imp_prop_summary_updated_part_2$changed_upper_ci_2010*100,
                fluidity_imp_prop_summary_updated_part_2$changed_upper_ci_2014*100 ),
  
  ci_column = c( 3, 8 ),
  is_summary = c( rep( FALSE, nrow( fluidity_imp_prop_summary_updated_part_2 ) - 1 ), TRUE ),
  sizes = 0.4,
  
   ref_line = c( fluidity_imp_prop_summary_2010[ fluidity_imp_prop_summary_2010$subgroup == "Stockholm County", ]$changed_point_estimate_2010*100, fluidity_imp_prop_summary_2014[ fluidity_imp_prop_summary_2014$subgroup == "Stockholm County", ]$changed_point_estimate_2014*100 ),
  
  xlim = list( c( 0, 30 ), c( 0, 20 ) ),
  ticks_at = list( c( 0, 10, 20, 30 ), c( 0, 10, 20 ) ),
  
  xlab = "Proportion (%) (95% CI)",
  theme = tm
)

p_prop_imp_fluidity <- edit_plot(
  p_prop_imp_fluidity,
  row = c( 1, 6, 11 ),
  gp = gpar(fontface = "bold")
)

p_prop_imp_fluidity <- add_text(
  p_prop_imp_fluidity,
  text = "Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_imp_fluidity <- add_text(
  p_prop_imp_fluidity,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_imp_fluidity <- add_text(
  p_prop_imp_fluidity,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_imp_fluidity <- insert_text(
  p_prop_imp_fluidity,
  text = "SPHC 2010",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_imp_fluidity <- add_text(
  p_prop_imp_fluidity,
  text = "SPHC 2014",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_imp_fluidity <- add_text(
  p_prop_imp_fluidity,
  text = "Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_imp_fluidity <- add_border(
  p_prop_imp_fluidity,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_prop_imp_fluidity <- add_border(
  p_prop_imp_fluidity,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_prop_imp_fluidity <- edit_plot( p_prop_imp_fluidity,
                                 row = c( 1, 6, 11 ), 
                                 which = "background",
                                 gp = gpar( fill = "white" )
)

p_prop_imp_fluidity <- edit_plot( p_prop_imp_fluidity,
                                 row = c( 2:5, 7:10 ), 
                                 which = "background",
                                 gp = gpar( fill = "#eff3f2" )
)

plot( p_prop_imp_fluidity )
```

### 5. Plots for Relation between Change in Sexual Identity and Demographic Factors
#### 5.1. Prepare dataset for plotting
```{r}
fluidity_imp_rr_2010 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/fluidity_imp_rr_2010.xlsx")
fluidity_imp_rr_2014 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/fluidity_imp_rr_2014.xlsx")

# to make it easier to combine across datasets
# a note on these changes will be added on the graph later
fluidity_imp_rr_2010$subgroup[ fluidity_imp_rr_2010$subgroup == "age_exp18-29" ] <- "age_exp16-29"
fluidity_imp_rr_2010$subgroup[ fluidity_imp_rr_2010$subgroup == "male_ age_exp18-29" ] <- "age_exp16-29_Male"
fluidity_imp_rr_2010$subgroup[ fluidity_imp_rr_2010$subgroup == "male_ age_exp30-44" ] <- "age_exp30-44_Male"
fluidity_imp_rr_2010$subgroup[ fluidity_imp_rr_2010$subgroup == "male_ age_exp>=60" ] <- "age_exp>=60_Male"
fluidity_imp_rr_2010$subgroup[ fluidity_imp_rr_2010$subgroup == "female_ age_exp18-29" ] <- "age_exp16-29_Female"
fluidity_imp_rr_2010$subgroup[ fluidity_imp_rr_2010$subgroup == "female_ age_exp30-44" ] <- "age_exp30-44_Female"
fluidity_imp_rr_2010$subgroup[ fluidity_imp_rr_2010$subgroup == "female_ age_exp>=60" ] <- "age_exp>=60_Female"

fluidity_imp_rr_2014$subgroup[ fluidity_imp_rr_2014$subgroup == "male_ age_exp16-29" ] <- "age_exp16-29_Male"
fluidity_imp_rr_2014$subgroup[ fluidity_imp_rr_2014$subgroup == "male_ age_exp30-44" ] <- "age_exp30-44_Male"
fluidity_imp_rr_2014$subgroup[ fluidity_imp_rr_2014$subgroup == "male_ age_exp>=60" ] <- "age_exp>=60_Male"
fluidity_imp_rr_2014$subgroup[ fluidity_imp_rr_2014$subgroup == "female_ age_exp16-29" ] <- "age_exp16-29_Female"
fluidity_imp_rr_2014$subgroup[ fluidity_imp_rr_2014$subgroup == "female_ age_exp30-44" ] <- "age_exp30-44_Female"
fluidity_imp_rr_2014$subgroup[ fluidity_imp_rr_2014$subgroup == "female_ age_exp>=60" ] <- "age_exp>=60_Female"

fluidity_imp_rr_2010$subgroup[ fluidity_imp_rr_2010$subgroup == "sexual_identity_2010_expHomosexual" ] <- "Homosexual"
fluidity_imp_rr_2010$subgroup[ fluidity_imp_rr_2010$subgroup == "sexual_identity_2010_expBisexual" ] <- "Bisexual"
fluidity_imp_rr_2010$subgroup[ fluidity_imp_rr_2010$subgroup == "sexual_identity_2010_expOther" ] <- "Other"

fluidity_imp_rr_2014$subgroup[ fluidity_imp_rr_2014$subgroup == "sexual_identity_2014_expHomosexual" ] <- "Homosexual"
fluidity_imp_rr_2014$subgroup[ fluidity_imp_rr_2014$subgroup == "sexual_identity_2014_expBisexual" ] <- "Bisexual"
fluidity_imp_rr_2014$subgroup[ fluidity_imp_rr_2014$subgroup == "sexual_identity_2014_expOther" ] <- "Other"

# merge datasets
fluidity_imp_rr <- fluidity_imp_rr_2010 %>%
  full_join( fluidity_imp_rr_2014, by = "subgroup" )

# modify table format
desired_order <- c( "Homosexual", "Bisexual", "Other", "sex_expFemale", "age_exp16-29", "age_exp30-44", "age_exp>=60", "age_exp16-29_Male", "age_exp30-44_Male", "age_exp>=60_Male", "age_exp16-29_Female", "age_exp30-44_Female", "age_exp>=60_Female", "country_of_birth_expEurope", "country_of_birth_expOutside Europe", "education_exp<=9 years", "education_exp10-12 years", "income_exp<=2,500", "income_exp(2,500, 3,500]", "income_exp(3,500, 4,500]", "marital_status_expNever married", "marital_status_expOther", "living_status_expliving_alone_yes", "personal_support_exppersonal_support_no" )

fluidity_imp_rr <- fluidity_imp_rr %>%
  mutate( subgroup = factor( subgroup, levels = desired_order ) ) %>%
  arrange( subgroup )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = "Sexual identityᶜ", .before = 1 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = "Sex", .before = 5 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = "Age group", .before = 7 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = "Male", .before = 11 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = "Female", .before = 15 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = "Country of birth", .before = 19 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = "Education years", .before = 22 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = "Income (100 kr/yr)ᵉ", .before = 25 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = "Marital statusᵈ", .before = 29 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = "Living alone", .before = 32 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = "Personal support", .before = 34 )

fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "Homosexual" ] <- paste0( "   ", "Homosexual\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "Bisexual" ] <- paste0( "   ", "Bisexual\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "Other" ] <- paste0( "   ", "Other\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "sex_expFemale" ] <- paste0( "   ", "Female\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "age_exp16-29" ] <- paste0( "   ", "16–29 yrsᶜ\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "age_exp30-44" ] <- paste0( "   ", "30–44 yrs\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "age_exp>=60" ] <- paste0( "   ", "\u2265 60 yrs\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "age_exp16-29_Male" ] <- paste0( "   ", "16–29 yrsᶜ\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "age_exp30-44_Male" ] <- paste0( "   ", "30–44 yrs\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "age_exp>=60_Male" ] <- paste0( "   ", "\u2265 60 yrs\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "age_exp16-29_Female" ] <- paste0( "   ", "16–29 yrsᶜ\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "age_exp30-44_Female" ] <- paste0( "   ", "30–44 yrs\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "age_exp>=60_Female" ] <- paste0( "   ", "\u2265 60 yrs\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "country_of_birth_expEurope" ] <- paste0( "   ", "Europeᵈ\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "country_of_birth_expOutside Europe" ] <- paste0( "   ", "Outside Europe\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "education_exp<=9 years" ] <- paste0( "   ", "\u2264 9 yrs\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "education_exp10-12 years" ] <- paste0( "   ", "10–12 yrs\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "income_exp<=2,500" ] <- paste0( "   ", "\u2264 2,500\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "income_exp(2,500, 3,500]" ] <- paste0( "   ", "(2,500, 3,500]\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "income_exp(3,500, 4,500]" ] <- paste0( "   ", "(3,500, 4,500]\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "marital_status_expNever married" ] <- paste0( "   ", "Never married\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "marital_status_expOther" ] <- paste0( "   ", "Other\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "living_status_expliving_alone_yes" ] <- paste0( "   ", "Yes\n" )
fluidity_imp_rr$subgroup[ fluidity_imp_rr$subgroup == "personal_support_exppersonal_support_no" ] <- paste0( "   ", "No\n" )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_column( "Sexual_fluidity_2010_crude" = paste0(
    sprintf( "%.2f", fluidity_imp_rr$point_estimate_2010_crude ), " (", 
    sprintf( "%.2f", fluidity_imp_rr$lower_ci_2010_crude ), ", ", 
    sprintf( "%.2f", fluidity_imp_rr$upper_ci_2010_crude ), ")" ),
    .before = 2 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_column( "Sexual_fluidity_2010_model_1" = paste0(
    sprintf( "%.2f", fluidity_imp_rr$point_estimate_2010_model_1 ), " (", 
    sprintf( "%.2f", fluidity_imp_rr$lower_ci_2010_model_1 ), ", ", 
    sprintf( "%.2f", fluidity_imp_rr$upper_ci_2010_model_1 ), ")" ),
    .before = 3 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_column( "Sexual_fluidity_2010_model_2" = paste0(
    sprintf( "%.2f", fluidity_imp_rr$point_estimate_2010_model_2 ), " (", 
    sprintf( "%.2f", fluidity_imp_rr$lower_ci_2010_model_2 ), ", ", 
    sprintf( "%.2f", fluidity_imp_rr$upper_ci_2010_model_2 ), ")" ),
    .before = 4 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_column( "Sexual_fluidity_2014_crude" = paste0(
    sprintf( "%.2f", fluidity_imp_rr$point_estimate_2014_crude ), " (", 
    sprintf( "%.2f", fluidity_imp_rr$lower_ci_2014_crude ), ", ", 
    sprintf( "%.2f", fluidity_imp_rr$upper_ci_2014_crude ), ")" ),
    .before = 5 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_column( "Sexual_fluidity_2014_model_1" = paste0(
    sprintf( "%.2f", fluidity_imp_rr$point_estimate_2014_model_1 ), " (", 
    sprintf( "%.2f", fluidity_imp_rr$lower_ci_2014_model_1 ), ", ", 
    sprintf( "%.2f", fluidity_imp_rr$upper_ci_2014_model_1 ), ")" ),
    .before = 6 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_column( "Sexual_fluidity_2014_model_2" = paste0(
    sprintf( "%.2f", fluidity_imp_rr$point_estimate_2014_model_2 ), " (", 
    sprintf( "%.2f", fluidity_imp_rr$lower_ci_2014_model_2 ), ", ", 
    sprintf( "%.2f", fluidity_imp_rr$upper_ci_2014_model_2 ), ")" ),
    .before = 7 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_column( "Sexual_fluidity_crude" = paste( fluidity_imp_rr$Sexual_fluidity_2010_crude,
                                               fluidity_imp_rr$Sexual_fluidity_2014_crude,
                                               sep = "\n" ),
              .before = 2 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_column( "Sexual_fluidity_model_1" = paste( fluidity_imp_rr$Sexual_fluidity_2010_model_1,
                                                 fluidity_imp_rr$Sexual_fluidity_2014_model_1,
                                                 sep = "\n" ),
              .before = 3 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_column( "Sexual_fluidity_model_2" = paste( fluidity_imp_rr$Sexual_fluidity_2010_model_2,
                                                 fluidity_imp_rr$Sexual_fluidity_2014_model_2,
                                                 sep = "\n" ),
              .before = 4 )

fluidity_imp_rr$Sexual_fluidity_crude <- ifelse( is.na( fluidity_imp_rr$point_estimate_2010_crude ), "",
                                                            fluidity_imp_rr$Sexual_fluidity_crude )

fluidity_imp_rr$Sexual_fluidity_model_1 <- ifelse( is.na( fluidity_imp_rr$point_estimate_2010_crude ), "",
                                                            fluidity_imp_rr$Sexual_fluidity_model_1 )

fluidity_imp_rr$Sexual_fluidity_model_2 <- ifelse( is.na( fluidity_imp_rr$point_estimate_2010_crude ), "",
                                                            fluidity_imp_rr$Sexual_fluidity_model_2 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = paste0( "   ", "Heterosexual" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 2 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = paste0( "   ", "Male" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 7 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = paste0( "   ", "45–59 yrs" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 12 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = paste0( "   ", "45–59 yrs" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 17 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = paste0( "   ", "45–59 yrs" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 22 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = paste0( "   ", "Sweden" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 25 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = paste0( "   ", "\u2265 13 yrs" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 31 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = paste0( "   ", "> 4,500" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 36 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = paste0( "   ", "Currently married" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 38 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = paste0( "   ", "No" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 43 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_row( subgroup = paste0( "   ", "Yes" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 45 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

fluidity_imp_rr <- fluidity_imp_rr %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

fluidity_imp_rr <- fluidity_imp_rr %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( fluidity_imp_rr )[1] <- "Demographic Factor"

names( fluidity_imp_rr )[ names( fluidity_imp_rr ) %in% c( "temp1", "temp2", "temp3", "Sexual_fluidity_crude", "Sexual_fluidity_model_1", "Sexual_fluidity_model_2" ) ] <- ""
```

#### 5.2. Plotting
##### 5.2.1. Part 1
```{r}
tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC 2010", "SPHC 2014" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

fluidity_imp_rr_part_1 <- fluidity_imp_rr[ -c( 9:23, 37:46 ), ]

p_imp_pr_poisson_sexual_fluidity <- forest(
  fluidity_imp_rr_part_1[ , c( 1:10 ) ],
  
  est = list( fluidity_imp_rr_part_1$point_estimate_2010_crude,
              fluidity_imp_rr_part_1$point_estimate_2010_model_1,
              fluidity_imp_rr_part_1$point_estimate_2010_model_2,
              
              fluidity_imp_rr_part_1$point_estimate_2014_crude,
              fluidity_imp_rr_part_1$point_estimate_2014_model_1,
              fluidity_imp_rr_part_1$point_estimate_2014_model_2
  ),
  
  lower = list( fluidity_imp_rr_part_1$lower_ci_2010_crude,
                fluidity_imp_rr_part_1$lower_ci_2010_model_1,
                fluidity_imp_rr_part_1$lower_ci_2010_model_2,
                
                fluidity_imp_rr_part_1$lower_ci_2014_crude,
                fluidity_imp_rr_part_1$lower_ci_2014_model_1,
                fluidity_imp_rr_part_1$lower_ci_2014_model_2
  ),
  
  upper = list( fluidity_imp_rr_part_1$upper_ci_2010_crude,
                fluidity_imp_rr_part_1$upper_ci_2010_model_1,
                fluidity_imp_rr_part_1$upper_ci_2010_model_2,
                
                fluidity_imp_rr_part_1$upper_ci_2014_crude,
                fluidity_imp_rr_part_1$upper_ci_2014_model_1,
                fluidity_imp_rr_part_1$upper_ci_2014_model_2
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 10 ),
  ticks_at = c( 0, 1, 5, 10 ),
  
  xlab = "Risk Ratio (95% CI)",
  nudge_y = 0.5,
  theme = tm
)

p_imp_pr_poisson_sexual_fluidity <- edit_plot( p_imp_pr_poisson_sexual_fluidity,
                                              row = c( 1, 6, 9, 13, 17 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_imp_pr_poisson_sexual_fluidity <- add_text(
  p_imp_pr_poisson_sexual_fluidity,
  text = "Crude Risk Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_fluidity <- add_text(
  p_imp_pr_poisson_sexual_fluidity,
  text = "Model 1, Risk Ratio (95% CI)ᵃ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_fluidity <- add_text(
  p_imp_pr_poisson_sexual_fluidity,
  text = "Model 2, Risk Ratio (95% CI)ᵇ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_fluidity <- insert_text(
  p_imp_pr_poisson_sexual_fluidity,
  text = "Change in Sexual Identity",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_fluidity <- edit_plot( p_imp_pr_poisson_sexual_fluidity,
                                              row = c( 1, 6, 9, 13, 17 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_imp_pr_poisson_sexual_fluidity <- edit_plot( p_imp_pr_poisson_sexual_fluidity,
                                              row = c( 2:5, 7, 8, 10:12, 14:16, 18:21 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_imp_pr_poisson_sexual_fluidity <- add_border(
  p_imp_pr_poisson_sexual_fluidity,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_imp_pr_poisson_sexual_fluidity )
```

##### 5.2.2. Part 2
```{r}
tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC 2010", "SPHC 2014" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

fluidity_imp_rr_part_2 <- fluidity_imp_rr[ c( 9:13, 37:46 ), ]

p_imp_pr_poisson_sexual_fluidity <- forest(
  fluidity_imp_rr_part_2[ , c( 1:10 ) ],
  
  est = list( fluidity_imp_rr_part_2$point_estimate_2010_crude,
              fluidity_imp_rr_part_2$point_estimate_2010_model_1,
              fluidity_imp_rr_part_2$point_estimate_2010_model_2,
              
              fluidity_imp_rr_part_2$point_estimate_2014_crude,
              fluidity_imp_rr_part_2$point_estimate_2014_model_1,
              fluidity_imp_rr_part_2$point_estimate_2014_model_2
  ),
  
  lower = list( fluidity_imp_rr_part_2$lower_ci_2010_crude,
                fluidity_imp_rr_part_2$lower_ci_2010_model_1,
                fluidity_imp_rr_part_2$lower_ci_2010_model_2,
                
                fluidity_imp_rr_part_2$lower_ci_2014_crude,
                fluidity_imp_rr_part_2$lower_ci_2014_model_1,
                fluidity_imp_rr_part_2$lower_ci_2014_model_2
  ),
  
  upper = list( fluidity_imp_rr_part_2$upper_ci_2010_crude,
                fluidity_imp_rr_part_2$upper_ci_2010_model_1,
                fluidity_imp_rr_part_2$upper_ci_2010_model_2,
                
                fluidity_imp_rr_part_2$upper_ci_2014_crude,
                fluidity_imp_rr_part_2$upper_ci_2014_model_1,
                fluidity_imp_rr_part_2$upper_ci_2014_model_2
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 3 ),
  ticks_at = c( 0, 1, 2, 3 ),
  
  xlab = "Risk Ratio (95% CI)",
  nudge_y = 0.5,
  theme = tm
)

p_imp_pr_poisson_sexual_fluidity <- edit_plot( p_imp_pr_poisson_sexual_fluidity,
                                              row = c( 1, 6, 10, 13 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_imp_pr_poisson_sexual_fluidity <- add_text(
  p_imp_pr_poisson_sexual_fluidity,
  text = "Crude Risk Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_fluidity <- add_text(
  p_imp_pr_poisson_sexual_fluidity,
  text = "Model 1, Risk Ratio (95% CI)ᵃ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_fluidity <- add_text(
  p_imp_pr_poisson_sexual_fluidity,
  text = "Model 2, Risk Ratio (95% CI)ᵇ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_fluidity <- insert_text(
  p_imp_pr_poisson_sexual_fluidity,
  text = "Change in Sexual Identity",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_fluidity <- edit_plot( p_imp_pr_poisson_sexual_fluidity,
                                              row = c( 1, 6, 10, 13 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_imp_pr_poisson_sexual_fluidity <- edit_plot( p_imp_pr_poisson_sexual_fluidity,
                                              row = c( 2:5, 7:9, 11, 12, 14, 15 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_imp_pr_poisson_sexual_fluidity <- add_border(
  p_imp_pr_poisson_sexual_fluidity,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_imp_pr_poisson_sexual_fluidity )
```

##### 5.2.3. Part 3 (age by sex)
```{r}
tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC 2010", "SPHC 2014" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

fluidity_imp_rr_age_by_sex <- fluidity_imp_rr[ c( 14:23 ), ]

colnames( fluidity_imp_rr_age_by_sex )[1] <- "Age Group"

p_imp_pr_poisson_sexual_fluidity <- forest(
  fluidity_imp_rr_age_by_sex[ , c( 1:10 ) ],
  
  est = list( fluidity_imp_rr_age_by_sex$point_estimate_2010_crude,
              fluidity_imp_rr_age_by_sex$point_estimate_2010_model_1,
              fluidity_imp_rr_age_by_sex$point_estimate_2010_model_2,
              
              fluidity_imp_rr_age_by_sex$point_estimate_2014_crude,
              fluidity_imp_rr_age_by_sex$point_estimate_2014_model_1,
              fluidity_imp_rr_age_by_sex$point_estimate_2014_model_2
  ),
  
  lower = list( fluidity_imp_rr_age_by_sex$lower_ci_2010_crude,
                fluidity_imp_rr_age_by_sex$lower_ci_2010_model_1,
                fluidity_imp_rr_age_by_sex$lower_ci_2010_model_2,
                
                fluidity_imp_rr_age_by_sex$lower_ci_2014_crude,
                fluidity_imp_rr_age_by_sex$lower_ci_2014_model_1,
                fluidity_imp_rr_age_by_sex$lower_ci_2014_model_2
  ),
  
  upper = list( fluidity_imp_rr_age_by_sex$upper_ci_2010_crude,
                fluidity_imp_rr_age_by_sex$upper_ci_2010_model_1,
                fluidity_imp_rr_age_by_sex$upper_ci_2010_model_2,
                
                fluidity_imp_rr_age_by_sex$upper_ci_2014_crude,
                fluidity_imp_rr_age_by_sex$upper_ci_2014_model_1,
                fluidity_imp_rr_age_by_sex$upper_ci_2014_model_2
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 3 ),
  ticks_at = c( 0, 1, 2, 3 ),
  
  xlab = "Risk Ratio (95% CI)",
  nudge_y = 0.5,
  theme = tm
)

p_imp_pr_poisson_sexual_fluidity <- edit_plot( p_imp_pr_poisson_sexual_fluidity,
                                               row = c( 1, 6 ),
                                               col = 1,
                                               gp = gpar( fontface = "bold" ) 
)

p_imp_pr_poisson_sexual_fluidity <- add_text(
  p_imp_pr_poisson_sexual_fluidity,
  text = "Crude Risk Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_fluidity <- add_text(
  p_imp_pr_poisson_sexual_fluidity,
  text = "Model 1, Risk Ratio (95% CI)ᵃ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_fluidity <- add_text(
  p_imp_pr_poisson_sexual_fluidity,
  text = "Model 2, Risk Ratio (95% CI)ᵇ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_fluidity <- insert_text(
  p_imp_pr_poisson_sexual_fluidity,
  text = "Change in Sexual Identity",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_imp_pr_poisson_sexual_fluidity <- edit_plot( p_imp_pr_poisson_sexual_fluidity,
                                               row = c( 1, 6 ), 
                                               which = "background",
                                               gp = gpar( fill = "white" )
)

p_imp_pr_poisson_sexual_fluidity <- edit_plot( p_imp_pr_poisson_sexual_fluidity,
                                               row = c( 2:5, 7:10 ), 
                                               which = "background",
                                               gp = gpar( fill = "#eff3f2" )
)

p_imp_pr_poisson_sexual_fluidity <- add_border(
  p_imp_pr_poisson_sexual_fluidity,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_imp_pr_poisson_sexual_fluidity )
```